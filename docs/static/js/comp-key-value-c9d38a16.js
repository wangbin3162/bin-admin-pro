import{_ as e}from"./page-wrapper-ea777216.js";import{g as n}from"./index-c2ebc9d7.js";import{_ as l,u as a}from"./index-d826c2ba.js";import{f as t,n as o,J as s,o as u,A as i,B as d,F as r,K as p,u as c,w as m,q as f,g as b,c as g}from"./vendor-b1b195f8.js";import"./chunk-bin-ui-next-f06badfa.js";import"./chunk-brace-7f859248.js";const v={name:"KeyValueMapping",components:{DragHandle:l},props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:l}){const s=t([]),{listRef:u}=a(s,i);function i(){l("update:modelValue",s.value)}return o((()=>e.modelValue),(e=>{s.value=n(e)}),{immediate:!0,deep:!0}),{listRef:u,list:s,inputChange:function(){i()},handleAdd:function(){s.value.push({key:"",value:""}),i()},handleRemove:function(e){s.value.splice(e,1),i()}}}},h={class:"key-value-wrapper"},y={class:"mapping-list",ref:"listRef"},k=["onClick"],I={class:"mt-8 mb-8"},V=f("新增");v.render=function(e,n,l,a,t,o){const f=s("drag-handle"),b=s("b-input"),g=s("b-button");return u(),i("div",h,[d("ul",y,[(u(!0),i(r,null,p(a.list,((e,n)=>(u(),i("li",{key:n,class:"mapping-item"},[c(f),d("label",null,[c(b,{modelValue:a.list[n].key,"onUpdate:modelValue":e=>a.list[n].key=e,placeholder:"key",clearable:"",onInput:a.inputChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),d("label",null,[c(b,{modelValue:a.list[n].value,"onUpdate:modelValue":e=>a.list[n].value=e,placeholder:"value",clearable:"",onInput:a.inputChange},null,8,["modelValue","onUpdate:modelValue","onInput"])]),d("i",{class:"destroy b-iconfont b-icon-delete",onClick:e=>a.handleRemove(n)},null,8,k)])))),128))],512),d("div",I,[c(g,{icon:"plus-circle",type:"text",onClick:a.handleAdd},{default:m((()=>[V])),_:1},8,["onClick"])])])},v.__scopeId="data-v-75a06e4a";const x={name:"CompKeyValue",components:{KeyValueMapping:v,PageWrapper:e},setup(e){const n=t([{key:"1",value:"a"},{key:"2",value:"b"},{key:"3",value:"c"}]),l=b((()=>JSON.stringify(n.value,null,2)));return{mapping:n,mappingJson:l,STR:"import Sortable from 'sortablejs'\nimport { onBeforeUnmount, onMounted, ref } from 'vue'\n\n/**\n * sortable hooks，用于创建拖拽排序列表\n * @param list 列表list<ref>\n * @param endFun 拖拽结束事件函数\n * @param option 其他sortable配置项\n */\nexport default function useSortable(list, endFun, option = {}) {\n  const defaultOptions = {\n    animation: 150,\n    ghostClass: 'blue-background-class',\n    // ************* 拖动对象移动样式\n    dragClass: 'drag-item-class',\n    // ************* 禁用html5原生拖拽行为\n    forceFallback: true,\n    handle: '.drag'\n  }\n  const listRef = ref(null)\n  let sortInstance = null\n  onMounted(() => {\n    if (sortInstance) sortInstance.destroy()\n    const el = listRef.value\n    if (!el) return\n    sortInstance = Sortable.create(el, {\n      ...defaultOptions,\n      ...option,\n      onUpdate: ({ newIndex, oldIndex }) => {\n        const $li = el.children[newIndex]\n        const $oldLi = el.children[oldIndex]\n        // 先删除移动的节点\n        el.removeChild($li)\n        // 再插入移动的节点到原有节点，还原了移动的操作\n        if (newIndex > oldIndex) {\n          el.insertBefore($li, $oldLi)\n        } else {\n          el.insertBefore($li, $oldLi.nextSibling)\n        }\n        // 更新items数组\n        const targetRow = list.value.splice(oldIndex, 1)[0]\n        list.value.splice(newIndex, 0, targetRow)\n        // 下一个tick就会走patch更新\n      },\n      onEnd: (evt) => {\n        endFun && endFun()\n      }\n    })\n  })\n  onBeforeUnmount(() => {\n    if (sortInstance) {\n      sortInstance.destroy()\n      sortInstance = null\n    }\n  })\n  return {\n    listRef\n  }\n}\n"}}},w={class:"p16"},R=f("实际存储值");x.render=function(e,n,l,a,t,o){const i=s("key-value-mapping"),r=s("b-divider"),p=s("b-ace-editor"),f=s("b-collapse-wrap"),b=s("b-col"),v=s("b-row"),h=s("page-wrapper");return u(),g(h,{desc:"基础映射配置示例，可拖动排序，并封装了通用的hook钩子函数，可进行复用。"},{default:m((()=>[c(v,{gutter:16},{default:m((()=>[c(b,{span:"12"},{default:m((()=>[c(f,{title:"映射配置",shadow:"none"},{default:m((()=>[d("div",w,[c(i,{modelValue:a.mapping,"onUpdate:modelValue":n[0]||(n[0]=e=>a.mapping=e)},null,8,["modelValue"]),c(r,{align:"left"},{default:m((()=>[R])),_:1}),c(p,{"model-value":a.mappingJson,readonly:""},null,8,["model-value"])])])),_:1})])),_:1}),c(b,{span:"12"},{default:m((()=>[c(f,{title:"useSortable",shadow:"none"},{default:m((()=>[c(p,{"model-value":a.STR,lang:"typescript",readonly:"",theme:"sqlserver",height:"850px",snippets:!1},null,8,["model-value"])])),_:1})])),_:1})])),_:1})])),_:1})};export{x as default};
