import{a8 as L,l as R,ah as j,r as p,n as q,o as i,a as N,b as u,K as _,w as f,i as M,g as z,v as K,Q as l,t as O,F as P,R as Q,j as V,L as A,f as G,ac as C}from"./vendor-BdSUmcRD.js";import{n as I}from"./chunk-bin-ui-design-XqwoFEXm.js";import{b as H,s as B,c as J,g as W,d as X}from"./cross-tab-msg-yiZIjhXf.js";import{e as n,i as Y}from"./useData-BiiNGdb8.js";import{i as k}from"./index-t4HwjMnm.js";import"./chunk-brace-DkiLfVT0.js";import"./chunk-mockjs-B6s4ORgB.js";const Z={class:"sheet-wrapper"},$={class:"sheet-header"},ee={class:"left"},ae={class:"right"},te={class:"sheet-excel"},oe={key:0,class:"form-box"},se={class:"mask"},ne=Object.assign({name:"DataEditSimple"},{__name:"index",setup(le){const E=R({get:()=>n.value.name,set:e=>n.value.name=e}),b=j(),S=p(!1),g=p(!1),T=p(!1),o=p({}),v=p(null);function U(){window.close()}function w(e){k(n.value.mapping).forEach(t=>{const{fieldName:s}=t;o.value[s]=e?e.data[s]:""}),e&&e.sheets&&(v.value=k(e.sheets))}async function F(){try{g.value=!0;const e={id:b.query.id??"",tempId:n.value.id,tempName:n.value.name,data:C(o.value)};if(v.value&&v.value[0]){e.sheets=C(v.value);const c=k(n.value.mapping),t=e.sheets[0].celldata||[];c.forEach(s=>{const{cellIndex:y,fieldName:x}=s,{column:d,row:m}=y,r=t.findIndex(h=>h.c===d&&h.r===m),a=o.value[x];r>-1&&(t[r].v.v=t[r].v.m=a,e.sheets[0].data[m][d].v=e.sheets[0].data[m][d].m=a)})}e.id===""?(await H(e),I.success("新增成功!"),B("add-sheet-data",{...e}),w()):(await J(e),I.success("修改成功!"),B("modify-sheet-data",{...e}))}catch(e){console.log(e)}g.value=!1}return q(()=>b.path,async()=>{const{tempId:e,id:c}=b.query;if(document.title="数据填报",e){Y();const t=await W(e);if(n.value={...t},w(),c){const s=await X(c);w(s)}}S.value=!0},{immediate:!0}),(e,c)=>{const t=l("b-space"),s=l("b-icon"),y=l("b-input-number"),x=l("b-input"),d=l("b-form-item"),m=l("b-button"),r=l("b-form");return i(),N("div",Z,[u("div",$,[u("div",ee,[_(t,null,{default:f(()=>[u("h3",null,O(E.value),1)]),_:1})]),u("div",ae,[_(s,{type:"button",name:"close",color:"#f5222d",size:"24",onClick:U})])]),u("div",te,[S.value?(i(),N("div",oe,[_(r,{"label-width":"100px",model:o.value},{default:f(()=>[(i(!0),N(P,null,Q(A(n).mapping,(a,h)=>(i(),V(d,{key:h,prop:a.fieldName,label:a.fieldTitle},{default:f(()=>[a.dataType==="number"?(i(),V(y,{key:0,modelValue:o.value[a.fieldName],"onUpdate:modelValue":D=>o.value[a.fieldName]=D},null,8,["modelValue","onUpdate:modelValue"])):(i(),V(x,{key:1,modelValue:o.value[a.fieldName],"onUpdate:modelValue":D=>o.value[a.fieldName]=D},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["prop","label"]))),128)),_(d,null,{default:f(()=>[_(m,{type:"primary",loading:g.value,onClick:F},{default:f(()=>[G("保 存")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):M("",!0)]),z(u("div",se,"loading",512),[[K,T.value]])])}}}),_e=L(ne,[["__scopeId","data-v-5dd02c65"]]);export{_e as default};
