import{a8 as x,r as B,n as W,R as C,o as l,a as r,K as y,w as p,b as u,e as V,f as h,t as g,F as v,Q as N,i as F,j as U,a$ as q,b0 as K,b1 as J,b2 as P,aD as Z,m as I,l as D,H as G,a2 as M,Y as L,aC as T,X as R,I as $}from"./vendor-COsJffew.js";import{p as ee,d as j}from"./index-DlSIhdb0.js";import"./chunk-brace-DF1jSkZr.js";import"./chunk-bin-ui-design-55yTQV6H.js";const te={name:"field-label",props:{fieldValues:{type:Array,default:()=>[]},field:{type:Object,default:()=>({headers:{}})},variant:{type:String,default:"primary"}},setup(e){const t=B(!0),o=B(!1);function n(b){e.fieldValues.forEach(w=>{w.checked=b}),t.value=!1}function s(){d()}function d(){const b=e.fieldValues.reduce((f,m)=>m.checked?f+=1:f,0),w=e.fieldValues.length;b===w?(t.value=!1,o.value=!0):b>0?(t.value=!0,o.value=!1):(t.value=!1,o.value=!1)}return W(()=>e.fieldValues,()=>{d()},{immediate:!0}),{indeterminate:t,checkAll:o,handleCheckAll:n,handleCheckChange:s}}},ae={class:"field-label-button"},le={"aria-hidden":"true",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 270 512",class:"svg-inline--fa fa-grip-vertical fa-w-10",style:{position:"relative",top:"3px",width:"10px",height:"16px"}},re={style:{"margin-left":"8px"}},oe={style:{width:"160px"}},se={class:"dropdown-list"},ne={style:{"border-bottom":"1px solid #e9e9e9",padding:"0 10px 2px"}},ie={class:"dropdown-list"};function de(e,t,o,n,s,d){const b=C("b-button"),w=C("b-checkbox"),f=C("b-divider"),m=C("b-popper"),c=C("b-button-group");return l(),r("div",ae,[y(c,null,{default:p(()=>[y(b,{type:o.variant,class:"btn-draggable"},{default:p(()=>[(l(),r("svg",le,t[1]||(t[1]=[u("path",{fill:"currentColor",d:"M64 208c26.5 0 48 21.5 48 48s-21.5 48-48 48-48-21.5-48-48 21.5-48 48-48zM16 104c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48zm0 304c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48z M204 208c26.5 0 48 21.5 48 48s-21.5 48 -48 48 -48 -21.5 -48 -48 21.5 -48 48 -48zM156 104c0 26.5 21.5 48 48 48s48 -21.5 48 -48 -21.5 -48 -48 -48 -48 21.5 -48 48zm0 304c0 26.5 21.5 48 48 48s48 -21.5 48 -48 -21.5 -48 -48 -48 -48 21.5 -48 48z",class:""},null,-1)]))),u("span",re,[o.field.labelSlotName?V(e.$slots,o.field.labelSlotName,{key:0},()=>[t[2]||(t[2]=h(" Missing slot ")),u("code",null,g(o.field.labelSlotName),1)]):(l(),r(v,{key:1},[h(g(o.field.label),1)],64))])]),_:3},8,["type"]),y(m,{trigger:"click",theme:"light","show-arrow":!1,offset:4,placement:"bottom",transition:"zoom-in-top","popper-class":"bin-select__popper field-label-popper","gpu-acceleration":!1},{trigger:p(()=>[y(b,{type:o.variant,icon:"caret-down",style:{padding:"0 6px"}},null,8,["type"])]),default:p(()=>[u("div",oe,[o.field.headerAttributeFilter?(l(),r(v,{key:0},[t[3]||(t[3]=u("h6",{class:"dropdown-header"},"Attributes",-1)),u("div",se,[(l(!0),r(v,null,N(o.field.headers,(a,i)=>(l(),r("div",{key:i,style:{padding:"2px 10px"}},[y(w,{modelValue:a.checked,"onUpdate:modelValue":_=>a.checked=_},{default:p(()=>[h(g(a.label),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])]))),128))])],64)):F("",!0),o.field.headerAttributeFilter&&o.field.valueFilter?(l(),U(f,{key:1,style:{margin:"8px 0"}})):F("",!0),o.field.valueFilter?(l(),r(v,{key:2},[t[6]||(t[6]=u("h6",{class:"dropdown-header"},"Values",-1)),u("div",ne,[y(w,{indeterminate:n.indeterminate,modelValue:n.checkAll,"onUpdate:modelValue":t[0]||(t[0]=a=>n.checkAll=a),onChange:n.handleCheckAll},{default:p(()=>t[4]||(t[4]=[h(" 全选 ")])),_:1},8,["indeterminate","modelValue","onChange"])]),u("div",ie,[(l(!0),r(v,null,N(o.fieldValues,(a,i)=>(l(),r("div",{key:i,style:{padding:"2px 10px"}},[y(w,{modelValue:a.checked,"onUpdate:modelValue":_=>a.checked=_,onChange:n.handleCheckChange},{default:p(()=>[o.field.valueFilterSlotName?V(e.$slots,o.field.valueFilterSlotName,{key:0,value:a.value},()=>[t[5]||(t[5]=h(" Missing slot ")),u("code",null,g(o.field.valueFilterSlotName),1)]):(l(),r(v,{key:1},[h(g(a.value),1)],64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]))),128))])],64)):F("",!0)])]),_:3})]),_:3})])}const ue=x(te,[["render",de]]),ce={name:"pivot-table",components:{SvgLoading:ee},props:{data:{type:Array,default:()=>[]},rowFields:{type:Array,default:()=>[]},colFields:{type:Array,default:()=>[]},reducer:{type:Function,default:e=>e+1},reducerInitialValue:{default:0},noDataWarningText:{type:String,default:"No data to display."},isDataLoading:{type:Boolean,default:!1}},data(){return{valuesMap:null,rows:[],cols:[],internalRowFields:[],internalColFields:[],isDataComputing:!1,computingInterval:null}},computed:{sortedRows(){let e;return this.internalRowFields.forEach((t,o)=>{o===0?e=q.firstBy(0,{cmp:t.sort||K}):e=e.thenBy(o,{cmp:t.sort||K})}),[...this.rows].sort(e)},sortedCols(){let e;return this.internalColFields.forEach((t,o)=>{o===0?e=q.firstBy(0,{cmp:t.sort||K}):e=e.thenBy(o,{cmp:t.sort||K})}),[...this.cols].sort(e)},fields(){return[[this.colFields,this.rowFields],[this.colFields.map(e=>e.headerSlotNames),this.rowFields.map(e=>e.headerSlotNames)],[this.colFields.map(e=>e.valuesFiltered),this.rowFields.map(e=>e.valuesFiltered)]]},rowHeaderSize(){return this.internalRowFields.reduce((e,t)=>t.showHeader===void 0||t.showHeader?t.headerSlotNames?e+t.headerSlotNames.length:e+1:e,0)},rowFooterSize(){return this.internalRowFields.reduce((e,t)=>t.showFooter?t.footerSlotNames?e+t.footerSlotNames.length:e+1:e,0)},colHeaderSize(){return this.internalColFields.reduce((e,t)=>t.showHeader===void 0||t.showHeader?t.headerSlotNames?e+t.headerSlotNames.length:e+1:e,0)},colFooterSize(){return this.internalColFields.reduce((e,t)=>t.showFooter?t.footerSlotNames?e+t.footerSlotNames.length:e+1:e,0)},tableHeader(){return{colHeaderFields:this.internalColFields.map((t,o)=>({colField:t,cols:this.sortedCols.map((n,s)=>({value:n[o],colspan:this.spanSize(this.sortedCols,s,o)})).filter(n=>n.colspan!==0)})).filter(({colField:t})=>t.showHeader===void 0||t.showHeader)}},tableFooter(){return{colFooterFields:this.internalColFields.map((t,o)=>({colField:t,cols:this.sortedCols.map((n,s)=>({value:n[o],colspan:this.spanSize(this.sortedCols,s,o)})).filter(n=>n.colspan!==0)})).filter(({colField:t})=>t.showFooter).reverse()}},tableRows(){return this.sortedRows.map((e,t)=>{const o=this.internalRowFields.map((s,d)=>({...s,value:e[d],rowspan:this.spanSize(this.sortedRows,t,d)})).filter(s=>(s.showHeader===void 0||s.showHeader)&&s.rowspan!==0),n=this.internalRowFields.map((s,d)=>({...s,value:e[d],rowspan:this.spanSize(this.sortedRows,t,d)})).filter(s=>s.showFooter&&s.rowspan!==0).reverse();return{row:e,rowHeaderFields:o,rowFooterFields:n}})}},methods:{value(e,t){return this.valuesMap.get([...e,...t])||this.reducerInitialValue},spanSize(e,t,o){if(t>0&&e[t-1][o]===e[t][o]&&(o===0||this.spanSize(e,t,o-1)===0))return 0;let n=1,s=t;for(;s+1<e.length&&e[s+1][o]===e[s][o]&&(o===0||s+1<e.length&&this.spanSize(e,s+1,o-1)===0);)s++,n++;return n},updateInternalFields(){this.internalRowFields=j(this.rowFields),this.internalColFields=j(this.colFields)},updateValues(e=!0){this.isDataComputing=!0,clearInterval(this.computingInterval),this.computingInterval=setTimeout(()=>{const t=[],o=[],n=new J,s=[...this.rowFields,...this.colFields];this.data.forEach(d=>{const b=[],w=[];let f=!1;for(let m of s)if(m.valuesFiltered&&!m.valuesFiltered.has(m.getter(d))){f=!0;break}if((!f||e)&&(this.rowFields.forEach(m=>{b.push(m.getter(d))}),this.colFields.forEach(m=>{w.push(m.getter(d))})),f||(t.some(m=>this.rowFields.every((c,a)=>m[a]===b[a]))||t.push(b),o.some(m=>this.colFields.every((c,a)=>m[a]===w[a]))||o.push(w)),e){const m=[...b,...w],c=n.get(m)||j(this.reducerInitialValue);n.set(m,this.reducer(c,d))}}),this.rows=t,this.cols=o,e&&(this.valuesMap=n),this.isDataComputing=!1,this.updateInternalFields()},0)}},watch:{fields:function(e,t){P(e[0],t[0])?P(e[1],t[1])?P(e[2],t[2])||this.updateValues(!1):this.updateInternalFields():this.updateValues()},data:function(){this.updateValues()}},created:function(){this.updateValues()}},pe={class:"position-relative"},ye={key:0,class:"pivot-table-loading"},fe={key:0,class:"pivot-table-loading"},he={key:2,class:"table-responsive"},ge=["aria-busy"],me=["colspan","rowspan"],ve=["colspan"],we=["colspan","rowspan"],be=["colspan","rowspan"],Se=["colspan"],_e=["colspan","rowspan"],ke=["rowspan"],Fe=["rowspan"],Ce=["rowspan"],ze=["rowspan"],Ne=["colspan","rowspan"],He=["colspan"],Ve=["colspan","rowspan"],Ae=["colspan","rowspan"],De=["colspan"],Ee=["colspan","rowspan"];function Ke(e,t,o,n,s,d){const b=C("svg-loading"),w=C("b-empty");return l(),r("div",pe,[o.isDataLoading?(l(),r("div",ye,[y(b,{name:"loading04",style:{width:"80px",height:"80px"}}),t[0]||(t[0]=u("span",null,"Loading...",-1))])):(l(),r(v,{key:1},[s.isDataComputing?(l(),r("div",fe,[y(b,{name:"loading02",style:{width:"80px",height:"80px"}}),t[1]||(t[1]=u("span",null,"Loading table values...",-1))])):F("",!0),o.data.length===0||s.rows.length===0&&s.cols.length===0?(l(),U(w,{key:1},{default:p(()=>[h(g(o.noDataWarningText),1)]),_:1})):s.cols.length&&s.rows.length?(l(),r("div",he,[u("table",{class:"pivot-table pivot-table-bordered","aria-busy":o.isDataLoading||s.isDataComputing},[u("thead",null,[(l(!0),r(v,null,N(d.tableHeader.colHeaderFields,({colField:f,cols:m},c)=>(l(),r(v,null,[f.headerSlotNames?(l(!0),r(v,{key:0},N(f.headerSlotNames,(a,i)=>(l(),r("tr",{key:`${c}-${i}`},[c===0&&d.rowHeaderSize>0&&i===0?(l(),r("th",{key:0,colspan:d.rowHeaderSize,rowspan:d.colHeaderSize},null,8,me)):F("",!0),(l(!0),r(v,null,N(m,(_,A)=>(l(),r("th",{key:`${c}-${i}-${A}`,colspan:_.colspan},[V(e.$slots,a,{value:_.value},()=>[t[2]||(t[2]=h(" Missing slot ")),u("code",null,g(a),1)],!0)],8,ve))),128)),c===0&&d.rowFooterSize>0&&i===0?(l(),r("th",{key:1,colspan:d.rowFooterSize,rowspan:d.colHeaderSize},null,8,we)):F("",!0)]))),128)):(l(),r("tr",{key:c},[c===0&&d.rowHeaderSize>0?(l(),r("th",{key:0,colspan:d.rowHeaderSize,rowspan:d.colHeaderSize},null,8,be)):F("",!0),(l(!0),r(v,null,N(m,(a,i)=>(l(),r("th",{key:`${c}-${i}`,colspan:a.colspan},[f.headerSlotName?V(e.$slots,f.headerSlotName,{key:0,value:a.value},()=>[t[3]||(t[3]=h(" Missing slot ")),u("code",null,g(f.headerSlotName),1)],!0):(l(),r(v,{key:1},[h(g(a.value),1)],64))],8,Se))),128)),c===0&&d.rowFooterSize>0?(l(),r("th",{key:1,colspan:d.rowFooterSize,rowspan:d.colHeaderSize},null,8,_e)):F("",!0)]))],64))),256))]),u("tbody",null,[(l(!0),r(v,null,N(d.tableRows,({row:f,rowHeaderFields:m,rowFooterFields:c},a)=>(l(),r("tr",{key:a},[(l(!0),r(v,null,N(m,(i,_)=>(l(),r(v,null,[i.headerSlotNames?(l(!0),r(v,{key:0},N(i.headerSlotNames,(A,E)=>(l(),r("th",{key:`header-${a}-${_}-${E}`,rowspan:i.rowspan},[V(e.$slots,A,{value:i.value},()=>[t[4]||(t[4]=h(" Missing slot ")),u("code",null,g(A),1)],!0)],8,ke))),128)):(l(),r("th",{key:`header-${a}-${_}`,rowspan:i.rowspan},[i.headerSlotName?V(e.$slots,i.headerSlotName,{key:0,value:i.value},()=>[t[5]||(t[5]=h(" Missing slot ")),u("code",null,g(i.headerSlotName),1)],!0):(l(),r(v,{key:1},[h(g(i.value),1)],64))],8,Fe))],64))),256)),(l(!0),r(v,null,N(d.sortedCols,(i,_)=>(l(),r("td",{key:`value-${a}-${_}`,class:"text-right"},[e.$slots.value?V(e.$slots,"value",{key:0,value:d.value(f,i),row:Object.values(f),col:Object.values(i)},void 0,!0):(l(),r(v,{key:1},[h(g(d.value(f,i)),1)],64))]))),128)),(l(!0),r(v,null,N(c,(i,_)=>(l(),r(v,null,[i.footerSlotNames?(l(!0),r(v,{key:0},N(i.footerSlotNames,(A,E)=>(l(),r("th",{key:`footer-${a}-${_}-${E}`,rowspan:i.rowspan},[V(e.$slots,A,{value:i.value},()=>[t[6]||(t[6]=h(" Missing slot ")),u("code",null,g(A),1)],!0)],8,Ce))),128)):(l(),r("th",{key:`footer-${a}-${_}`,rowspan:i.rowspan},[i.footerSlotName?V(e.$slots,i.footerSlotName,{key:0,value:i.value},()=>[t[7]||(t[7]=h(" Missing slot ")),u("code",null,g(i.footerSlotName),1)],!0):(l(),r(v,{key:1},[h(g(i.value),1)],64))],8,ze))],64))),256))]))),128))]),u("tfoot",null,[(l(!0),r(v,null,N(d.tableFooter.colFooterFields,({colField:f,cols:m},c)=>(l(),r(v,null,[f.footerSlotNames?(l(!0),r(v,{key:0},N(f.footerSlotNames,(a,i)=>(l(),r("tr",{key:`${c}-${i}`},[c===0&&d.rowHeaderSize>0&&i===0?(l(),r("th",{key:0,colspan:d.rowHeaderSize,rowspan:d.colFooterSize},null,8,Ne)):F("",!0),(l(!0),r(v,null,N(d.sortedCols,(_,A)=>(l(),r("th",{key:`${c}-${i}-${A}`,colspan:_.colspan},[V(e.$slots,a,{value:_.value},()=>[t[8]||(t[8]=h(" Missing slot ")),u("code",null,g(a),1)],!0)],8,He))),128)),c===0&&d.rowFooterSize>0&&i===0?(l(),r("th",{key:1,colspan:d.rowFooterSize,rowspan:d.colFooterSize},null,8,Ve)):F("",!0)]))),128)):(l(),r("tr",{key:c},[c===0&&d.rowHeaderSize>0?(l(),r("th",{key:0,colspan:d.rowHeaderSize,rowspan:d.colFooterSize},null,8,Ae)):F("",!0),(l(!0),r(v,null,N(m,(a,i)=>(l(),r("th",{key:`${c}-${i}`,colspan:a.colspan},[f.footerSlotName?V(e.$slots,f.footerSlotName,{key:0,value:a.value},()=>[t[9]||(t[9]=h(" Missing slot ")),u("code",null,g(f.footerSlotName),1)],!0):(l(),r(v,{key:1},[h(g(a.value),1)],64))],8,De))),128)),c===0&&d.rowFooterSize>0?(l(),r("th",{key:1,colspan:d.rowFooterSize,rowspan:d.colFooterSize},null,8,Ee)):F("",!0)]))],64))),256))])],8,ge)])):F("",!0)],64))])}const X=x(ce,[["render",Ke],["__scopeId","data-v-4c86a33c"]]),Be={name:"pivot",components:{PivotTable:X,draggable:Z,FieldLabel:ue},props:{data:{type:Array,default:()=>[]},fields:{type:Array,default:()=>[]},availableFieldKeys:{type:Array,default:()=>[]},rowFieldKeys:{type:Array,default:()=>[]},colFieldKeys:{type:Array,default:()=>[]},reducer:{type:Function,default:e=>e+1},reducerInitialValue:{default:0},defaultShowSettings:{type:Boolean,default:!0},availableFieldsLabelText:{type:String,default:"Available fields"},colsLabelText:{type:String,default:"Columns"},rowsLabelText:{type:String,default:"Rows"},hideSettingsText:{type:String,default:"Hide settings"},showSettingsText:{type:String,default:"Show settings"},noDataWarningText:{type:String,default:"No data to display."},isDataLoading:{type:Boolean,default:!1}},setup(e,{emit:t}){const o=I({availableFieldKeys:e.availableFieldKeys,rowFieldKeys:e.rowFieldKeys,colFieldKeys:e.colFieldKeys}),n=B(e.defaultShowSettings);function s(){n.value=!n.value}const d=B({}),b=D(()=>{const H=e.fields,z={};H.forEach(S=>{z[S.key]=S});const k=H.filter(S=>S.valueFilter);return k.forEach(S=>{z[S.key].valuesSet=new Set}),e.data.forEach(S=>{k.forEach(Y=>{z[Y.key].valuesSet.add(Y.getter(S))})}),k.forEach(S=>{z[S.key].values=Array.from(z[S.key].valuesSet).sort(S.sort||K)}),z});function w(){for(let[H,z]of Object.entries(b.value))z.valueFilter&&(d.value[H]=[],z.values.forEach(k=>{d.value[H].push({value:k,checked:!0})}))}const f=B(!1),m=D(()=>f.value?"drag-area-highlight":null);function c(){f.value=!0}function a(){f.value=!1}const i=D(()=>({width:n.value?"calc(100% - 200px - 2rem)":"100%"})),_=D(()=>{const H={};for(let[z,k]of Object.entries(d.value))H[z]=new Set,k.forEach(S=>{S.checked&&H[z].add(S.value)});return H}),A=D(()=>{const H=[];return o.rowFieldKeys.forEach(z=>{const k=e.fields.find(S=>S.key===z);k.headers&&(k.headerSlotNames=k.headers.filter(S=>S.checked).map(S=>S.slotName)),k.valueFilter&&(k.valuesFiltered=_.value[k.key]),H.push(k)}),H}),E=D(()=>{const H=[];return o.colFieldKeys.forEach(z=>{const k=e.fields.find(S=>S.key===z);k.headers&&(k.headerSlotNames=k.headers.filter(S=>S.checked).map(S=>S.slotName)),k.valueFilter&&(k.valuesFiltered=_.value[k.key]),H.push(k)}),H});return W(()=>e.fields,H=>{H.filter(z=>z.valueFilter).forEach(z=>{d.value[z.key]={}}),w()},{immediate:!0}),W(()=>e.data,()=>{w()}),{internal:o,showSettings:n,toggleShowSettings:s,fieldValues:d,fieldsWithValues:b,dragging:f,dragAreaClass:m,dragStart:c,dragEnd:a,tableWrapperStyle:i,rowFields:A,colFields:E}}},xe={class:"bin-pivot-table"},Me={class:"top-row"},Le={class:"left-col"},Te={key:0,class:"right-col"},Ue={class:"drag-area-title"},Pe={class:"field"},Ge={key:0,class:"top-row mt-16"},Re={class:"right-col"},je={class:"drag-area-title"},We={class:"field"},Oe={class:"bottom-row",flex:""},Ye={key:0,class:"left-col"},qe={class:"drag-area-title"},Qe={class:"field"};function Xe(e,t,o,n,s,d){const b=C("b-button"),w=C("field-label"),f=C("draggable"),m=C("pivot-table");return l(),r("div",xe,[u("div",Me,[u("div",Le,[y(b,{type:"primary","animation-type":"waves",onClick:n.toggleShowSettings},{default:p(()=>[h(g(o.hideSettingsText),1)]),_:1},8,["onClick"])]),n.showSettings?(l(),r("div",Te,[u("div",{class:G(["drag-area",n.dragAreaClass])},[u("div",Ue,g(o.availableFieldsLabelText),1),y(f,R({modelValue:n.internal.availableFieldKeys,"onUpdate:modelValue":t[0]||(t[0]=c=>n.internal.availableFieldKeys=c),class:"drag-area-zone","item-key":"key"},{animation:200,group:"fields",ghostClass:"sortable-ghost",handle:".btn-draggable"},{onStart:n.dragStart,onEnd:n.dragEnd}),{item:p(({element:c})=>[u("div",Pe,[y(w,{"field-values":n.fieldValues[c],field:n.fieldsWithValues[c],variant:"warning"},M({_:2},[N(e.$slots,(a,i)=>({name:i,fn:p(_=>[V(e.$slots,i,L(T(_)),void 0,!0)])}))]),1032,["field-values","field"])])]),_:3},16,["modelValue","onStart","onEnd"])],2)])):F("",!0)]),n.showSettings?(l(),r("div",Ge,[t[3]||(t[3]=u("div",{class:"left-col"},null,-1)),u("div",Re,[u("div",{class:G(["drag-area border-primary",n.dragAreaClass])},[u("div",je,g(o.colsLabelText),1),y(f,R({modelValue:n.internal.colFieldKeys,"onUpdate:modelValue":t[1]||(t[1]=c=>n.internal.colFieldKeys=c),class:"drag-area-zone","item-key":"key"},{animation:200,group:"fields",ghostClass:"sortable-ghost",handle:".btn-draggable"},{onStart:n.dragStart,onEnd:n.dragEnd}),{item:p(({element:c})=>[u("div",We,[y(w,{"field-values":n.fieldValues[c],field:n.fieldsWithValues[c]},M({_:2},[N(e.$slots,(a,i)=>({name:i,fn:p(_=>[V(e.$slots,i,L(T(_)),void 0,!0)])}))]),1032,["field-values","field"])])]),_:3},16,["modelValue","onStart","onEnd"])],2)])])):F("",!0),u("div",Oe,[n.showSettings?(l(),r("div",Ye,[u("div",{class:G(["drag-area border-primary",n.dragAreaClass])},[u("div",qe,g(o.rowsLabelText),1),y(f,R({modelValue:n.internal.rowFieldKeys,"onUpdate:modelValue":t[2]||(t[2]=c=>n.internal.rowFieldKeys=c),class:"drag-area-zone","item-key":"key"},{animation:200,group:"fields",ghostClass:"sortable-ghost",handle:".btn-draggable"},{onStart:n.dragStart,onEnd:n.dragEnd}),{item:p(({element:c})=>[u("div",Qe,[y(w,{"field-values":n.fieldValues[c],field:n.fieldsWithValues[c]},M({_:2},[N(e.$slots,(a,i)=>({name:i,fn:p(_=>[V(e.$slots,i,L(T(_)),void 0,!0)])}))]),1032,["field-values","field"])])]),_:3},16,["modelValue","onStart","onEnd"])],2)])):F("",!0),u("div",{class:"right-col",style:$(n.tableWrapperStyle)},[y(m,{data:o.data,"row-fields":n.rowFields,"col-fields":n.colFields,reducer:o.reducer,"reducer-initial-value":o.reducerInitialValue,"no-data-warning-text":o.noDataWarningText,"is-data-loading":o.isDataLoading},M({_:2},[N(e.$slots,(c,a)=>({name:a,fn:p(i=>[V(e.$slots,a,L(T(i)),void 0,!0)])}))]),1032,["data","row-fields","col-fields","reducer","reducer-initial-value","no-data-warning-text","is-data-loading"])],4)])])}const Je=x(Be,[["render",Xe],["__scopeId","data-v-f4378dc4"]]),Ze={name:"pivot-doc",data(){return{docCol1:[{title:"属性名",key:"prop",width:220},{title:"类型",key:"type",width:100},{title:"默认值",key:"default",width:220},{title:"描述",key:"desc"}],docCol2:[{title:"属性名",key:"prop",width:220},{title:"类型",key:"type",width:100},{title:"描述",key:"desc"}],docCol3:[{title:"插槽名",key:"slot",width:240},{title:"描述",key:"desc"},{title:"Scope",key:"scope",width:160}],docData1:[{prop:"data",type:"Array",default:"[]",desc:"pivot表格数据集"},{prop:"fields",type:"Array",default:"[]",desc:"定义了所有行列字段配置信息。具体包含如下"},{prop:"available-field-keys",type:"Array",default:"[]",desc:"默认情况下显示为“可用”的字段的键"},{prop:"row-field-keys",type:"Array",default:"[]",desc:"默认情况下要作为行使用的字段的键"},{prop:"col-field-keys",type:"Array",default:"[]",desc:"默认情况下要作为列使用的字段的键"},{prop:"reducer",type:"function",default:"(sum, item) => sum + 1",desc:"计算表数据累加器"},{prop:"reducer-initial-value",type:"any",default:"0",desc:"累加器初始值"},{prop:"no-data-warning-text",type:"String",default:"No data to display.",desc:"无数据文字"},{prop:"is-data-loading",type:"Boolean",default:"false",desc:"是否加载"},{prop:"default-show-settings",type:"Boolean",default:"true",desc:"是否显示设置按钮"},{prop:"available-fields-label-text",type:"String",default:"Available fields",desc:"可选字段标题"},{prop:"rows-label-text",type:"String",default:"Available fields",desc:"可选字段标题"},{prop:"rows-label-text",type:"String",default:"Rows",desc:"行字段标题"},{prop:"cols-label-text",type:"String",default:"Columns",desc:"列字段标题"},{prop:"hide-settings-text",type:"String",default:"Hide settings",desc:"隐藏设置文字"},{prop:"show-settings-text",type:"String",default:"Show settings",desc:"显示设置文字"}],docData2:[{prop:"key",type:"String",desc:"用于标识字段的key"},{prop:"label",type:"String",desc:"在可拖动元素中显示的文本"},{prop:"labelSlotName",type:"String",desc:"可选-用于格式化标签内容的槽位名称"},{prop:"getter",type:"Function",desc:"函数应用于数据元素以获取字段值，如 getter: item => item.country"},{prop:"sort",type:"Function",desc:"可选-在pivot表头中排序字段的函数;如果没有提供值，将应用javascript-natural-sort"},{prop:"showHeader",type:"Boolean",desc:"可选(默认值:true)—标题是否应该显示在数据透视表中"},{prop:"showFooter",type:"Boolean",desc:"可选(默认:false)—页脚是否应该显示在透视表中"},{prop:"headerSlotName",type:"String",desc:"可选-用于格式化数据透视表头部的槽名;如果没有提供槽位名称，则该值将显示为data中找到的值"},{prop:"headerSlotNames",type:"String[]",desc:"可选-用于在数据透视表中格式化标题的槽名"},{prop:"headers",type:"Array",desc:"可选-标题的定义(参见标题元素格式)"},{prop:"footerSlotName",type:"String",desc:"与上面表头插槽雷同"},{prop:"footerSlotNames",type:"String[]",desc:"与上面表头插槽雷同"},{prop:"headerAttributeFilter",type:"Boolean",desc:"可选(默认:false) -激活下拉菜单过滤字段头属性"},{prop:"valueFilter",type:"Boolean",desc:"可选(默认:false) -激活下拉菜单过滤字段值"},{prop:"valueFilterSlotName",type:"Boolean",desc:"可选—用于格式化字段值选择下拉列表中的值的槽名"}],docData3:[{prop:"slotName",type:"String",desc:"用于格式化数据透视表头部的槽名"},{prop:"label",type:"String",desc:"如果headerAttributeFilter被激活，在字段下拉:标签显示在复选框旁边"},{prop:"checked",type:"Boolean",desc:"如果headerAttributeFilter被激活，在下拉字段中:默认复选框值"}],docData4:[{slot:"<field label slot name>",scope:"",desc:"显示在字段可拖动标签中的内容"},{slot:"<field header slot name>",scope:"{ value }",desc:"字段的表头内容，从字段头slotname属性引用"},{slot:"<field value filter slot name>",scope:"{ value }",desc:"如果字段valueFilter prop被设置为true:复选框旁边菜单中的内容"},{slot:"value",scope:"{ value, row, col }",desc:"单元格内容"}],docData5:[{prop:"data",type:"Array",default:"[]",desc:"pivot表格数据集"},{prop:"row-fields",type:"Array",default:"[]",desc:"默认情况下作为行使用的字段"},{prop:"col-fields",type:"Array",default:"[]",desc:"默认情况下作为列使用的字段"},{prop:"reducer",type:"function",default:"(sum, item) => sum + 1",desc:"计算表数据累加器"},{prop:"reducer-initial-value",type:"any",default:"0",desc:"累加器初始值"},{prop:"no-data-warning-text",type:"String",default:"No data to display.",desc:"无数据文字"},{prop:"is-data-loading",type:"Boolean",default:"false",desc:"是否加载"}],docData6:[{prop:"getter",type:"Function",desc:"函数应用于数据元素以获取字段值，如 getter: item => item.country"},{prop:"sort",type:"Function",desc:"可选-在pivot表头中排序字段的函数;如果没有提供值，将应用javascript-natural-sort"},{prop:"showHeader",type:"Boolean",desc:"可选(默认值:true)—标题是否应该显示在数据透视表中"},{prop:"showFooter",type:"Boolean",desc:"可选(默认:false)—页脚是否应该显示在透视表中"},{prop:"headerSlotName",type:"String",desc:"可选-用于格式化数据透视表头部的槽名;如果没有提供槽位名称，则该值将显示为data中找到的值"},{prop:"headerSlotNames",type:"String[]",desc:"可选-用于在数据透视表中格式化标题的槽名"},{prop:"footerSlotName",type:"String",desc:"与上面表头插槽雷同"},{prop:"footerSlotNames",type:"String[]",desc:"与上面表头插槽雷同"},{prop:"valuesFiltered",type:"Set",desc:"可选-一组值来过滤显示的行/列"}]}}};function Ie(e,t,o,n,s,d){const b=C("b-table"),w=C("b-collapse-panel"),f=C("b-tag"),m=C("b-divider"),c=C("b-collapse");return l(),U(c,{simple:""},{default:p(()=>[y(w,{title:"Pivot component",name:"1"},{default:p(()=>[y(b,{columns:s.docCol1,data:s.docData1,size:"small",border:""},null,8,["columns","data"])]),_:1}),y(w,{title:"fields element format",name:"2"},{default:p(()=>[y(f,{type:"primary",dark:""},{default:p(()=>t[0]||(t[0]=[h("Fields")])),_:1}),y(b,{columns:s.docCol2,data:s.docData2,size:"small",border:""},null,8,["columns","data"]),y(m),y(f,{type:"primary",dark:""},{default:p(()=>t[1]||(t[1]=[h("headers")])),_:1}),y(b,{columns:s.docCol2,data:s.docData3,size:"small",border:""},null,8,["columns","data"])]),_:1}),y(w,{title:"Slots",name:"3"},{default:p(()=>[y(b,{columns:s.docCol3,data:s.docData4,size:"small",border:""},null,8,["columns","data"])]),_:1}),y(w,{title:"PivotTable component",name:"4"},{default:p(()=>[y(f,{type:"primary",dark:""},{default:p(()=>t[2]||(t[2]=[h("PivotTable")])),_:1}),y(b,{columns:s.docCol1,data:s.docData5,size:"small",border:""},null,8,["columns","data"]),y(m),y(f,{type:"primary",dark:""},{default:p(()=>t[3]||(t[3]=[h("row-fields/col-fields")])),_:1}),y(b,{columns:s.docCol2,data:s.docData6,size:"small",border:""},null,8,["columns","data"])]),_:1})]),_:1})}const $e=x(Ze,[["render",Ie]]),Q=[{country:"United States",year:2010,gender:"male",count:153295220},{country:"United States",year:2010,gender:"female",count:156588400},{country:"United States",year:2011,gender:"male",count:154591960},{country:"United States",year:2011,gender:"female",count:157800200},{country:"United States",year:2012,gender:"male",count:155851840},{country:"United States",year:2012,gender:"female",count:158944800},{country:"China",year:2010,gender:"male",count:690256342},{country:"China",year:2010,gender:"female",count:650712406},{country:"China",year:2011,gender:"male",count:694106441},{country:"China",year:2011,gender:"female",count:654068030},{country:"China",year:2012,gender:"male",count:697964288},{country:"China",year:2012,gender:"female",count:657422649},{country:"India",year:2010,gender:"male",count:638354751},{country:"India",year:2010,gender:"female",count:592629727},{country:"India",year:2011,gender:"male",count:646873890},{country:"India",year:2011,gender:"female",count:600572093},{country:"India",year:2012,gender:"male",count:655193693},{country:"India",year:2012,gender:"female",count:608395922},{country:"France",year:2010,gender:"male",count:30675773},{country:"France",year:2010,gender:"female",count:32285363},{country:"France",year:2011,gender:"male",count:30815839},{country:"France",year:2011,gender:"female",count:32452566},{country:"France",year:2012,gender:"male",count:30948916},{country:"France",year:2012,gender:"female",count:32612882},{country:"Australia",year:2010,gender:"male",count:11124254},{country:"Australia",year:2010,gender:"female",count:11218144},{country:"Australia",year:2011,gender:"male",count:11260747},{country:"Australia",year:2011,gender:"female",count:11359807},{country:"Australia",year:2012,gender:"male",count:11280804},{country:"Australia",year:2012,gender:"female",count:11402769}],et=[{country:"United States",year:2010,count:309883620,gdp:14992052727e3},{country:"United States",year:2011,count:312392160,gdp:152245548035749e-1},{country:"United States",year:2012,count:311703680,gdp:155670381447034e-1},{country:"China",year:2010,count:1340968748,gdp:608716387451073e-2},{country:"China",year:2011,count:1348174471,gdp:666853868061758e-2},{country:"China",year:2012,count:1355386937,gdp:719293498743843e-2},{country:"India",year:2010,count:1230984478,gdp:167561533560056e-2},{country:"India",year:2011,count:1247445983,gdp:176343961355183e-2},{country:"India",year:2012,count:1263589615,gdp:185965973429044e-2},{country:"France",year:2010,count:62961136,gdp:264260954893036e-2},{country:"France",year:2011,count:63268405,gdp:270055406522866e-2},{country:"France",year:2012,count:63561798,gdp:270901043847852e-2},{country:"Australia",year:2010,count:22342398,gdp:114613846560381e-2},{country:"Australia",year:2011,count:22620554,gdp:117436506300545e-2},{country:"Australia",year:2012,count:22683573,gdp:122037859887343e-2}],O=[];et.forEach(e=>{O.push({country:e.country,year:e.year,type:"count",count:e.count}),O.push({country:e.country,year:e.year,type:"gdp",gdp:e.gdp})});const tt={name:"GraphPivotDemo",components:{PivotDoc:$e,PivotTable:X,Pivot:Je},data(){return{data:Q,asyncData:[],dataGdpFlattened:O,fields:[{key:"country",getter:e=>e.country,label:"Country",headers:[{slotName:"countryFlagHeader",label:"Flag",checked:!0},{slotName:"countryNameHeader",label:"Name",checked:!0}],headerAttributeFilter:!0,valueFilter:!0},{key:"gender",getter:e=>e.gender,label:"Gender",headerSlotName:"genderHeader",valueFilter:!0,valueFilterSlotName:"genderHeader"},{key:"year",getter:e=>e.year,label:"Year",valueFilter:!0}],availableFieldKeys:[],rowFieldKeys:["country","gender"],colFieldKeys:["year"],reducer:(e,t)=>e+t.count,defaultShowSettings:!0,isDataLoading:!1,rowFields:[{getter:e=>e.country,label:"Country",headerSlotNames:["countryFlagHeader","countryNameHeader"]},{getter:e=>e.gender,label:"Gender",headerSlotName:"genderHeader"}],colFields:[{getter:e=>e.year,label:"Year"}],fieldsGdp:[{key:"country",getter:e=>e.country,label:"Country",headers:[{slotName:"countryFlagHeader",label:"Flag",checked:!0},{slotName:"countryNameHeader",label:"Name",checked:!0}],headerAttributeFilter:!0,valueFilter:!0},{key:"year",getter:e=>e.year,label:"Year",valueFilter:!0},{key:"type",getter:e=>e.type,headerSlotName:"typeHeader",label:"Type",valueFilter:!0,valueFilterSlotName:"typeHeader"}],availableFieldKeysGdp:[],rowFieldKeysGdp:["country","type"],colFieldKeysGdp:["year"],reducerGdp:(e,t)=>(t.type==="count"?e.count+=t.count:t.type==="gdp"&&(e.gdp+=t.gdp),e)}},methods:{countryCode(e){switch(e){case"Australia":return"au";case"China":return"cn";case"France":return"fr";case"India":return"in";case"United States":return"us"}},countryEmoji(e){const o=this.countryCode(e).toUpperCase().split("").map(n=>127397+n.charCodeAt());return String.fromCodePoint(...o)}},created(){this.isDataLoading=!0,setTimeout(()=>{this.asyncData=Q,this.isDataLoading=!1},300)}},at={class:"p16",style:{"--bin-border-base-radius":"0"}},lt={key:0,"aria-hidden":"true","data-prefix":"fas","data-icon":"venus",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 288 512",class:"svg-inline--fa fa-venus fa-fw",style:{width:"15px",height:"15px",position:"relative",top:"2px"}},rt={key:1,"aria-hidden":"true","data-prefix":"fas","data-icon":"mars",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",class:"svg-inline--fa fa-mars fa-fw",style:{width:"15px",height:"15px",position:"relative",top:"2px"}},ot={class:"p16"},st={key:0,"aria-hidden":"true","data-prefix":"fas","data-icon":"venus",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 288 512",class:"svg-inline--fa fa-venus fa-fw",style:{width:"15px",height:"15px",position:"relative",top:"2px"}},nt={key:1,"aria-hidden":"true","data-prefix":"fas","data-icon":"mars",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",class:"svg-inline--fa fa-mars fa-fw",style:{width:"15px",height:"15px",position:"relative",top:"2px"}},it={class:"p16"},dt={key:0},ut={key:1},ct={key:0,"aria-hidden":"true","data-prefix":"fas","data-icon":"venus",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 288 512",class:"svg-inline--fa fa-venus fa-fw",style:{width:"15px",height:"15px",position:"relative",top:"2px"}},pt={key:1,"aria-hidden":"true","data-prefix":"fas","data-icon":"mars",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",class:"svg-inline--fa fa-mars fa-fw",style:{width:"15px",height:"15px",position:"relative",top:"2px"}},yt={class:"p16"};function ft(e,t,o,n,s,d){const b=C("pivot"),w=C("b-collapse-wrap"),f=C("pivot-table"),m=C("pivot-doc"),c=C("page-wrapper");return l(),U(c,{title:"Pivot Table",desc:"交叉表，根据不同配置动态获取不同的表格显示。"},{default:p(()=>[y(w,{title:"Pivot (drag & drop UI + PivotTable)",shadow:"none",collapse:""},{default:p(()=>[u("div",at,[y(b,{data:s.data,fields:s.fields,"available-field-keys":s.availableFieldKeys,"row-field-keys":s.rowFieldKeys,"col-field-keys":s.colFieldKeys,reducer:s.reducer},{value:p(({value:a})=>[h(g(a.toLocaleString()),1)]),countryFlagHeader:p(({value:a})=>[h(g(d.countryEmoji(a)),1)]),countryNameHeader:p(({value:a})=>[h(g(a.replace(/\b\w/g,i=>i.toUpperCase())),1)]),genderHeader:p(({value:a})=>[a==="female"?(l(),r("svg",lt,t[0]||(t[0]=[u("path",{fill:"currentColor",d:"M288 176c0-79.5-64.5-144-144-144S0 96.5 0 176c0 68.5 47.9 125.9 112 140.4V368H76c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h36v36c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12v-36h36c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-36v-51.6c64.1-14.5 112-71.9 112-140.4zm-224 0c0-44.1 35.9-80 80-80s80 35.9 80 80-35.9 80-80 80-80-35.9-80-80z",class:""},null,-1)]))):a==="male"?(l(),r("svg",rt,t[1]||(t[1]=[u("path",{fill:"currentColor",d:"M372 64h-79c-10.7 0-16 12.9-8.5 20.5l16.9 16.9-80.7 80.7c-22.2-14-48.5-22.1-76.7-22.1C64.5 160 0 224.5 0 304s64.5 144 144 144 144-64.5 144-144c0-28.2-8.1-54.5-22.1-76.7l80.7-80.7 16.9 16.9c7.6 7.6 20.5 2.2 20.5-8.5V76c0-6.6-5.4-12-12-12zM144 384c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z",class:""},null,-1)]))):F("",!0),h(" "+g(a),1)]),_:1},8,["data","fields","available-field-keys","row-field-keys","col-field-keys","reducer"])])]),_:1}),y(w,{title:"PivotTable (standalone)",shadow:"none","model-value":!1,collapse:""},{default:p(()=>[u("div",ot,[y(f,{data:s.asyncData,"row-fields":s.rowFields,"col-fields":s.colFields,reducer:s.reducer,"default-show-settings":s.defaultShowSettings,"is-data-loading":s.isDataLoading},{value:p(({value:a})=>[h(g(a.toLocaleString()),1)]),countryFlagHeader:p(({value:a})=>[h(g(d.countryEmoji(a)),1)]),countryNameHeader:p(({value:a})=>[h(g(a.replace(/\b\w/g,i=>i.toUpperCase())),1)]),genderHeader:p(({value:a})=>[a==="female"?(l(),r("svg",st,t[2]||(t[2]=[u("path",{fill:"currentColor",d:"M288 176c0-79.5-64.5-144-144-144S0 96.5 0 176c0 68.5 47.9 125.9 112 140.4V368H76c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h36v36c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12v-36h36c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-36v-51.6c64.1-14.5 112-71.9 112-140.4zm-224 0c0-44.1 35.9-80 80-80s80 35.9 80 80-35.9 80-80 80-80-35.9-80-80z",class:""},null,-1)]))):a==="male"?(l(),r("svg",nt,t[3]||(t[3]=[u("path",{fill:"currentColor",d:"M372 64h-79c-10.7 0-16 12.9-8.5 20.5l16.9 16.9-80.7 80.7c-22.2-14-48.5-22.1-76.7-22.1C64.5 160 0 224.5 0 304s64.5 144 144 144 144-64.5 144-144c0-28.2-8.1-54.5-22.1-76.7l80.7-80.7 16.9 16.9c7.6 7.6 20.5 2.2 20.5-8.5V76c0-6.6-5.4-12-12-12zM144 384c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z",class:""},null,-1)]))):F("",!0),h(" "+g(a),1)]),_:1},8,["data","row-fields","col-fields","reducer","default-show-settings","is-data-loading"])])]),_:1}),y(w,{title:"Pivot with advanced reducer",shadow:"none","model-value":!1,collapse:""},{default:p(()=>[u("div",it,[y(b,{data:s.dataGdpFlattened,fields:s.fieldsGdp,"available-field-keys":s.availableFieldKeysGdp,"row-field-keys":s.rowFieldKeysGdp,"col-field-keys":s.colFieldKeysGdp,reducer:s.reducerGdp,"reducer-initial-value":{count:0,gdp:0},"default-show-settings":s.defaultShowSettings},{value:p(({value:a})=>[a.count?(l(),r("div",dt,g(a.count.toLocaleString()),1)):F("",!0),a.gdp?(l(),r("div",ut,g(a.gdp.toLocaleString()),1)):F("",!0)]),countryFlagHeader:p(({value:a})=>[h(g(d.countryEmoji(a)),1)]),countryNameHeader:p(({value:a})=>[h(g(a.replace(/\b\w/g,i=>i.toUpperCase())),1)]),typeHeader:p(({value:a})=>[a==="count"?(l(),r(v,{key:0},[h("Population")],64)):F("",!0),a==="gdp"?(l(),r(v,{key:1},[h("GDP")],64)):F("",!0)]),genderHeader:p(({value:a})=>[a==="female"?(l(),r("svg",ct,t[4]||(t[4]=[u("path",{fill:"currentColor",d:"M288 176c0-79.5-64.5-144-144-144S0 96.5 0 176c0 68.5 47.9 125.9 112 140.4V368H76c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h36v36c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12v-36h36c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-36v-51.6c64.1-14.5 112-71.9 112-140.4zm-224 0c0-44.1 35.9-80 80-80s80 35.9 80 80-35.9 80-80 80-80-35.9-80-80z",class:""},null,-1)]))):a==="male"?(l(),r("svg",pt,t[5]||(t[5]=[u("path",{fill:"currentColor",d:"M372 64h-79c-10.7 0-16 12.9-8.5 20.5l16.9 16.9-80.7 80.7c-22.2-14-48.5-22.1-76.7-22.1C64.5 160 0 224.5 0 304s64.5 144 144 144 144-64.5 144-144c0-28.2-8.1-54.5-22.1-76.7l80.7-80.7 16.9 16.9c7.6 7.6 20.5 2.2 20.5-8.5V76c0-6.6-5.4-12-12-12zM144 384c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z",class:""},null,-1)]))):F("",!0),h(" "+g(a),1)]),_:1},8,["data","fields","available-field-keys","row-field-keys","col-field-keys","reducer","default-show-settings"])])]),_:1}),y(w,{title:"Pivot Doc",shadow:"none","model-value":!1,collapse:""},{default:p(()=>[u("div",yt,[y(m)])]),_:1})]),_:1})}const wt=x(tt,[["render",ft]]);export{wt as default};
