import{a6 as M,b as j,ae as z,e as p,w as L,f as c,g as i,j as N,l as u,c as _,x as f,u as P,F as R,P as O,v as V,t as k,a2 as A,q as G,y as H,z as J,aa as I}from"./vendor-a6c5ad11.js";import{a as T}from"./chunk-bin-ui-next-1e71edb3.js";import{b as K,s as B,c as Q,g as W,e as X}from"./cross-tab-msg-0dc279e4.js";import{e as n,i as Y}from"./useData-1aba04b6.js";import{m as S}from"./index-f676c4c8.js";import"./chunk-brace-6f23dcf5.js";import"./chunk-mockjs-c013c588.js";const Z={class:"sheet-wrapper"},$={class:"sheet-header"},ee={class:"left"},ae={class:"right"},te={class:"sheet-excel"},se={key:0,class:"form-box"},oe={class:"mask"},ne=Object.assign({name:"DataEditSimple"},{__name:"index",setup(le){const E=j({get:()=>n.value.name,set:a=>n.value.name=a}),g=z(),C=p(!1),y=p(!1),U=p(!1),o=p({}),v=p(null);function q(){window.close()}function w(a){S(n.value.mapping).forEach(l=>{const{fieldName:s}=l;o.value[s]=a?a.data[s]:""}),a&&a.sheets&&(v.value=S(a.sheets))}async function F(){var a;try{y.value=!0;const e={id:(a=g.query.id)!=null?a:"",tempId:n.value.id,tempName:n.value.name,data:I(o.value)};if(v.value&&v.value[0]){e.sheets=I(v.value);const l=S(n.value.mapping),s=e.sheets[0].celldata||[];l.forEach(x=>{const{cellIndex:D,fieldName:h}=x,{column:m,row:r}=D,t=s.findIndex(d=>d.c===m&&d.r===r),b=o.value[h];t>-1&&(s[t].v.v=s[t].v.m=b,e.sheets[0].data[r][m].v=e.sheets[0].data[r][m].m=b)})}e.id===""?(await K(e),T.success("\u65B0\u589E\u6210\u529F!"),B("add-sheet-data",{...e}),w()):(await Q(e),T.success("\u4FEE\u6539\u6210\u529F!"),B("modify-sheet-data",{...e}))}catch(e){console.log(e)}y.value=!1}return L(()=>g.path,async()=>{const{tempId:a,id:e}=g.query;if(document.title="\u6570\u636E\u586B\u62A5",a){Y();const l=await W(a);if(n.value={...l},w(),e){const s=await X(e);w(s)}}C.value=!0},{immediate:!0}),(a,e)=>{const l=c("b-space"),s=c("b-icon"),x=c("b-input"),D=c("b-input-number"),h=c("b-form-item"),m=c("b-button"),r=c("b-form");return i(),N("div",Z,[u("div",$,[u("div",ee,[_(l,null,{default:f(()=>[u("h3",null,P(E.value),1)]),_:1})]),u("div",ae,[_(s,{type:"button",name:"close",color:"#f5222d",size:"24",onClick:q})])]),u("div",te,[C.value?(i(),N("div",se,[_(r,{"label-width":"100px",model:o.value},{default:f(()=>[(i(!0),N(R,null,O(A(n).mapping,(t,b)=>(i(),V(h,{key:b,prop:t.fieldName,label:t.fieldTitle},{default:f(()=>[t.dataType==="string"?(i(),V(x,{key:0,modelValue:o.value[t.fieldName],"onUpdate:modelValue":d=>o.value[t.fieldName]=d},null,8,["modelValue","onUpdate:modelValue"])):k("",!0),t.dataType==="number"?(i(),V(D,{key:1,modelValue:o.value[t.fieldName],"onUpdate:modelValue":d=>o.value[t.fieldName]=d},null,8,["modelValue","onUpdate:modelValue"])):k("",!0)]),_:2},1032,["prop","label"]))),128)),_(h,null,{default:f(()=>[_(m,{type:"primary",loading:y.value,onClick:F},{default:f(()=>[G("\u4FDD \u5B58")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):k("",!0)]),H(u("div",oe,"loading",512),[[J,U.value]])])}}}),_e=M(ne,[["__scopeId","data-v-3042ea40"]]);export{_e as default};
