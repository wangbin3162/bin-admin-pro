import{a8 as H,r as u,o as b,j as B,w as s,b as o,K as l,f as d,a as U,i as T,t as R,Q as J,F as Q,N as q,R as m}from"./vendor-B7whOB5j.js";import{n as F}from"./chunk-bin-ui-design-QY08qtjO.js";import"./chunk-brace-DF1jSkZr.js";const W={name:"FuncDynamicCode",setup(){const w=u([{key:"name",value:"Akko pc75b plus"},{key:"price",value:549},{key:"num",value:2},{key:"discount",value:.98},{key:"breaks",value:30}]),e=u("return `${name} 商品 ，单价${price} ，数量${num} ，总价: ${price*num}`;"),A=u(null),t=u(""),N=u(null),x=u([{name:"Akko pc75b plus",price:549,num:2,discount:1,total:null},{name:"Ciy 68 test",price:79,num:4,discount:1,total:null},{name:"Ganss HS87T",price:398,num:2,discount:.95,total:null},{name:"达尔优A84",price:629,num:2,discount:.9,total:null},{name:"FL cmk87",price:629,num:6,discount:.95,total:null},{name:"总计",price:0,num:0,discount:0,total:null}]),k=u(`const { price, num, discount } = goods;
 return price * num * discount;`),g=u(null),f=u(`{
  "name": "张三",
  "phone": "",
  "age": 17,
  "address": "江苏省徐州市云龙区"
}`),y=u(["phone","age"]),c=u(""),V=u(!1),C=u(`const validatPhone = phone.length > 0;
const validatAge = age > 18 && age < 35;
if(validatPhone && validatAge){
  return {
    result: true,
    message: '校验通过'
  };
} else {
  let message = '';
  if(!validatPhone) message += '[手机号不能为空]';
  if(!validatAge) message += '[年龄必须在18~35岁之间]';
  return{
    result: false,
    message
  };
}`),v=u({});function O(a,r){a.dataTransfer.setData("fieldName",r)}function D(a){const r=a.dataTransfer.getData("fieldName");w.value.findIndex(p=>p.key===r)===-1&&w.value.push({key:r,value:""}),console.log(r)}function P(a){a.preventDefault()}function S(){try{const a=A.value.getFunction(),r=w.value.map(i=>i.key!=="name"?Number(i.value):i.value);console.log(r),console.log(a);const p=a(...r);console.log(p),F.success("函数执行成功！"),t.value=p}catch{t.value="",F.error("函数执行失败，请检查函数体和入参是否书写正确！")}}function E({row:a,column:r,rowIndex:p,columnIndex:i}){if(p===x.value.length-1&&i===0)return[1,4];if(p===x.value.length-1&&i>0&&i<4)return[0,0]}function j(){try{const a=N.value.getFunction(),r=x.value;let p=0;for(let i=0;i<r.length-1;i++){const _=+a(r[i]).toFixed(2);p+=_,r[i].total=_}r[r.length-1].total=p,F.success("计算成功！")}catch{F.error("函数执行失败，请检查函数体和入参是否书写正确！")}}function n(){V.value=!0,c.value=""}function M(){const a=y.value;a.indexOf(c.value)===-1&&a.push(c.value),K()}function K(){V.value=!1,c.value=""}function z(a){y.value.splice(y.value.indexOf(a),1)}function L(){try{const a=g.value.getFunction(),r=[],p=y.value;for(let _=0;_<p.length;_++){const G=JSON.parse(f.value)[p[_]];r.push(G)}const i=a(...r);v.value={type:i.result?"success":"error",message:i.message},F(v.value)}catch{t.value="",F.error("函数执行失败，请检查函数体和入参是否书写正确！")}}return{fieldsEditRef:A,goodsEditRef:N,fieldsMapping:w,fieldsFuncBody:e,fieldsTitle:t,dragField:O,dropField:D,allowDrop:P,runTest1:S,runTest2:j,columns:[{title:"商品名称",key:"name"},{title:"商品单价",key:"price"},{title:"商品数量",key:"num"},{title:"折扣",key:"discount"},{title:"合计",key:"total"}],goodsData:x,goodsFuncBody:k,handleSpan:E,formObjStr:f,formParams:y,formAdded:V,formField:c,formFuncBody:C,formEditRef:g,formResult:v,addOne:n,blurAdd:M,blurCancel:K,handleCloseTag:z,runTest3:L}}},X={flex:""},Y={class:"p10",style:{width:"40%"}},Z={key:0,class:"tip"},I={class:"p10",style:{width:"60%"}},h={flex:""},$={class:"p10",style:{width:"70%"}},ee={class:"p10",style:{width:"30%"}},te={flex:""},ne={class:"p10",style:{width:"30%"}},le={class:"p10",style:{width:"30%"}},oe={key:0,class:"p10",style:{width:"30%"}};function se(w,e,A,t,N,x){const k=m("b-alert"),g=m("b-tag"),f=m("b-divider"),y=m("key-value-mapping"),c=m("b-button"),V=m("b-icon"),C=m("func-body-editor"),v=m("b-collapse-wrap"),O=m("b-table"),D=m("title-bar"),P=m("b-ace-editor"),S=m("b-input"),E=m("b-space"),j=m("page-wrapper");return b(),B(j,null,{desc:s(()=>e[13]||(e[13]=[o("div",null,"动态编写执行函数体，执行获取返回数据。",-1)])),default:s(()=>[l(v,{title:"基础动态编码",shadow:"none",class:"mb-16"},{default:s(()=>[o("div",X,[o("div",Y,[l(k,{"show-icon":""},{desc:s(()=>e[14]||(e[14]=[o("p",null,"选择字段拖入配置区域",-1),o("p",null,"填写配置，右侧会自动拼接函数参数。",-1)])),default:s(()=>[e[15]||(e[15]=d(" 动态指定字段名称 "))]),_:1}),o("div",null,[e[21]||(e[21]=d(" 字段候选 ")),l(g,{type:"primary",draggable:"true",onDragstart:e[0]||(e[0]=n=>t.dragField(n,"name"))},{default:s(()=>e[16]||(e[16]=[d(" name ")])),_:1}),l(g,{type:"info",draggable:"true",onDragstart:e[1]||(e[1]=n=>t.dragField(n,"price"))},{default:s(()=>e[17]||(e[17]=[d(" price ")])),_:1}),l(g,{type:"success",draggable:"true",onDragstart:e[2]||(e[2]=n=>t.dragField(n,"num"))},{default:s(()=>e[18]||(e[18]=[d("num")])),_:1}),l(g,{type:"warning",draggable:"true",onDragstart:e[3]||(e[3]=n=>t.dragField(n,"discount"))},{default:s(()=>e[19]||(e[19]=[d(" discount ")])),_:1}),l(g,{type:"danger",draggable:"true",onDragstart:e[4]||(e[4]=n=>t.dragField(n,"breaks"))},{default:s(()=>e[20]||(e[20]=[d(" breaks ")])),_:1})]),l(f,{style:{margin:"10px 0"}}),o("div",{class:"drop-wrapper",onDrop:e[6]||(e[6]=n=>t.dropField(n)),onDragover:e[7]||(e[7]=n=>t.allowDrop(n))},[t.fieldsMapping.length===0?(b(),U("p",Z,"拖动字段到此处进行配置")):T("",!0),l(y,{modelValue:t.fieldsMapping,"onUpdate:modelValue":e[5]||(e[5]=n=>t.fieldsMapping=n),"show-add":!1},null,8,["modelValue"])],32),l(f,{style:{margin:"10px 0"}}),l(c,{type:"primary",onClick:t.runTest1},{default:s(()=>e[22]||(e[22]=[d("执行计算")])),_:1},8,["onClick"]),l(f,{style:{margin:"10px 0"}}),t.fieldsTitle?(b(),B(k,{key:0,type:"success","show-icon":""},{desc:s(()=>[d(R(t.fieldsTitle),1)]),default:s(()=>[e[23]||(e[23]=d(" 执行计算成功 "))]),_:1})):T("",!0)]),o("div",I,[l(k,{"show-icon":""},{icon:s(()=>[l(V,{name:"codelibrary"})]),desc:s(()=>e[24]||(e[24]=[o("p",null,"函数体入参根据配置传入，内部可直接使用，输入自定义计算函数并返回即可。",-1),o("p",null,"函数体内代码遵循js编写规范，内有代码提示，如代码编写错误则执行计算时会报错。",-1)])),default:s(()=>[e[25]||(e[25]=d(" 计算函数 "))]),_:1}),l(C,{ref:"fieldsEditRef",modelValue:t.fieldsFuncBody,"onUpdate:modelValue":e[8]||(e[8]=n=>t.fieldsFuncBody=n),augments:t.fieldsMapping.map(n=>n.key)},null,8,["modelValue","augments"]),l(f,{style:{margin:"10px 0"}}),e[26]||(e[26]=o("div",{class:"example"},[d(" 示例代码： "),o("p",null,"拼接字符串："),o("p",{style:{"padding-left":"8px"}}," return `${name} 商品 ，单价${price} ，数量${num} ，总价: ${price*num}`; "),o("p",null,"返回布尔值："),o("p",{style:{"padding-left":"8px"}},"return (price * num) * discount >= 200"),o("p",null,"复杂计算逻辑："),o("p",{style:{"padding-left":"8px"}},"// 如果有折扣则计算折扣后总价"),o("p",{style:{"padding-left":"8px"}}," const total = discount? price * num * discount : price * num; "),o("p",{style:{"padding-left":"8px"}},"// 判断是否符合满减政策，如满200-30"),o("p",{style:{"padding-left":"8px"}}," const totalPrice = total >= 200&&breaks ? total - breaks : total; "),o("p",{style:{"padding-left":"8px"}},"// 输出最终结果"),o("p",{style:{"padding-left":"8px"}}," return `您购买了${name}，单价${price}，数量${num}，最终价格: ${totalPrice}` ")],-1))])])]),_:1}),l(v,{title:"表格类方式调用",shadow:"none",class:"mb-16"},{default:s(()=>[o("div",h,[o("div",$,[l(O,{columns:t.columns,data:t.goodsData,border:"","merge-method":t.handleSpan,size:"small"},null,8,["columns","data","merge-method"])]),o("div",ee,[l(D,{title:"商品计算函数","tip-pos":"left"}),e[28]||(e[28]=d(" tip: 这里采用对象传入的方式进行传参 ")),l(C,{ref:"goodsEditRef",modelValue:t.goodsFuncBody,"onUpdate:modelValue":e[9]||(e[9]=n=>t.goodsFuncBody=n),augments:["goods"]},null,8,["modelValue"]),l(f,{style:{margin:"10px 0"}}),l(c,{type:"primary",onClick:t.runTest2},{default:s(()=>e[27]||(e[27]=[d("执行计算")])),_:1},8,["onClick"])])])]),_:1}),l(v,{title:"用于校验函数",shadow:"none",class:"mb-16"},{default:s(()=>[o("div",te,[o("div",ne,[l(P,{modelValue:t.formObjStr,"onUpdate:modelValue":e[10]||(e[10]=n=>t.formObjStr=n)},null,8,["modelValue"])]),o("div",le,[l(D,{title:"校验函数","tip-pos":"left",class:"mb-10"}),l(E,null,{default:s(()=>[l(c,{size:"mini",onClick:t.addOne},{default:s(()=>e[29]||(e[29]=[d("新增校验字段")])),_:1},8,["onClick"]),(b(!0),U(Q,null,J(t.formParams,n=>(b(),B(g,{key:n,type:"primary",closable:"",onClose:M=>t.handleCloseTag(n)},{default:s(()=>[d(R(n),1)]),_:2},1032,["onClose"]))),128)),t.formAdded?(b(),B(S,{key:0,style:{width:"100px"},size:"mini",modelValue:t.formField,"onUpdate:modelValue":e[11]||(e[11]=n=>t.formField=n),onKeydown:q(t.blurAdd,["enter"]),onBlur:t.blurCancel},null,8,["modelValue","onKeydown","onBlur"])):T("",!0)]),_:1}),l(f,{style:{margin:"10px 0"}}),l(C,{ref:"formEditRef",modelValue:t.formFuncBody,"onUpdate:modelValue":e[12]||(e[12]=n=>t.formFuncBody=n),augments:t.formParams,height:"240"},null,8,["modelValue","augments"]),l(f,{style:{margin:"10px 0"}}),l(c,{type:"primary",onClick:t.runTest3},{default:s(()=>e[30]||(e[30]=[d("执行校验")])),_:1},8,["onClick"])]),t.formResult.type?(b(),U("div",oe,[l(k,{type:t.formResult.type,"show-icon":""},{desc:s(()=>[d(R(t.formResult.message),1)]),default:s(()=>[d(R(t.formResult.type==="success"?"验证成功":"验证失败")+" ",1)]),_:1},8,["type"])])):T("",!0)])]),_:1})]),_:1})}const ue=H(W,[["render",se],["__scopeId","data-v-de882adc"]]);export{ue as default};
