import{a8 as q,ag as E,Q as k,o as b,a as M,b as p,K as v,w as g,t as O,L as l,j as N,i as V,f as D,g as T,v as A,a9 as K,aa as P,r as Q,n as R}from"./vendor-CoKaFqDy.js";import{b as $,s as C,c as F,g as G,d as H}from"./cross-tab-msg-D-hvLo0Z.js";import{u as J,d as U,e as s,i as W}from"./useData-DFu-Bvvp.js";import{n as I}from"./chunk-bin-ui-design-DTQlNCOT.js";import{i as y}from"./index-Dk_VZS5h.js";import{I as X}from"./env-CxIDJ12h.js";import"./chunk-brace-BklEY0pF.js";import"./chunk-mockjs-CGXE1Baq.js";const Y=i=>(K("data-v-00c54bf1"),i=i(),P(),i),Z={class:"sheet-wrapper"},ee={class:"sheet-header"},te={class:"left"},ae={class:"right"},se=Y(()=>p("div",{id:"SheetContainer",class:"sheet-excel has-config"},null,-1)),oe={class:"mask"},ce={__name:"SheetEdit",props:{cfg:{type:Object,default:()=>({})}},setup(i){const d=window.luckysheet,f=i,{title:w,btnLoading:t,isMaskShow:o,closePage:r,downloadExcel:u}=J(f),m=E();async function S(){try{t.value=!0;const a=y(s.value.mapping),c={};a.forEach(h=>{const{cellIndex:_,fieldName:j}=h,{row:B,column:z}=_,L=d.getCellValue(B,z);c[j]=L});const n=d.getAllSheets(),e={id:m.query.id??"",tempId:s.value.id,tempName:s.value.name,data:c,sheets:n};e.id===""?(await $(e),I.success("新增成功!"),C("add-sheet-data",{...e}),x()):(await F(e),I.success("修改成功!"),C("modify-sheet-data",{...e}))}catch(a){console.log(a)}t.value=!1}function x(){try{t.value=!0,y(s.value.mapping).forEach(c=>{const{cellIndex:n}=c,{row:e,column:h}=n;d.setCellValue(e,h,"")})}catch(a){console.log(a)}t.value=!1}return(a,c)=>{const n=k("b-space"),e=k("b-button");return b(),M("div",Z,[p("div",ee,[p("div",te,[v(n,null,{default:g(()=>[p("h3",null,O(l(w)),1)]),_:1})]),p("div",ae,[l(X)?(b(),N(e,{key:0,type:"text",icon:"bug","text-color":"danger",title:"打印调试",onClick:l(U)},null,8,["onClick"])):V("",!0),v(e,{type:"primary",size:"small",icon:"download",plain:"",onClick:l(u)},{default:g(()=>[D(" 下载模板 ")]),_:1},8,["onClick"]),v(e,{type:"primary",size:"small",icon:"save",loading:l(t),onClick:S},{default:g(()=>[D(" 保存 ")]),_:1},8,["loading"]),v(e,{type:"danger",size:"small",icon:"close",onClick:l(r)},{default:g(()=>[D("关闭")]),_:1},8,["onClick"])])]),se,T(p("div",oe,"loading",512),[[A,l(o)]])])}}},ne=q(ce,[["__scopeId","data-v-00c54bf1"]]),fe=Object.assign({name:"DataEdit"},{__name:"index",setup(i){const d=E(),f=Q(!1);function w(t){var u;if(t.sheets){s.value.jsonData.sheets=y(t.sheets);return}const o=y(s.value.mapping),r=(u=s.value.jsonData)==null?void 0:u.sheets[0];if(r){const m=r.celldata||[];o.forEach(S=>{const{cellIndex:x,fieldName:a}=S,{column:c,row:n}=x,e=m.findIndex(_=>_.c===c&&_.r===n),h=t.data[a];e>-1&&(m[e].v.v=m[e].v.m=h)})}}return R(()=>d.path,async()=>{const{tempId:t,id:o}=d.query;if(document.title="数据填报",t){W();const r=await G(t);if(s.value={...r},o){const u=await H(o);w(u)}}f.value=!0},{immediate:!0}),(t,o)=>f.value?(b(),N(ne,{key:0})):V("",!0)}});export{fe as default};
