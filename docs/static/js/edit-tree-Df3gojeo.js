import{n as V,c as M}from"./chunk-bin-ui-design-DOxaRq58.js";import{v as B,w as H,i as G,r as J}from"./index-CtCeQG2m.js";import{r as b,l as Q,m as W,p as X,q as Y,Q as i,o as h,j as C,w as a,b as w,H as Z,K as o,a as $,t as A,f as E,i as D,e as ee,h as K,a8 as te,a9 as ne,aa as ae,G as z}from"./vendor-B29aizbt.js";import"./chunk-brace-BklEY0pF.js";import"./chunk-mockjs-CGXE1Baq.js";const F=b(new Map);function oe(){F.value.clear()}function q(){const e=[...F.value.values()];return new Promise(c=>{const d=[];e.forEach(t=>{t&&t.validate&&d.push(t.validate())}),console.log("------- valid EditTree allNode Form -------"),console.log(e,d),console.log("-------------------------------------------"),Promise.all(d).then(async t=>{c(t.every(p=>p))})})}const le={style:{width:"calc(100% - 75px - 600px)"}},re={class:"title"},de={key:1,class:"label"},se={class:"input",style:{width:"600px",padding:"0 4px"}},ie={style:{width:"340px"}},ce={key:1,class:"label"},pe={style:{width:"240px"}},ue={href:"javascript:void(0)",class:"f-s-12 pl-8 pr-8",style:{"line-height":"32px"}},me={key:1,class:"label"},fe={key:0,class:"ctrl",style:{width:"75px","line-height":"32px",padding:"0 4px"},flex:"main:right"},L=Object.assign({name:"RenderNode"},{__name:"RenderNode",props:{root:{type:Array,default:()=>[]},node:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!0}},emits:["append","append-level","import","remove"],setup(e,{emit:c}){const d=c,t=e,p=Q(()=>t.node.parents?t.node.parents.length:0),x=W({name:[{required:!0,message:"必填项",trigger:"blur"},{validator:async(I,y,r)=>{/^[A-z_;]+\w*$/.test(y)?r():r(new Error("名称只能以_或字母开头"))},trigger:"blur"},{validator:async(I,y,r)=>{const m=t.node.parent;m===void 0?t.root.filter(g=>g.parent===void 0).map(g=>g.node).findIndex(g=>g.parent!==t.data.parent&&g.name===t.data.name)>-1&&r(new Error("同层级存在同名参数！")):t.root[m].node.children.findIndex(g=>g.parent!==t.data.parent&&g.name===t.data.name)>-1&&r(new Error("同层级存在同名参数！")),r()},trigger:"blur"}]}),_=b(null);function j(I){t.data.paramType=I}return X(()=>{t.isEdit&&F.value.set(t.data.parent,_.value)}),Y(()=>{t.isEdit&&F.value.delete(t.data.parent)}),(I,y)=>{const r=i("b-input"),m=i("b-form-item"),s=i("b-dropdown-item"),g=i("b-dropdown-menu"),T=i("b-dropdown"),n=i("b-space"),l=i("b-icon"),f=i("b-form");return h(),C(f,{model:e.data,rules:x,ref_key:"formRef",ref:_},{default:a(()=>[w("div",{class:Z(["custom-render-node",[`node-level-${p.value}`,`node_${e.data.parent}`]])},[w("div",le,[w("div",re,[e.isEdit?(h(),C(m,{key:0,prop:"name"},{default:a(()=>[o(r,{modelValue:e.data.name,"onUpdate:modelValue":y[0]||(y[0]=u=>e.data.name=u),placeholder:"参数名称"},null,8,["modelValue"])]),_:1})):(h(),$("label",de,A(e.data.name),1))])]),w("div",se,[o(n,null,{default:a(()=>[w("div",ie,[e.isEdit?(h(),C(r,{key:0,modelValue:e.data.des,"onUpdate:modelValue":y[1]||(y[1]=u=>e.data.des=u),placeholder:"参数说明"},null,8,["modelValue"])):(h(),$("label",ce,A(e.data.des||"--"),1))]),w("div",pe,[e.isEdit?(h(),C(T,{key:0,onCommand:j,placement:"right-start"},{dropdown:a(()=>[o(g,null,{default:a(()=>{var u,k;return[o(s,{name:"Object"},{default:a(()=>[E("Object")]),_:1}),o(s,{name:"Array"},{default:a(()=>[E("Array")]),_:1}),o(s,{name:"String",disabled:((u=e.data.children)==null?void 0:u.length)>0,title:((k=e.data.children)==null?void 0:k.length)>0?"已有子节点，不可设置为String类型":""},{default:a(()=>[E(" String ")]),_:1},8,["disabled","title"])]}),_:1})]),default:a(()=>[w("a",ue,A(e.data.paramType),1)]),_:1})):(h(),$("label",me,A(e.data.paramType),1))])]),_:1})]),e.isEdit?(h(),$("div",fe,[e.data.paramType==="Array"?(h(),C(l,{key:0,name:"Storedprocedure",type:"button",color:"var(--bin-color-warning)",title:"批量导入",onClick:y[2]||(y[2]=u=>d("import"))})):D("",!0),o(T,{onCommand:y[3]||(y[3]=u=>d(u))},{dropdown:a(()=>[o(g,null,{default:a(()=>[o(s,{name:"append-level"},{default:a(()=>[E("增加同级节点")]),_:1}),e.data.paramType!=="String"?(h(),C(s,{key:0,name:"append"},{default:a(()=>[E(" 增加子节点 ")]),_:1})):D("",!0)]),_:1})]),default:a(()=>[o(l,{name:"plus-circle",type:"button",color:"var(--bin-color-success)"})]),_:1}),o(l,{name:"minus-circle",type:"button",color:"var(--bin-color-danger)",title:"移除当前节点",onClick:y[4]||(y[4]=u=>d("remove"))})])):D("",!0)],2)]),_:1},8,["model","rules"])}}}),ve={class:"edit-tree-container"},_e={class:"edit-tree-header"},ye=w("span",{class:"f-s-12"},"增加根节点",-1),ge={class:"edit-tree-content"},he=Object.assign({name:"EditTree"},{__name:"index",props:{data:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!0}},emits:["appendRootNode","import","appendNode","appendLevelNode","removeNode"],setup(e,{expose:c,emit:d}){const t=d,p=e,v=b(null);function N({root:r,node:m,data:s}){return K(L,{root:r,node:m,data:s,onAppend:()=>{t("appendNode",s)},onAppendLevel:()=>{t("appendLevelNode",r,m,s)},onRemove:()=>{t("removeNode",r,m,s)},onImport:()=>{t("import",s)}})}function x({root:r,node:m,data:s}){return K(L,{root:r,node:m,data:s,isEdit:p.isEdit})}let _=!0;function j(r,m,s){return!(!v.value||!_||(v.value.getFlatState()[m.nodeKey].parents||[]).indexOf(r.nodeKey)>-1||s==="inner"&&m.paramType==="String")}function I(){return v.value.getFlatState()}async function y(r,m){_=await q()}return c({getFlatState:I}),(r,m)=>{const s=i("b-tag"),g=i("b-button"),T=i("b-tree");return h(),$("div",ve,[w("div",_e,[ee(r.$slots,"header",{},()=>[o(s,{type:"primary"},{default:a(()=>[E("返回响应")]),_:1}),e.isEdit?(h(),C(g,{key:0,type:"success",size:"mini",plain:"",icon:"plus",onClick:m[0]||(m[0]=n=>t("appendRootNode"))},{default:a(()=>[ye]),_:1})):D("",!0)])]),w("div",ge,[e.isEdit?(h(),C(T,{key:0,data:e.data,render:N,"allow-drop":j,style:{"min-width":"1000px"},ref_key:"treeRef",ref:v,draggable:"","default-expand":"","lock-select":"",onNodeDragStart:y},null,8,["data"])):(h(),C(T,{key:1,data:e.data,render:x,style:{"min-width":"1000px"},ref_key:"treeRef",ref:v,"default-expand":"","lock-select":""},null,8,["data"]))])])}}});function U(e){const c=document.querySelector(".edit-tree-container .edit-tree-content");if(c)if(e){const d=document.querySelector(`.edit-tree-container .node_${e.parent}`);d&&B(c,c.scrollTop,d.offsetTop)}else B(c,c.scrollTop,c.scrollHeight)}function be(e=[]){if(!Array.isArray(e)||e.length===0)return[];let c=[],d={};return e.forEach((t,p)=>{d[t.parent]=p}),e.forEach(t=>{t.children=[];const p=t.belongParent;if(p){let v=e[d[p]].children;Array.isArray(v)?v.push(t):v=[t]}else c.push(t)}),c}function we(e=[]){const c=[];for(let d=0;d<e.length;d++){const t=e[d],p=t.node,v=t.parent>-1?e[t.parent].node.parent:"",N=t.parents??[],x=[];N.forEach(_=>x.push(e[_].node.name)),c.push({belongParent:v,parent:p.parent,name:p.name,des:p.des,paramType:t.node.paramType,parentName:x.join(","),level:N.length+1,sort:d})}return c}const Ne=e=>(ne("data-v-76a5f8f5"),e=e(),ae(),e),xe={class:"paster-wrap"},Ie=Ne(()=>w("div",{flex:"main:justify cross:center"},[w("span",null,"示例")],-1)),ke={class:"example-wrap"},Te={class:"code"},Se={key:0,class:"tip"},Ee={name:"JsonPaster"},Ce=Object.assign(Ee,{props:{title:{type:String,default:"Json转换"},normalText:{type:String,default:"请复制Json中的数据内容，粘贴至下方区域"},tip:{type:String}},emits:["ok"],setup(e,{expose:c,emit:d}){const t=d,p=b(!1),v=b(""),N=b([]),x=b(!1),_=b(`[
    "fgroup_fname",
    "fbr",
    "fitemid",
    "fname",
    "fnumber",
    "fcompany",
    "fclassid",
    "ffullname",
    "ffullnumber"
]`),j=b(0),I=b({});function y(n,l){j.value=n,I.value=l,r(),p.value=!0}function r(){v.value="",N.value=[]}function m(n){H(n)||(N.value=G(n),v.value=JSON.stringify(n,null,2))}function s(){x.value=!0,N.value.length?t("ok",N.value,j.value,I.value):V.error("请复制粘贴正确内容后提交数据！"),x.value=!1}function g(n){try{N.value=JSON.parse(n)}catch{}}function T(){p.value=!1}return c({open:y,setformatData:m,handleClose:T,initData:r}),(n,l)=>{const f=i("b-alert"),u=i("b-ace-editor"),k=i("highlightjs"),R=i("b-card"),S=i("b-button"),O=i("b-modal");return h(),$("div",null,[o(O,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=P=>p.value=P),title:e.title,width:"600","mask-closable":!1},{footer:a(()=>[o(S,{onClick:T},{default:a(()=>[E("取 消")]),_:1}),o(S,{type:"primary",onClick:s,loading:x.value},{default:a(()=>[E("确 定")]),_:1},8,["loading"])]),default:a(()=>[o(f,{"show-icon":""},{default:a(()=>[E(A(e.normalText),1)]),_:1}),w("div",xe,[o(u,{modelValue:v.value,"onUpdate:modelValue":l[0]||(l[0]=P=>v.value=P),onChange:g},null,8,["modelValue"]),o(R,{class:"box-card",width:"480px","head-tip":"",shadow:"never"},{header:a(()=>[Ie]),default:a(()=>[w("div",ke,[w("div",Te,[o(k,{language:"json",code:_.value},null,8,["code"])])])]),_:1})]),e.tip?(h(),$("p",Se,A(e.tip),1)):D("",!0)]),_:1},8,["modelValue","title"])])}}}),je=te(Ce,[["__scopeId","data-v-76a5f8f5"]]),Re={class:"p16"},De=Object.assign({name:"EditTree"},{__name:"edit-tree",setup(e){oe();const c=b(null),d=b(null),t=b(null),p=b(null);function v(){var f;const n=d.value.getFlatState(),l=we(n);(f=p.value)==null||f.show(l)}async function N(){await q()?V.success("校验成功！"):V.error("校验失败，请检查错误！")}const x=b([{belongParent:"",parent:"id-00",des:"根节点",name:"data",paramType:"Object",parentName:"",paramId:"paramId-00",interfaceId:"interfaceId-00",level:"1",sort:"0"},{belongParent:"id-00",parent:"id-00-00",des:"类别",name:"category",paramType:"Object",parentName:"data",paramId:"paramId-01",interfaceId:"interfaceId-00",level:"2",sort:"1"},{belongParent:"id-00-00",parent:"id-00-00-00",des:"说明",name:"text",paramType:"String",parentName:"data.category",paramId:"paramId-02",interfaceId:"interfaceId-00",level:"3",sort:"2"},{belongParent:"id-00",parent:"id-00-01",des:"名称",name:"name",paramType:"String",parentName:"data",paramId:"paramId-03",interfaceId:"interfaceId-00",level:"2",sort:"3"},{belongParent:"id-00",parent:"id-00-02",des:"id",name:"id",paramType:"String",parentName:"data",paramId:"paramId-04",interfaceId:"interfaceId-00",level:"2",sort:"4"},{belongParent:"",parent:"id-01",des:"根节点2",name:"data2",paramType:"Object",parentName:"",paramId:"paramId-05",interfaceId:"interfaceId-00",level:"1",sort:"5"}]),_=b([]);_.value=be(x.value);function j(){const n={parent:J(),name:"",des:"",paramType:"String"};_.value.push(n),z(()=>U(null))}function I(n,l=""){const f=n.children||[];n.expand=!0;const u={parent:J(),name:l,des:"",paramType:"String"};f.push(u),n.children=f,_.value=[..._.value],z(()=>U(u))}function y(n,l){var u;const f=n.find(k=>k===l).parent;if(f>-1){const k=(u=n.find(R=>R.nodeKey===f))==null?void 0:u.node;I(k)}else j()}async function r(n){return new Promise(l=>{n==="String"?l(!0):M.confirm({type:"warning",title:"提示",message:'<p>确定要<span style="color:red;">移除</span>当前节点吗？子节点会一并移除！</p>',useHTML:!0}).then(()=>l(!0)).catch(()=>l(!1))})}async function m(n,l,f){var k;if(await r(f.paramType)){const R=n.find(S=>S===l).parent;if(R>-1){const S=(k=n.find(P=>P.nodeKey===R))==null?void 0:k.node,O=S.children.indexOf(f);S.children.splice(O,1)}else{const S=_.value.indexOf(f);_.value.splice(S,1)}V({type:"success",message:"移除成功!"})}}let s=null;function g(n){s=n,t.value.open()}function T(n){var l;n.forEach(f=>{I(s,f)}),V.success("导入成功"),(l=t.value)==null||l.handleClose()}return(n,l)=>{const f=i("b-button"),u=i("debug-modal"),k=i("b-space"),R=i("b-form"),S=i("b-collapse-wrap"),O=i("page-wrapper");return h(),C(O,{desc:"编辑树表，实际开发时可能会根据实际情况进行组件定义和使用。"},{default:a(()=>[o(S,{title:"编辑树表",shadow:"none"},{right:a(()=>[o(k,{size:16},{default:a(()=>[o(u,{ref_key:"transDataRef",ref:p},{default:a(()=>[o(f,{type:"primary",size:"mini",plain:"",onClick:v},{default:a(()=>[E(" 转换数据结构 ")]),_:1})]),_:1},512),o(f,{type:"warning",size:"mini",plain:"",onClick:N},{default:a(()=>[E("校验错误")]),_:1}),o(u,{data:{treeData:_.value,testData:x.value}},null,8,["data"])]),_:1})]),default:a(()=>[w("div",Re,[o(R,{model:_.value,ref_key:"formRef",ref:c},{default:a(()=>[o(he,{data:_.value,ref_key:"editTreeRef",ref:d,onImport:g,onAppendRootNode:j,onAppendNode:I,onAppendLevelNode:y,onRemoveNode:m},null,8,["data"])]),_:1},8,["model"])])]),_:1}),o(je,{ref_key:"jsonPasterRef",ref:t,title:"响应参数批量添加",tip:"",onOk:T},null,512)]),_:1})}}});export{De as default};
