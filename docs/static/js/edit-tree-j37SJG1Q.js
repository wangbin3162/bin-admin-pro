import{n as V,c as M}from"./chunk-bin-ui-design-CMJ2EfEK.js";import{v as B,w as H,i as G,r as J}from"./index-dssKf-7O.js";import{r as b,l as Q,m as W,p as X,q as Y,Q as p,o as y,j,w as a,b as g,H as Z,K as l,a as $,t as A,f as k,i as D,e as ee,h as K,a8 as te,a9 as ne,aa as ae,G as z}from"./vendor-B29aizbt.js";import"./chunk-brace-BklEY0pF.js";import"./chunk-mockjs-CGXE1Baq.js";const F=b(new Map);function oe(){F.value.clear()}function q(){const e=[...F.value.values()];return new Promise(u=>{const d=[];e.forEach(t=>{t&&t.validate&&d.push(t.validate())}),console.log("------- valid EditTree allNode Form -------"),console.log(e,d),console.log("-------------------------------------------"),Promise.all(d).then(async t=>{u(t.every(m=>m))})})}const re={style:{width:"calc(100% - 75px - 600px)"}},le={class:"title"},de={key:1,class:"label"},se={class:"input",style:{width:"600px",padding:"0 4px"}},ie={style:{width:"340px"}},ce={key:1,class:"label"},pe={style:{width:"240px"}},ue={href:"javascript:void(0)",class:"f-s-12 pl-8 pr-8",style:{"line-height":"32px"}},me={key:1,class:"label"},fe={key:0,class:"ctrl",style:{width:"75px","line-height":"32px",padding:"0 4px"},flex:"main:right"},L=Object.assign({name:"RenderNode"},{__name:"RenderNode",props:{root:{type:Array,default:()=>[]},node:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!0}},emits:["append","append-level","import","remove"],setup(e,{emit:u}){const d=u,t=e,m=Q(()=>t.node.parents?t.node.parents.length:0),N=W({name:[{required:!0,message:"必填项",trigger:"blur"},{validator:async(T,i,h)=>{/^[A-z_;]+\w*$/.test(i)?h():h(new Error("名称只能以_或字母开头"))},trigger:"blur"},{validator:async(T,i,h)=>{const f=t.node.parent;f===void 0?t.root.filter(o=>o.parent===void 0).map(o=>o.node).findIndex(o=>o.parent!==t.data.parent&&o.name===t.data.name)>-1&&h(new Error("同层级存在同名参数！")):t.root[f].node.children.findIndex(o=>o.parent!==t.data.parent&&o.name===t.data.name)>-1&&h(new Error("同层级存在同名参数！")),h()},trigger:"blur"}]}),_=b(null);return X(()=>{t.isEdit&&F.value.set(t.data.parent,_.value)}),Y(()=>{t.isEdit&&F.value.delete(t.data.parent)}),(T,i)=>{const h=p("b-input"),f=p("b-form-item"),c=p("b-dropdown-item"),o=p("b-dropdown-menu"),C=p("b-dropdown"),S=p("b-space"),n=p("b-icon"),s=p("b-form");return y(),j(s,{model:e.data,rules:N,ref_key:"formRef",ref:_},{default:a(()=>[g("div",{class:Z(["custom-render-node",[`node-level-${m.value}`,`node_${e.data.parent}`]])},[g("div",re,[g("div",le,[e.isEdit?(y(),j(f,{key:0,prop:"name"},{default:a(()=>[l(h,{modelValue:e.data.name,"onUpdate:modelValue":i[0]||(i[0]=r=>e.data.name=r),placeholder:"参数名称"},null,8,["modelValue"])]),_:1})):(y(),$("label",de,A(e.data.name),1))])]),g("div",se,[l(S,null,{default:a(()=>[g("div",ie,[e.isEdit?(y(),j(h,{key:0,modelValue:e.data.des,"onUpdate:modelValue":i[1]||(i[1]=r=>e.data.des=r),placeholder:"参数说明"},null,8,["modelValue"])):(y(),$("label",ce,A(e.data.des||"--"),1))]),g("div",pe,[e.isEdit?(y(),j(C,{key:0,onCommand:i[2]||(i[2]=r=>e.data.paramType=r),placement:"right-start"},{dropdown:a(()=>[l(o,null,{default:a(()=>[l(c,{name:"Object"},{default:a(()=>[k("Object")]),_:1}),l(c,{name:"Array"},{default:a(()=>[k("Array")]),_:1}),l(c,{name:"String"},{default:a(()=>[k("String")]),_:1})]),_:1})]),default:a(()=>[g("a",ue,A(e.data.paramType),1)]),_:1})):(y(),$("label",me,A(e.data.paramType),1))])]),_:1})]),e.isEdit?(y(),$("div",fe,[e.data.paramType==="Array"?(y(),j(n,{key:0,name:"Storedprocedure",type:"button",color:"var(--bin-color-warning)",title:"批量导入",onClick:i[3]||(i[3]=r=>d("import"))})):D("",!0),l(C,{onCommand:i[4]||(i[4]=r=>d(r))},{dropdown:a(()=>[l(o,null,{default:a(()=>[l(c,{name:"append-level"},{default:a(()=>[k("增加同级节点")]),_:1}),e.data.paramType!=="String"?(y(),j(c,{key:0,name:"append"},{default:a(()=>[k(" 增加子节点 ")]),_:1})):D("",!0)]),_:1})]),default:a(()=>[l(n,{name:"plus-circle",type:"button",color:"var(--bin-color-success)"})]),_:1}),l(n,{name:"minus-circle",type:"button",color:"var(--bin-color-danger)",title:"移除当前节点",onClick:i[5]||(i[5]=r=>d("remove"))})])):D("",!0)],2)]),_:1},8,["model","rules"])}}}),ve={class:"edit-tree-container"},_e={class:"edit-tree-header"},ye=g("span",{class:"f-s-12"},"增加根节点",-1),be={class:"edit-tree-content"},ge=Object.assign({name:"EditTree"},{__name:"index",props:{data:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!0}},emits:["appendRootNode","import","appendNode","appendLevelNode","removeNode"],setup(e,{expose:u,emit:d}){const t=d,m=e,v=b(null);function w({root:f,node:c,data:o}){return K(L,{root:f,node:c,data:o,onAppend:()=>{t("appendNode",o)},onAppendLevel:()=>{t("appendLevelNode",f,c,o)},onRemove:()=>{t("removeNode",f,c,o)},onImport:()=>{t("import",o)}})}function N({root:f,node:c,data:o}){return K(L,{root:f,node:c,data:o,isEdit:m.isEdit})}let _=!0;function T(f,c,o){return!(!v.value||!_||(v.value.getFlatState()[c.nodeKey].parents||[]).indexOf(f.nodeKey)>-1||o==="inner"&&c.paramType==="String")}function i(){return v.value.getFlatState()}async function h(f,c){_=await q()}return u({getFlatState:i}),(f,c)=>{const o=p("b-tag"),C=p("b-button"),S=p("b-tree");return y(),$("div",ve,[g("div",_e,[ee(f.$slots,"header",{},()=>[l(o,{type:"primary"},{default:a(()=>[k("返回响应")]),_:1}),e.isEdit?(y(),j(C,{key:0,type:"success",size:"mini",plain:"",icon:"plus",onClick:c[0]||(c[0]=n=>t("appendRootNode"))},{default:a(()=>[ye]),_:1})):D("",!0)])]),g("div",be,[e.isEdit?(y(),j(S,{key:0,data:e.data,render:w,"allow-drop":T,style:{"min-width":"1000px"},ref_key:"treeRef",ref:v,draggable:"","default-expand":"","lock-select":"",onNodeDragStart:h},null,8,["data"])):(y(),j(S,{key:1,data:e.data,render:N,style:{"min-width":"1000px"},ref_key:"treeRef",ref:v,"default-expand":"","lock-select":""},null,8,["data"]))])])}}});function U(e){const u=document.querySelector(".edit-tree-container .edit-tree-content");if(u)if(e){const d=document.querySelector(`.edit-tree-container .node_${e.parent}`);d&&B(u,u.scrollTop,d.offsetTop)}else B(u,u.scrollTop,u.scrollHeight)}function he(e=[]){if(!Array.isArray(e)||e.length===0)return[];let u=[],d={};return e.forEach((t,m)=>{d[t.parent]=m}),e.forEach(t=>{t.children=[];const m=t.belongParent;if(m){let v=e[d[m]].children;Array.isArray(v)?v.push(t):v=[t]}else u.push(t)}),u}function we(e=[]){const u=[];for(let d=0;d<e.length;d++){const t=e[d],m=t.node,v=t.parent>-1?e[t.parent].node.parent:"",w=t.parents??[],N=[];w.forEach(_=>N.push(e[_].node.name)),u.push({belongParent:v,parent:m.parent,name:m.name,des:m.des,paramType:t.node.paramType,parentName:N.join(","),level:w.length+1,sort:d})}return u}const Ne=e=>(ne("data-v-76a5f8f5"),e=e(),ae(),e),xe={class:"paster-wrap"},Ie=Ne(()=>g("div",{flex:"main:justify cross:center"},[g("span",null,"示例")],-1)),ke={class:"example-wrap"},Te={class:"code"},Se={key:0,class:"tip"},Ee={name:"JsonPaster"},je=Object.assign(Ee,{props:{title:{type:String,default:"Json转换"},normalText:{type:String,default:"请复制Json中的数据内容，粘贴至下方区域"},tip:{type:String}},emits:["ok"],setup(e,{expose:u,emit:d}){const t=d,m=b(!1),v=b(""),w=b([]),N=b(!1),_=b(`[
    "fgroup_fname",
    "fbr",
    "fitemid",
    "fname",
    "fnumber",
    "fcompany",
    "fclassid",
    "ffullname",
    "ffullnumber"
]`),T=b(0),i=b({});function h(n,s){T.value=n,i.value=s,f(),m.value=!0}function f(){v.value="",w.value=[]}function c(n){H(n)||(w.value=G(n),v.value=JSON.stringify(n,null,2))}function o(){N.value=!0,w.value.length?t("ok",w.value,T.value,i.value):V.error("请复制粘贴正确内容后提交数据！"),N.value=!1}function C(n){try{w.value=JSON.parse(n)}catch{}}function S(){m.value=!1}return u({open:h,setformatData:c,handleClose:S,initData:f}),(n,s)=>{const r=p("b-alert"),x=p("b-ace-editor"),E=p("highlightjs"),R=p("b-card"),I=p("b-button"),O=p("b-modal");return y(),$("div",null,[l(O,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=P=>m.value=P),title:e.title,width:"600","mask-closable":!1},{footer:a(()=>[l(I,{onClick:S},{default:a(()=>[k("取 消")]),_:1}),l(I,{type:"primary",onClick:o,loading:N.value},{default:a(()=>[k("确 定")]),_:1},8,["loading"])]),default:a(()=>[l(r,{"show-icon":""},{default:a(()=>[k(A(e.normalText),1)]),_:1}),g("div",xe,[l(x,{modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=P=>v.value=P),onChange:C},null,8,["modelValue"]),l(R,{class:"box-card",width:"480px","head-tip":"",shadow:"never"},{header:a(()=>[Ie]),default:a(()=>[g("div",ke,[g("div",Te,[l(E,{language:"json",code:_.value},null,8,["code"])])])]),_:1})]),e.tip?(y(),$("p",Se,A(e.tip),1)):D("",!0)]),_:1},8,["modelValue","title"])])}}}),Ce=te(je,[["__scopeId","data-v-76a5f8f5"]]),Re={class:"p16"},De=Object.assign({name:"EditTree"},{__name:"edit-tree",setup(e){oe();const u=b(null),d=b(null),t=b(null),m=b(null);function v(){var r;const n=d.value.getFlatState(),s=we(n);(r=m.value)==null||r.show(s)}async function w(){await q()?V.success("校验成功！"):V.error("校验失败，请检查错误！")}const N=b([{belongParent:"",parent:"id-00",des:"根节点",name:"data",paramType:"Object",parentName:"",paramId:"paramId-00",interfaceId:"interfaceId-00",level:"1",sort:"0"},{belongParent:"id-00",parent:"id-00-00",des:"类别",name:"category",paramType:"Object",parentName:"data",paramId:"paramId-01",interfaceId:"interfaceId-00",level:"2",sort:"1"},{belongParent:"id-00-00",parent:"id-00-00-00",des:"说明",name:"text",paramType:"String",parentName:"data.category",paramId:"paramId-02",interfaceId:"interfaceId-00",level:"3",sort:"2"},{belongParent:"id-00",parent:"id-00-01",des:"名称",name:"name",paramType:"String",parentName:"data",paramId:"paramId-03",interfaceId:"interfaceId-00",level:"2",sort:"3"},{belongParent:"id-00",parent:"id-00-02",des:"id",name:"id",paramType:"String",parentName:"data",paramId:"paramId-04",interfaceId:"interfaceId-00",level:"2",sort:"4"},{belongParent:"",parent:"id-01",des:"根节点2",name:"data2",paramType:"Object",parentName:"",paramId:"paramId-05",interfaceId:"interfaceId-00",level:"1",sort:"5"}]),_=b([]);_.value=he(N.value);function T(){const n={parent:J(),name:"",des:"",paramType:"String"};_.value.push(n),z(()=>U(null))}function i(n,s=""){const r=n.children||[];n.expand=!0;const x={parent:J(),name:s,des:"",paramType:"String"};r.push(x),n.children=r,_.value=[..._.value],z(()=>U(x))}function h(n,s){var x;const r=n.find(E=>E===s).parent;if(r>-1){const E=(x=n.find(R=>R.nodeKey===r))==null?void 0:x.node;i(E)}else T()}async function f(n){return new Promise(s=>{n==="String"?s(!0):M.confirm({type:"warning",title:"提示",message:'<p>确定要<span style="color:red;">移除</span>当前节点吗？子节点会一并移除！</p>',useHTML:!0}).then(()=>s(!0)).catch(()=>s(!1))})}async function c(n,s,r){var E;if(await f(r.paramType)){const R=n.find(I=>I===s).parent;if(R>-1){const I=(E=n.find(P=>P.nodeKey===R))==null?void 0:E.node,O=I.children.indexOf(r);I.children.splice(O,1)}else{const I=_.value.indexOf(r);_.value.splice(I,1)}V({type:"success",message:"移除成功!"})}}let o=null;function C(n){o=n,t.value.open()}function S(n){var s;n.forEach(r=>{i(o,r)}),V.success("导入成功"),(s=t.value)==null||s.handleClose()}return(n,s)=>{const r=p("b-button"),x=p("debug-modal"),E=p("b-space"),R=p("b-form"),I=p("b-collapse-wrap"),O=p("page-wrapper");return y(),j(O,{desc:"编辑树表，实际开发时可能会根据实际情况进行组件定义和使用。"},{default:a(()=>[l(I,{title:"编辑树表",shadow:"none"},{right:a(()=>[l(E,{size:16},{default:a(()=>[l(x,{ref_key:"transDataRef",ref:m},{default:a(()=>[l(r,{type:"primary",size:"mini",plain:"",onClick:v},{default:a(()=>[k(" 转换数据结构 ")]),_:1})]),_:1},512),l(r,{type:"warning",size:"mini",plain:"",onClick:w},{default:a(()=>[k("校验错误")]),_:1}),l(x,{data:{treeData:_.value,testData:N.value}},null,8,["data"])]),_:1})]),default:a(()=>[g("div",Re,[l(R,{model:_.value,ref_key:"formRef",ref:u},{default:a(()=>[l(ge,{data:_.value,ref_key:"editTreeRef",ref:d,onImport:C,onAppendRootNode:T,onAppendNode:i,onAppendLevelNode:h,onRemoveNode:c},null,8,["data"])]),_:1},8,["model"])])]),_:1}),l(Ce,{ref_key:"jsonPasterRef",ref:t,title:"响应参数批量添加",tip:"",onOk:S},null,512)]),_:1})}}});export{De as default};
