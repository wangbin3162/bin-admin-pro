import{a8 as G,r as u,o as b,j as B,w as a,Q as c,K as n,b as l,f as d,a as U,i as T,t as R,R as H,F as J,N as Q,a9 as q,aa as W}from"./vendor-B29aizbt.js";import{n as F}from"./chunk-bin-ui-design-DOxaRq58.js";import"./chunk-brace-BklEY0pF.js";const X={name:"FuncDynamicCode",setup(){const g=u([{key:"name",value:"Akko pc75b plus"},{key:"price",value:549},{key:"num",value:2},{key:"discount",value:.98},{key:"breaks",value:30}]),o=u("return `${name} 商品 ，单价${price} ，数量${num} ，总价: ${price*num}`;"),S=u(null),e=u(""),A=u(null),x=u([{name:"Akko pc75b plus",price:549,num:2,discount:1,total:null},{name:"Ciy 68 test",price:79,num:4,discount:1,total:null},{name:"Ganss HS87T",price:398,num:2,discount:.95,total:null},{name:"达尔优A84",price:629,num:2,discount:.9,total:null},{name:"FL cmk87",price:629,num:6,discount:.95,total:null},{name:"总计",price:0,num:0,discount:0,total:null}]),k=u(`const { price, num, discount } = goods;
 return price * num * discount;`),y=u(null),p=u(`{
  "name": "张三",
  "phone": "",
  "age": 17,
  "address": "江苏省徐州市云龙区"
}`),_=u(["phone","age"]),f=u(""),V=u(!1),C=u(`const validatPhone = phone.length > 0;
const validatAge = age > 18 && age < 35;
if(validatPhone && validatAge){
  return {
    result: true,
    message: '校验通过'
  };
} else {
  let message = '';
  if(!validatPhone) message += '[手机号不能为空]';
  if(!validatAge) message += '[年龄必须在18~35岁之间]';
  return{
    result: false,
    message
  };
}`),v=u({});function N(s,i){s.dataTransfer.setData("fieldName",i)}function D(s){const i=s.dataTransfer.getData("fieldName");g.value.findIndex(m=>m.key===i)===-1&&g.value.push({key:i,value:""}),console.log(i)}function O(s){s.preventDefault()}function P(){try{const s=S.value.getFunction(),i=g.value.map(r=>r.key!=="name"?Number(r.value):r.value);console.log(i),console.log(s);const m=s(...i);console.log(m),F.success("函数执行成功！"),e.value=m}catch{e.value="",F.error("函数执行失败，请检查函数体和入参是否书写正确！")}}function E({row:s,column:i,rowIndex:m,columnIndex:r}){if(m===x.value.length-1&&r===0)return[1,4];if(m===x.value.length-1&&r>0&&r<4)return[0,0]}function j(){try{const s=A.value.getFunction(),i=x.value;let m=0;for(let r=0;r<i.length-1;r++){const h=+s(i[r]).toFixed(2);m+=h,i[r].total=h}i[i.length-1].total=m,F.success("计算成功！")}catch{F.error("函数执行失败，请检查函数体和入参是否书写正确！")}}function t(){V.value=!0,f.value=""}function M(){const s=_.value;s.indexOf(f.value)===-1&&s.push(f.value),K()}function K(){V.value=!1,f.value=""}function z(s){_.value.splice(_.value.indexOf(s),1)}function I(){try{const s=y.value.getFunction(),i=[],m=_.value;for(let h=0;h<m.length;h++){const L=JSON.parse(p.value)[m[h]];i.push(L)}const r=s(...i);v.value={type:r.result?"success":"error",message:r.message},F(v.value)}catch{e.value="",F.error("函数执行失败，请检查函数体和入参是否书写正确！")}}return{fieldsEditRef:S,goodsEditRef:A,fieldsMapping:g,fieldsFuncBody:o,fieldsTitle:e,dragField:N,dropField:D,allowDrop:O,runTest1:P,runTest2:j,columns:[{title:"商品名称",key:"name"},{title:"商品单价",key:"price"},{title:"商品数量",key:"num"},{title:"折扣",key:"discount"},{title:"合计",key:"total"}],goodsData:x,goodsFuncBody:k,handleSpan:E,formObjStr:p,formParams:_,formAdded:V,formField:f,formFuncBody:C,formEditRef:y,formResult:v,addOne:t,blurAdd:M,blurCancel:K,handleCloseTag:z,runTest3:I}}},w=g=>(q("data-v-de882adc"),g=g(),W(),g),Y=w(()=>l("div",null,"动态编写执行函数体，执行获取返回数据。",-1)),Z={flex:""},$={class:"p10",style:{width:"40%"}},ee=w(()=>l("p",null,"选择字段拖入配置区域",-1)),te=w(()=>l("p",null,"填写配置，右侧会自动拼接函数参数。",-1)),ne={key:0,class:"tip"},oe={class:"p10",style:{width:"60%"}},le=w(()=>l("p",null,"函数体入参根据配置传入，内部可直接使用，输入自定义计算函数并返回即可。",-1)),ae=w(()=>l("p",null,"函数体内代码遵循js编写规范，内有代码提示，如代码编写错误则执行计算时会报错。",-1)),se=w(()=>l("div",{class:"example"},[d(" 示例代码： "),l("p",null,"拼接字符串："),l("p",{style:{"padding-left":"8px"}}," return `${name} 商品 ，单价${price} ，数量${num} ，总价: ${price*num}`; "),l("p",null,"返回布尔值："),l("p",{style:{"padding-left":"8px"}},"return (price * num) * discount >= 200"),l("p",null,"复杂计算逻辑："),l("p",{style:{"padding-left":"8px"}},"// 如果有折扣则计算折扣后总价"),l("p",{style:{"padding-left":"8px"}}," const total = discount? price * num * discount : price * num; "),l("p",{style:{"padding-left":"8px"}},"// 判断是否符合满减政策，如满200-30"),l("p",{style:{"padding-left":"8px"}}," const totalPrice = total >= 200&&breaks ? total - breaks : total; "),l("p",{style:{"padding-left":"8px"}},"// 输出最终结果"),l("p",{style:{"padding-left":"8px"}}," return `您购买了${name}，单价${price}，数量${num}，最终价格: ${totalPrice}` ")],-1)),de={flex:""},ie={class:"p10",style:{width:"70%"}},re={class:"p10",style:{width:"30%"}},ue={flex:""},ce={class:"p10",style:{width:"30%"}},me={class:"p10",style:{width:"30%"}},pe={key:0,class:"p10",style:{width:"30%"}};function fe(g,o,S,e,A,x){const k=c("b-alert"),y=c("b-tag"),p=c("b-divider"),_=c("key-value-mapping"),f=c("b-button"),V=c("b-icon"),C=c("func-body-editor"),v=c("b-collapse-wrap"),N=c("b-table"),D=c("title-bar"),O=c("b-ace-editor"),P=c("b-input"),E=c("b-space"),j=c("page-wrapper");return b(),B(j,null,{desc:a(()=>[Y]),default:a(()=>[n(v,{title:"基础动态编码",shadow:"none",class:"mb-16"},{default:a(()=>[l("div",Z,[l("div",$,[n(k,{"show-icon":""},{desc:a(()=>[ee,te]),default:a(()=>[d(" 动态指定字段名称 ")]),_:1}),l("div",null,[d(" 字段候选 "),n(y,{type:"primary",draggable:"true",onDragstart:o[0]||(o[0]=t=>e.dragField(t,"name"))},{default:a(()=>[d(" name ")]),_:1}),n(y,{type:"info",draggable:"true",onDragstart:o[1]||(o[1]=t=>e.dragField(t,"price"))},{default:a(()=>[d(" price ")]),_:1}),n(y,{type:"success",draggable:"true",onDragstart:o[2]||(o[2]=t=>e.dragField(t,"num"))},{default:a(()=>[d("num")]),_:1}),n(y,{type:"warning",draggable:"true",onDragstart:o[3]||(o[3]=t=>e.dragField(t,"discount"))},{default:a(()=>[d(" discount ")]),_:1}),n(y,{type:"danger",draggable:"true",onDragstart:o[4]||(o[4]=t=>e.dragField(t,"breaks"))},{default:a(()=>[d(" breaks ")]),_:1})]),n(p,{style:{margin:"10px 0"}}),l("div",{class:"drop-wrapper",onDrop:o[6]||(o[6]=t=>e.dropField(t)),onDragover:o[7]||(o[7]=t=>e.allowDrop(t))},[e.fieldsMapping.length===0?(b(),U("p",ne,"拖动字段到此处进行配置")):T("",!0),n(_,{modelValue:e.fieldsMapping,"onUpdate:modelValue":o[5]||(o[5]=t=>e.fieldsMapping=t),"show-add":!1},null,8,["modelValue"])],32),n(p,{style:{margin:"10px 0"}}),n(f,{type:"primary",onClick:e.runTest1},{default:a(()=>[d("执行计算")]),_:1},8,["onClick"]),n(p,{style:{margin:"10px 0"}}),e.fieldsTitle?(b(),B(k,{key:0,type:"success","show-icon":""},{desc:a(()=>[d(R(e.fieldsTitle),1)]),default:a(()=>[d(" 执行计算成功 ")]),_:1})):T("",!0)]),l("div",oe,[n(k,{"show-icon":""},{icon:a(()=>[n(V,{name:"codelibrary"})]),desc:a(()=>[le,ae]),default:a(()=>[d(" 计算函数 ")]),_:1}),n(C,{ref:"fieldsEditRef",modelValue:e.fieldsFuncBody,"onUpdate:modelValue":o[8]||(o[8]=t=>e.fieldsFuncBody=t),augments:e.fieldsMapping.map(t=>t.key)},null,8,["modelValue","augments"]),n(p,{style:{margin:"10px 0"}}),se])])]),_:1}),n(v,{title:"表格类方式调用",shadow:"none",class:"mb-16"},{default:a(()=>[l("div",de,[l("div",ie,[n(N,{columns:e.columns,data:e.goodsData,border:"","merge-method":e.handleSpan,size:"small"},null,8,["columns","data","merge-method"])]),l("div",re,[n(D,{title:"商品计算函数","tip-pos":"left"}),d(" tip: 这里采用对象传入的方式进行传参 "),n(C,{ref:"goodsEditRef",modelValue:e.goodsFuncBody,"onUpdate:modelValue":o[9]||(o[9]=t=>e.goodsFuncBody=t),augments:["goods"]},null,8,["modelValue"]),n(p,{style:{margin:"10px 0"}}),n(f,{type:"primary",onClick:e.runTest2},{default:a(()=>[d("执行计算")]),_:1},8,["onClick"])])])]),_:1}),n(v,{title:"用于校验函数",shadow:"none",class:"mb-16"},{default:a(()=>[l("div",ue,[l("div",ce,[n(O,{modelValue:e.formObjStr,"onUpdate:modelValue":o[10]||(o[10]=t=>e.formObjStr=t)},null,8,["modelValue"])]),l("div",me,[n(D,{title:"校验函数","tip-pos":"left",class:"mb-10"}),n(E,null,{default:a(()=>[n(f,{size:"mini",onClick:e.addOne},{default:a(()=>[d("新增校验字段")]),_:1},8,["onClick"]),(b(!0),U(J,null,H(e.formParams,t=>(b(),B(y,{key:t,type:"primary",closable:"",onClose:M=>e.handleCloseTag(t)},{default:a(()=>[d(R(t),1)]),_:2},1032,["onClose"]))),128)),e.formAdded?(b(),B(P,{key:0,style:{width:"100px"},size:"mini",modelValue:e.formField,"onUpdate:modelValue":o[11]||(o[11]=t=>e.formField=t),onKeydown:Q(e.blurAdd,["enter"]),onBlur:e.blurCancel},null,8,["modelValue","onKeydown","onBlur"])):T("",!0)]),_:1}),n(p,{style:{margin:"10px 0"}}),n(C,{ref:"formEditRef",modelValue:e.formFuncBody,"onUpdate:modelValue":o[12]||(o[12]=t=>e.formFuncBody=t),augments:e.formParams,height:"240"},null,8,["modelValue","augments"]),n(p,{style:{margin:"10px 0"}}),n(f,{type:"primary",onClick:e.runTest3},{default:a(()=>[d("执行校验")]),_:1},8,["onClick"])]),e.formResult.type?(b(),U("div",pe,[n(k,{type:e.formResult.type,"show-icon":""},{desc:a(()=>[d(R(e.formResult.message),1)]),default:a(()=>[d(R(e.formResult.type==="success"?"验证成功":"验证失败")+" ",1)]),_:1},8,["type"])])):T("",!0)])]),_:1})]),_:1})}const be=G(X,[["render",fe],["__scopeId","data-v-de882adc"]]);export{be as default};
