import{a8 as M,ag as E,Q as k,o as D,a as O,b as m,K as v,w as g,t as T,L as i,j as N,i as V,f as b,g as A,v as K,a9 as P,aa as Q,r as R,n as $}from"./vendor-5c4b4c96.js";import{b as F,s as C,c as G,g as H,d as J}from"./cross-tab-msg-52280636.js";import{u as U,d as W,e as n,i as X}from"./useData-c71aace8.js";import{n as I}from"./chunk-bin-ui-design-2f3ecd04.js";import{i as y}from"./index-0c470c36.js";import{I as Y}from"./env-7bb403fa.js";import"./chunk-brace-6f23dcf5.js";import"./chunk-mockjs-c013c588.js";const Z=d=>(P("data-v-00c54bf1"),d=d(),Q(),d),ee={class:"sheet-wrapper"},te={class:"sheet-header"},ae={class:"left"},se={class:"right"},oe=Z(()=>m("div",{id:"SheetContainer",class:"sheet-excel has-config"},null,-1)),ce={class:"mask"},ne={__name:"SheetEdit",props:{cfg:{type:Object,default:()=>({})}},setup(d){const r=window.luckysheet,h=d,{title:w,btnLoading:e,isMaskShow:l,closePage:u,downloadExcel:p}=U(h),_=E();async function S(){var s;try{e.value=!0;const o=y(n.value.mapping),c={};o.forEach(f=>{const{cellIndex:j,fieldName:B}=f,{row:z,column:L}=j,q=r.getCellValue(z,L);c[B]=q});const t=r.getAllSheets(),a={id:(s=_.query.id)!=null?s:"",tempId:n.value.id,tempName:n.value.name,data:c,sheets:t};a.id===""?(await F(a),I.success("\u65B0\u589E\u6210\u529F!"),C("add-sheet-data",{...a}),x()):(await G(a),I.success("\u4FEE\u6539\u6210\u529F!"),C("modify-sheet-data",{...a}))}catch(o){console.log(o)}e.value=!1}function x(){try{e.value=!0,y(n.value.mapping).forEach(o=>{const{cellIndex:c}=o,{row:t,column:a}=c;r.setCellValue(t,a,"")})}catch(s){console.log(s)}e.value=!1}return(s,o)=>{const c=k("b-space"),t=k("b-button");return D(),O("div",ee,[m("div",te,[m("div",ae,[v(c,null,{default:g(()=>[m("h3",null,T(i(w)),1)]),_:1})]),m("div",se,[i(Y)?(D(),N(t,{key:0,type:"text",icon:"bug","text-color":"danger",title:"\u6253\u5370\u8C03\u8BD5",onClick:i(W)},null,8,["onClick"])):V("",!0),v(t,{type:"primary",size:"small",icon:"download",plain:"",onClick:i(p)},{default:g(()=>[b(" \u4E0B\u8F7D\u6A21\u677F ")]),_:1},8,["onClick"]),v(t,{type:"primary",size:"small",icon:"save",loading:i(e),onClick:S},{default:g(()=>[b(" \u4FDD\u5B58 ")]),_:1},8,["loading"]),v(t,{type:"danger",size:"small",icon:"close",onClick:i(u)},{default:g(()=>[b("\u5173\u95ED")]),_:1},8,["onClick"])])]),oe,A(m("div",ce,"loading",512),[[K,i(l)]])])}}},le=M(ne,[["__scopeId","data-v-00c54bf1"]]),fe=Object.assign({name:"DataEdit"},{__name:"index",setup(d){const r=E(),h=R(!1);function w(e){var p;if(e.sheets){n.value.jsonData.sheets=y(e.sheets);return}const l=y(n.value.mapping),u=(p=n.value.jsonData)==null?void 0:p.sheets[0];if(u){const _=u.celldata||[];l.forEach(S=>{const{cellIndex:x,fieldName:s}=S,{column:o,row:c}=x,t=_.findIndex(f=>f.c===o&&f.r===c),a=e.data[s];t>-1&&(_[t].v.v=_[t].v.m=a)})}}return $(()=>r.path,async()=>{const{tempId:e,id:l}=r.query;if(document.title="\u6570\u636E\u586B\u62A5",e){X();const u=await H(e);if(n.value={...u},l){const p=await J(l);w(p)}}h.value=!0},{immediate:!0}),(e,l)=>h.value?(D(),N(le,{key:0})):V("",!0)}});export{fe as default};
