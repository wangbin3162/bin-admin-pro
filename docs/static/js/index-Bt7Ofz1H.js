import{a8 as L,l as R,r as p,n as j,o as i,a as N,b as u,K as _,w as f,t as q,F as M,Q as z,L as K,f as O,i as P,g as Q,v as A,ag as G,aa as C,R as c,j as V}from"./vendor-COsJffew.js";import{n as I}from"./chunk-bin-ui-design-55yTQV6H.js";import{b as H,s as B,c as J,g as W,d as X}from"./cross-tab-msg-CTU40FVn.js";import{e as l,i as Y}from"./useData-TSQMxnf1.js";import{d as k}from"./index-DlSIhdb0.js";import"./chunk-brace-DF1jSkZr.js";const Z={class:"sheet-wrapper"},$={class:"sheet-header"},ee={class:"left"},ae={class:"right"},te={class:"sheet-excel"},oe={key:0,class:"form-box"},se={class:"mask"},ne=Object.assign({name:"DataEditSimple"},{__name:"index",setup(le){const E=R({get:()=>l.value.name,set:e=>l.value.name=e}),b=G(),S=p(!1),g=p(!1),T=p(!1),o=p({}),v=p(null);function U(){window.close()}function w(e){k(l.value.mapping).forEach(t=>{const{fieldName:n}=t;o.value[n]=e?e.data[n]:""}),e&&e.sheets&&(v.value=k(e.sheets))}async function F(){try{g.value=!0;const e={id:b.query.id??"",tempId:l.value.id,tempName:l.value.name,data:C(o.value)};if(v.value&&v.value[0]){e.sheets=C(v.value);const s=k(l.value.mapping),t=e.sheets[0].celldata||[];s.forEach(n=>{const{cellIndex:y,fieldName:x}=n,{column:d,row:m}=y,r=t.findIndex(h=>h.c===d&&h.r===m),a=o.value[x];r>-1&&(t[r].v.v=t[r].v.m=a,e.sheets[0].data[m][d].v=e.sheets[0].data[m][d].m=a)})}e.id===""?(await H(e),I.success("新增成功!"),B("add-sheet-data",{...e}),w()):(await J(e),I.success("修改成功!"),B("modify-sheet-data",{...e}))}catch(e){console.log(e)}g.value=!1}return j(()=>b.path,async()=>{const{tempId:e,id:s}=b.query;if(document.title="数据填报",e){Y();const t=await W(e);if(l.value={...t},w(),s){const n=await X(s);w(n)}}S.value=!0},{immediate:!0}),(e,s)=>{const t=c("b-space"),n=c("b-icon"),y=c("b-input-number"),x=c("b-input"),d=c("b-form-item"),m=c("b-button"),r=c("b-form");return i(),N("div",Z,[u("div",$,[u("div",ee,[_(t,null,{default:f(()=>[u("h3",null,q(E.value),1)]),_:1})]),u("div",ae,[_(n,{type:"button",name:"close",color:"#f5222d",size:"24",onClick:U})])]),u("div",te,[S.value?(i(),N("div",oe,[_(r,{"label-width":"100px",model:o.value},{default:f(()=>[(i(!0),N(M,null,z(K(l).mapping,(a,h)=>(i(),V(d,{key:h,prop:a.fieldName,label:a.fieldTitle},{default:f(()=>[a.dataType==="number"?(i(),V(y,{key:0,modelValue:o.value[a.fieldName],"onUpdate:modelValue":D=>o.value[a.fieldName]=D},null,8,["modelValue","onUpdate:modelValue"])):(i(),V(x,{key:1,modelValue:o.value[a.fieldName],"onUpdate:modelValue":D=>o.value[a.fieldName]=D},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["prop","label"]))),128)),_(d,null,{default:f(()=>[_(m,{type:"primary",loading:g.value,onClick:F},{default:f(()=>s[0]||(s[0]=[O("保 存")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):P("",!0)]),Q(u("div",se,"loading",512),[[A,T.value]])])}}}),pe=L(ne,[["__scopeId","data-v-5dd02c65"]]);export{pe as default};
