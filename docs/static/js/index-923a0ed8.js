import{a6 as E,b as O,f as n,g as v,j as z,v as N,x as o,q as u,t as V,c as e,l as c,u as P,a0 as A,a2 as l,aO as F,A as L,ad as J,a4 as G,F as H,y as K,z as Q,aa as I,a7 as W,a8 as X,ae as Y,e as Z,w as ee}from"./vendor-a6c5ad11.js";import{a as T}from"./chunk-bin-ui-next-1e71edb3.js";import{i as ae}from"./index-92c56bc9.js";import{I as U}from"./env-7bb403fa.js";import{a as te,s as $,m as se,f as le,g as oe}from"./cross-tab-msg-015cdf60.js";import{e as s,u as ne,d as ie,i as ce}from"./useData-a8431721.js";import"./chunk-brace-6f23dcf5.js";import"./chunk-mockjs-c013c588.js";const de={class:"mapping-config"},pe=L('<div class="top-title" data-v-af10520c><span class="l1" data-v-af10520c>\u4F4D\u7F6E</span><span class="l2" data-v-af10520c>\u5B57\u6BB5\u6807\u8BC6</span><span class="l3" data-v-af10520c>\u5B57\u6BB5\u540D\u79F0</span><span class="l4" data-v-af10520c>\u7C7B\u578B</span></div>',1),ue={class:"mapping-item"},re={class:"mapping-content"},_e=["onClick"],me={__name:"MappingConfig",setup(r){const t=O({get:()=>s.value.mapping,set:i=>s.value.mapping=i});function _(i){t.value.splice(i,1)}return(i,d)=>{const h=n("b-empty"),w=n("drag-handle"),x=n("b-tag"),k=n("b-input"),y=n("b-option"),S=n("b-select"),D=n("b-space");return v(),z("div",de,[pe,t.value.length===0?(v(),N(h,{key:0},{default:o(()=>[u("\u6682\u65E0\u6620\u5C04")]),_:1})):V("",!0),e(l(F),A({modelValue:t.value,"onUpdate:modelValue":d[0]||(d[0]=b=>t.value=b),class:"mapping-list","item-key":"element"},{animation:200,group:"mapping",ghostClass:"ghost",dragClass:"drag-item-class",handle:".drag-handle"}),{item:o(({element:b,index:p})=>[c("div",ue,[e(w,{class:"drag-handle"}),c("div",re,[e(D,{size:4},{default:o(()=>[e(x,{style:{width:"38px","justify-content":"center",padding:"0 4px"}},{default:o(()=>[u(P(b.cellPosition.start),1)]),_:2},1024),e(k,{modelValue:t.value[p].fieldName,"onUpdate:modelValue":a=>t.value[p].fieldName=a,size:"small",placeholder:"\u5B57\u6BB5\u6807\u8BC6"},null,8,["modelValue","onUpdate:modelValue"]),e(k,{modelValue:t.value[p].fieldTitle,"onUpdate:modelValue":a=>t.value[p].fieldTitle=a,size:"small",placeholder:"\u5B57\u6BB5\u540D\u79F0"},null,8,["modelValue","onUpdate:modelValue"]),e(S,{modelValue:t.value[p].dataType,"onUpdate:modelValue":a=>t.value[p].dataType=a,size:"small",style:{width:"70px"}},{default:o(()=>[e(y,{label:"\u6587\u672C",value:"string"}),e(y,{label:"\u6570\u503C",value:"number"}),e(y,{label:"\u65E5\u671F",value:"date"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),c("i",{class:"destroy b-iconfont b-icon-delete",onClick:a=>_(p)},null,8,_e)])]),_:1},16,["modelValue"])])}}},ge=E(me,[["__scopeId","data-v-af10520c"]]);const M=r=>(W("data-v-0022f161"),r=r(),X(),r),fe={class:"sheet-wrapper"},ve={class:"sheet-header"},he={class:"left"},ye=M(()=>c("h3",null,"\u6A21\u677F\u540D\u79F0",-1)),be={class:"right"},Ce=M(()=>c("div",{id:"SheetContainer",class:"sheet-excel has-config"},null,-1)),ke={class:"right-config"},Ve={class:"right-top"},we={class:"right-content"},xe={class:"mask"},Se={__name:"SheetConfig",props:{cfg:{type:Object,default:()=>({})}},setup(r){const t=r,_=window.luckysheet,{info:i,title:d,btnLoading:h,isMaskShow:w,closePage:x,loadExcel:k,downloadExcel:y}=ne(t),S=J();async function D(){try{i.value.name=d.value;const a=b();if(h.value=!0,a.id===""){const g=await te(a);if(g){T.success("\u65B0\u589E\u6210\u529F!"),$("add-temp",{...a}),s.value.id=g,s.value.reportCount=s.value.records=0,s.value.isPublish="0";let C=S.resolve({path:"/excel-edit",query:{id:g}});window.location.replace(C.href),document.title="\u4FEE\u6539\u6A21\u677F"}}else await se(a),T.success("\u4FEE\u6539\u6210\u529F!"),$("modify-temp",{...a})}catch(a){console.log(a)}h.value=!1}function b(){const a=_.getAllSheets();return{...I(s.value),jsonData:{info:I(i.value),sheets:a}}}function p(){const a=_.getRange()[0],m=le(a);if(s.value.mapping.findIndex(C=>ae(C.cellRange,a))>-1){T.warning("\u5DF2\u5B58\u5728\u76F8\u540C\u4F4D\u7F6E\u7684\u5355\u5143\u683C\u6570\u636E\u9879\uFF01");return}s.value.mapping.push({...m,fieldName:"",fieldTitle:"",dataType:"string"})}return(a,m)=>{const g=n("b-input"),C=n("b-space"),f=n("b-button"),R=n("b-divider"),j=n("b-ace-editor"),q=n("b-scrollbar");return v(),z("div",fe,[c("div",ve,[c("div",he,[e(C,null,{default:o(()=>[ye,e(g,{modelValue:l(d),"onUpdate:modelValue":m[0]||(m[0]=B=>G(d)?d.value=B:null),placeholder:"\u6A21\u677F\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),c("div",be,[l(U)?(v(),N(f,{key:0,type:"text",icon:"bug","text-color":"danger",title:"\u6253\u5370\u8C03\u8BD5",onClick:l(ie)},null,8,["onClick"])):V("",!0),e(f,{type:"primary",size:"small",icon:"login",plain:"",onClick:l(k)},{default:o(()=>[u(" \u5BFC\u5165\u6A21\u677F ")]),_:1},8,["onClick"]),e(f,{type:"primary",size:"small",icon:"download",plain:"",onClick:l(y)},{default:o(()=>[u(" \u4E0B\u8F7D\u6A21\u677F ")]),_:1},8,["onClick"]),e(R,{type:"vertical"}),e(f,{type:"primary",size:"small",icon:"save",loading:l(h),onClick:D},{default:o(()=>[u(" \u4FDD\u5B58 ")]),_:1},8,["loading"]),e(f,{type:"danger",size:"small",icon:"close",onClick:l(x)},{default:o(()=>[u("\u5173\u95ED")]),_:1},8,["onClick"])])]),Ce,c("div",ke,[c("div",Ve,[e(f,{type:"primary",size:"small",dashed:"",onClick:p},{default:o(()=>[u("\u8BBE\u4E3A\u6570\u636E\u9879")]),_:1})]),c("div",we,[e(q,null,{default:o(()=>[e(ge),l(U)?(v(),z(H,{key:0},[e(R,{align:"left"},{default:o(()=>[u("\u5B9E\u9645\u5B58\u50A8\u503C")]),_:1}),e(j,{"model-value":JSON.stringify({id:l(s).id,name:l(s).name,mapping:l(s).mapping},null,2),readonly:""},null,8,["model-value"])],64)):V("",!0)]),_:1})])]),K(c("div",xe,"loading",512),[[Q,l(w)]])])}}},De=E(Se,[["__scopeId","data-v-0022f161"]]),Me=Object.assign({name:"ExcelEdit"},{__name:"index",setup(r){const t=Y(),_=Z(!1);return ee(()=>t.path,async()=>{const{id:i}=t.query;if(document.title=i?"\u4FEE\u6539\u6A21\u677F":"\u65B0\u589E\u6A21\u677F",i){const d=await oe(i);s.value={...d}}else ce(),s.value.name="\u65B0\u6A21\u677F";_.value=!0},{immediate:!0}),(i,d)=>_.value?(v(),N(De,{key:0})):V("",!0)}});export{Me as default};
