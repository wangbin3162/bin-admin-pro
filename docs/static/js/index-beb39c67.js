var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,d=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&d(e,a,t[a]);if(l)for(var a of l(t))i.call(t,a)&&d(e,a,t[a]);return e},s=(e,l)=>t(e,a(l));import{a5 as r,a6 as c,y as u,n as p,o as m,A as f,a as h,E as v,a7 as b,a8 as y,B as g,J as k,c as w,w as x,u as I,q as T,t as C,f as A,G as S,h as z,s as V,g as N,D as M,I as L,p as E,F,K,d as _,X as H,L as j,j as D,k as R}from"./vendor-b1b195f8.js";import{a as B,M as U}from"./chunk-bin-ui-next-f06badfa.js";import{i as O,g as Y,j as G,t as W,k as q,J,m as Q,n as Z,o as P,p as X,r as $}from"./index-c2ebc9d7.js";import{_ as ee}from"./index-506f489c.js";import{_ as te}from"./page-cube-wrapper-8e3b9e6f.js";import"./chunk-brace-7f859248.js";function ae(){const e=r(),t=c(),a=u({id:"",workspaceId:"",datasetName:"未命名",datasourceName:"探索空间"});return p((()=>t.path),(e=>{if("/schema/cube"!==e)return;const{id:l,workspaceId:n}=t.query;l&&n?(a.id=l,a.workspaceId=n,a.datasetName="dataset_0001"===a.id?"数据集（空）":"数据集",a.datasourceName="探索空间"):B.error({message:"没有请求参数，即将关闭此页面！"})}),{immediate:!0}),{dataset:a,handleSave:()=>{B.success(`保存 [ ${a.datasetName} ] 成功`)},handleBack:t=>{e.push(t||"/")}}}const le={name:"field-type-icon",props:{type:{type:String,default:"STRING",validator:e=>["STRING","NUMBER","DATE","YEAR","QUARTER","MONTH","WEEK","DAY","HOUR","MINUTE","SECOND"].includes(e)},size:{type:String,default:"12px"}}},ne=e=>(b("data-v-50ec3371"),e=e(),y(),e),ie={key:0,class:"svg-icon",viewBox:"0 0 1706 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},de=[ne((()=>g("path",{d:"M278.016 975.189333c215.722667 0 331.605333-84.48 331.605333-268.629333 0-185.514667-75.434667-241.493333-284.501333-290.474667C156.672 376.490667 133.632 345.088 133.632 256.341333c0-122.709333 62.122667-148.48 192.853333-148.48 84.992 0 179.370667 17.578667 233.301334 38.058667V34.133333C515.584 16.384 415.573333 0 325.12 0 113.493333 0 13.824 84.650667 13.824 256.341333c0 167.936 69.973333 215.552 261.632 261.973334 175.274667 42.325333 215.722667 73.728 215.722667 189.44 0 117.418667-72.874667 159.744-212.992 159.744C167.424 867.498667 55.466667 845.653333 0.170667 825.173333V938.666667c45.909333 16.213333 161.792 36.693333 277.845333 36.693333z m623.786667 0c27.818667 0 48.298667-2.901333 73.557333-7.168v-105.642666c-22.869333 5.802667-42.154667 8.533333-71.168 8.533333-79.701333 0-94.208-28.842667-94.208-150.186667V289.28h161.792v-104.106667h-161.792V0h-103.765333v185.173333h-96.597334v104.106667h96.597334v438.613333c0 205.312 51.882667 247.466667 195.584 247.466667z m312.832-718.165333H1097.557333v718.165333h117.248v-469.333333c40.96-127.658667 133.802667-158.378667 227.84-158.378667h16.384l4.096-103.594666h-13.653333c-83.456 0-176.469333 21.162667-225.962667 123.392l-8.533333 19.968v-130.218667z m370.346666 718.165333c87.552 0 121.856-15.36 121.856-123.733333 0-104.618667-34.133333-119.978667-121.856-119.978667-89.6 0-122.026667 15.36-122.026666 119.978667 0 108.373333 32.426667 123.733333 122.026666 123.733333z",fill:""},null,-1)))],oe={key:1,class:"svg-icon",viewBox:"0 0 1706 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},se=[ne((()=>g("path",{d:"M178.176 961.194667V193.365333h8.192l378.538667 768h245.76V2.730667H633.856v722.261333h-8.192L277.504 2.901333H0v958.293334h178.176z m1173.162667-237.909334c227.84 0 328.533333-102.912 328.533333-365.056C1679.872 96.085333 1579.178667 0 1351.338667 0c-226.474667 0-336.213333 83.797333-336.213334 358.229333s109.738667 365.056 336.213334 365.056z m-339.626667 82.432H1706.666667v154.112H1011.712V805.546667zM1350.656 610.986667c-133.973333 0-179.541333-59.392-179.541333-252.757334S1213.781333 104.106667 1350.656 104.106667c136.704 0 180.906667 60.757333 180.906667 254.122666s-42.666667 252.586667-180.906667 252.586667z",fill:""},null,-1)))],re={key:2,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},ce=[ne((()=>g("path",{d:"M475.39566 585.157484h73.10629c20.477952 0 36.553145-16.075192 36.553144-36.553144 0-20.477952-16.075192-36.553145-36.553144-36.553145h-73.10629c-20.477952 0-36.553145 16.075192-36.553144 36.553145 0 20.477952 16.075192 36.553145 36.553144 36.553144z m0 146.314969h73.10629c20.477952 0 36.553145-16.075192 36.553144-36.553145 0-20.477952-16.075192-36.553145-36.553144-36.553145h-73.10629c-20.477952 0-36.553145 16.075192-36.553144 36.553145 0 20.477952 16.075192 36.553145 36.553144 36.553145zM877.480252 73.208679H731.370063V36.655534c0-20.477952-16.075192-36.553145-36.553145-36.553144-20.477952 0-36.553145 16.075192-36.553144 36.553144v36.553145H365.531447V36.655534c0-20.477952-16.075192-36.553145-36.553145-36.553144-20.477952 0-36.553145 16.075192-36.553145 36.553144v36.553145H146.417358C65.836616 73.208679 0 139.045295 0 219.523648v585.055094c0 80.478352 65.836616 146.314969 146.314969 146.314969H877.480252c80.478352 0 146.314969-65.836616 146.314968-146.314969V219.523648C1023.89761 139.045295 958.060994 73.208679 877.582642 73.208679z m73.208679 731.370063a73.311069 73.311069 0 0 1-73.208679 73.106289H146.417358a73.311069 73.311069 0 0 1-73.208679-73.106289V365.736226h877.685032v438.842516z m0-511.948805H73.106289v-73.106289c0-40.239176 32.969503-73.106289 73.20868-73.10629h146.212578v36.553145c0 20.477952 16.075192 36.553145 36.553145 36.553145 20.477952 0 36.553145-16.075192 36.553145-36.553145v-36.553145H658.366163v36.553145c0 20.477952 16.075192 36.553145 36.553145 36.553145 20.477952 0 36.553145-16.075192 36.553145-36.553145v-36.553145H877.480252c40.239176 0 73.208679 32.867113 73.208679 73.10629v73.106289zM255.974403 731.472453h73.106289c20.477952 0 36.553145-16.075192 36.553145-36.553145 0-20.477952-16.075192-36.553145-36.553145-36.553145H255.974403c-20.477952 0-36.553145 16.075192-36.553145 36.553145 0 20.477952 16.075192 36.553145 36.553145 36.553145z m438.842515-146.314969H767.923208c20.477952 0 36.553145-16.075192 36.553144-36.553144C804.476352 528.126387 788.40116 512.051195 767.923208 512.051195h-73.10629c-20.477952 0-36.553145 16.075192-36.553144 36.553145 0 20.477952 16.075192 36.553145 36.553144 36.553144z m-438.842515 0h73.106289c20.477952 0 36.553145-16.075192 36.553145-36.553144 0-20.477952-16.075192-36.553145-36.553145-36.553145H255.974403c-20.477952 0-36.553145 16.075192-36.553145 36.553145 0 20.477952 16.075192 36.553145 36.553145 36.553144z m438.842515 146.314969H767.923208c20.477952 0 36.553145-16.075192 36.553144-36.553145 0-20.477952-16.075192-36.553145-36.553144-36.553145h-73.10629c-20.477952 0-36.553145 16.075192-36.553144 36.553145 0 20.477952 16.075192 36.553145 36.553144 36.553145z",fill:""},null,-1)))],ue={key:3,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},pe=[ne((()=>g("path",{d:"M1024 73.130667H731.392V0h-73.130667v73.130667H365.738667V0h-73.130667v73.130667H0V1024h1024V73.130667zM950.869333 938.666667H73.130667V160.085333H292.693333v70.741334h73.130667v-70.826667h292.522667v70.826667h73.130666v-70.826667h219.477334V938.666667zM571.136 848.725333V643.584L768 336.725333H634.88L515.157333 541.013333h-4.608L394.496 336.725333H256l196.096 309.077334v202.922666z"},null,-1)))],me={key:4,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},fe=[ne((()=>g("path",{d:"M510.72 307.456c35.242667 0 67.669333 5.376 97.109333 16.213333 29.696 10.922667 55.125333 26.709333 76.288 47.274667 20.992 20.48 37.12 45.226667 48.469334 74.154667 6.826667 17.237333 11.434667 35.669333 14.165333 55.466666l2.048 20.224 0.597333 20.565334v22.954666l-0.682666 20.992a239.274667 239.274667 0 0 1-24.746667 94.72 204.8 204.8 0 0 1-44.117333 58.026667l-7.594667 6.4 78.250667 53.418667 0.426666 13.226666-74.154666 57.429334-12.202667 0.256-102.656-75.946667-15.701333 2.389333a307.2 307.2 0 0 1-34.816 1.877334c-34.56 0-66.56-5.461333-95.744-16.213334a208.213333 208.213333 0 0 1-125.44-120.832 234.325333 234.325333 0 0 1-14.421334-55.466666l-2.048-20.224-0.682666-20.565334v-23.04l0.682666-20.138666c1.792-27.477333 7.338667-52.650667 16.554667-75.690667 11.605333-28.842667 27.818667-53.589333 48.810667-73.984a214.186667 214.186667 0 0 1 75.861333-47.274667c29.184-10.837333 61.098667-16.213333 95.744-16.213333z m0 100.096c-16.469333 0-30.976 2.645333-43.605333 8.021333a85.930667 85.930667 0 0 0-32.170667 23.552 114.773333 114.773333 0 0 0-21.76 41.216c-2.56 8.533333-4.693333 17.92-5.973333 27.904l-1.536 15.36-0.512 17.152v22.528l0.512 17.408c1.024 16.128 3.584 30.72 7.68 43.52 5.376 16.896 12.714667 30.72 22.016 41.728 8.96 10.496 19.626667 18.261333 32.256 23.552 12.8 5.461333 27.306667 8.106667 43.776 8.106667 34.218667 0 59.306667-10.24 77.056-31.402667 14.08-16.810667 23.04-40.106667 26.709333-69.888l1.365333-15.36 0.426667-17.152v-22.613333l-0.512-17.493333c-2.133333-37.290667-11.776-65.536-28.416-84.821334-18.090667-21.077333-43.264-31.317333-77.312-31.317333zM1024 73.130667H731.392V0h-73.130667v73.130667H365.738667V0h-73.130667v73.130667H0V1024h1024V73.130667zM950.869333 938.666667H73.130667V160.085333H292.693333v70.741334h73.130667v-70.826667h292.522667v70.826667h73.130666v-70.826667h219.477334V938.666667z"},null,-1)))],he={key:5,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},ve=[ne((()=>g("path",{d:"M347.904 852.906667v-402.773334h4.608l100.266667 306.176h115.456L669.866667 450.133333h4.608v402.773334H788.48v-512H606.208l-91.136 288.426666h-4.608L423.253333 340.906667H235.52v512zM1024 73.130667H731.392V0h-73.130667v73.130667H365.738667V0h-73.130667v73.130667H0V1024h1024V73.130667zM950.869333 938.666667H73.130667V160.085333H292.693333v70.741334h73.130667v-70.826667h292.522667v70.826667h73.130666v-70.826667h219.477334V938.666667z"},null,-1)))],be={key:6,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},ye=[ne((()=>g("path",{d:"M427.52 845.226667L512 502.613333l84.48 342.528H704l115.114667-512H712.618667l-69.802667 364.288-85.162667-364.373333H467.114667L381.44 696.917333 311.466667 333.226667H204.8l115.114667 512zM1024 73.130667H731.392V0h-73.130667v73.130667H365.738667V0h-73.130667v73.130667H0V1024h1024V73.130667zM950.869333 938.666667H73.130667V160.085333H292.693333v70.741334h73.130667v-70.826667h292.522667v70.826667h73.130666v-70.826667h219.477334V938.666667z"},null,-1)))],ge={key:7,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},ke=[ne((()=>g("path",{d:"M482.56 840.704c181.333333 0 300.373333-58.282667 300.373333-256 0-213.162667-119.04-256-300.373333-256h-211.626667v512h211.626667zM475.477333 744.96h-69.376v-321.706667h69.376c111.104 0 167.936 29.525333 167.936 161.536 0 124.757333-54.186667 160.170667-167.936 160.170667zM1024 73.130667H731.392V0h-73.130667v73.130667H365.738667V0h-73.130667v73.130667H0V1024h1024V73.130667zM950.869333 938.666667H73.130667V160.085333H292.693333v70.741334h73.130667v-70.826667h292.522667v70.826667h73.130666v-70.826667h219.477334V938.666667z"},null,-1)))],we={key:8,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},xe=[ne((()=>g("path",{d:"M391.360853 795.306667V568.746667h243.2V795.306667H768.534187v-512H634.560853v191.744H391.360853V283.306667H256.534187v512zM509.03552 921.6a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM512.534187 0a512.170667 512.170667 0 0 1 501.930666 410.453333h-87.466666A426.837333 426.837333 0 0 0 85.86752 512a426.837333 426.837333 0 0 0 325.12 414.464v87.466667A512 512 0 0 1 512.534187 0z m256.341333 848.469333a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4z m147.285333-162.048a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM973.334187 460.8a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4z"},null,-1)))],Ie={key:9,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},Te=[ne((()=>g("path",{d:"M348.438187 796.330667v-402.773334h4.608l100.266666 306.090667h115.456L670.400853 393.472h4.608v402.773333H789.014187v-512H606.742187L515.606187 572.842667h-4.608L423.78752 284.330667H236.054187v512zM509.03552 921.6a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM512.534187 0a512.170667 512.170667 0 0 1 501.930666 410.453333h-87.466666A426.837333 426.837333 0 0 0 85.86752 512a426.837333 426.837333 0 0 0 325.12 414.464v87.466667A512 512 0 0 1 512.534187 0z m256.341333 848.469333a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4z m147.285333-162.048a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM973.334187 460.8a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4z"},null,-1)))],Ce={key:10,class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},Ae=[ne((()=>g("path",{d:"M523.62752 785.066667c28.928 0 55.210667-3.413333 78.762667-10.069334 23.466667-6.656 43.605333-16.213333 60.245333-28.842666 16.64-12.458667 29.525333-27.904 38.570667-46.08 9.045333-18.346667 13.653333-39.168 13.653333-62.464 0-21.930667-3.754667-41.557333-11.264-58.88a141.994667 141.994667 0 0 0-33.194667-46.677334 225.450667 225.450667 0 0 0-54.613333-37.205333 510.805333 510.805333 0 0 0-75.946667-29.866667c-34.218667-10.24-60.245333-21.333333-77.994666-33.109333-17.749333-11.776-26.624-26.453333-26.624-44.032a55.210667 55.210667 0 0 1 20.821333-43.776 75.264 75.264 0 0 1 26.026667-13.141333c10.581333-3.157333 22.954667-4.778667 37.205333-4.778667 14.677333 0 27.477333 1.962667 38.4 5.717333a74.837333 74.837333 0 0 1 27.136 15.872c7.253333 6.826667 12.629333 14.933333 16.128 24.405334 3.413333 9.557333 5.205333 19.882667 5.205333 31.061333H714.774187a150.954667 150.954667 0 0 0-52.906667-117.930667 182.613333 182.613333 0 0 0-61.184-34.133333A245.674667 245.674667 0 0 0 521.06752 238.933333c-28.501333 0-54.613333 3.584-78.506667 10.752-23.722667 7.168-44.202667 17.237333-61.44 30.122667-17.322667 12.885333-30.72 28.586667-40.277333 46.933333a129.962667 129.962667 0 0 0-14.250667 60.757334c0 23.125333 4.608 43.349333 13.909334 60.586666a153.6 153.6 0 0 0 38.058666 45.824c16.042667 13.312 34.730667 24.746667 56.149334 34.56 21.333333 9.728 44.117333 18.432 68.266666 26.282667 21.248 6.826667 38.570667 13.226667 51.968 19.285333 13.397333 6.144 23.893333 12.288 31.488 18.602667 7.594667 6.4 12.8 13.226667 15.36 20.650667a73.898667 73.898667 0 0 1 4.010667 25.002666c0 8.533333-1.706667 16.469333-4.864 23.893334a49.834667 49.834667 0 0 1-15.104 19.2 74.922667 74.922667 0 0 1-25.6 12.629333 130.730667 130.730667 0 0 1-36.693333 4.522667c-15.616 0-29.866667-1.536-42.666667-4.778667a87.893333 87.893333 0 0 1-32.768-15.104 69.802667 69.802667 0 0 1-21.248-27.221333c-5.12-11.178667-7.594667-24.746667-7.594667-40.874667H310.294187c0 19.968 2.816 38.144 8.533333 54.613333 5.632 16.384 13.482667 31.061333 23.466667 43.946667 10.069333 12.885333 21.845333 24.149333 35.328 33.621333 13.482667 9.472 28.16 17.408 44.032 23.722667 15.786667 6.314667 32.426667 11.008 49.749333 14.08 17.408 2.986667 34.816 4.522667 52.138667 4.522667zM509.03552 921.6a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM512.534187 0a512.170667 512.170667 0 0 1 501.930666 410.453333h-87.466666A426.837333 426.837333 0 0 0 85.86752 512a426.837333 426.837333 0 0 0 325.12 414.464v87.466667A512 512 0 0 1 512.534187 0z m256.341333 848.469333a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4z m147.285333-162.048a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4zM973.334187 460.8a51.2 51.2 0 1 1 0 102.4 51.2 51.2 0 0 1 0-102.4z"},null,-1)))];le.render=function(e,t,a,l,n,i){return m(),f("i",{class:"svg-icon-wrapper",style:v({fontSize:a.size,width:a.size,height:a.size})},["STRING"===a.type?(m(),f("svg",ie,de)):"NUMBER"===a.type?(m(),f("svg",oe,se)):"DATE"===a.type?(m(),f("svg",re,ce)):"YEAR"===a.type?(m(),f("svg",ue,pe)):"QUARTER"===a.type?(m(),f("svg",me,fe)):"MONTH"===a.type?(m(),f("svg",he,ve)):"WEEK"===a.type?(m(),f("svg",be,ye)):"DAY"===a.type?(m(),f("svg",ge,ke)):"HOUR"===a.type?(m(),f("svg",we,xe)):"MINUTE"===a.type?(m(),f("svg",Ie,Te)):"SECOND"===a.type?(m(),f("svg",Ce,Ae)):h("",!0)],4)},le.__scopeId="data-v-50ec3371";const Se={name:"setting-dropdown",props:{data:{type:Object,default:()=>({})}},emits:["command"],methods:{handleCommand(e){this.$emit("command",{name:e,node:this.data})}}},ze=g("i",{class:"b-iconfont b-icon-setting setting-action",style:{cursor:"pointer"}},null,-1),Ve=T("编辑"),Ne=T("删除");function Me(e){const t=A(null),a=A(null),l=A([]),n=u({stateTree:{},flatState:[],dragging:!1,loading:!1,dimensionTree:{},dimensionTreeFlats:[],dimensionFields:[],measureTree:{},measureTreeFlats:[],measureFields:[]}),i=A(-1),d=A(-1),r=u({fieldModal:!1,filedNode:{}});function c(e,t){n.flatState[e].node.fields.forEach((e=>{e._checked=t.includes(e.field)})),f()}function p({name:e,node:t}){"edit"===e?(r.fieldModal=!0,r.filedNode={field:t.field,title:t.title,nodeKey:t.nodeKey,type:t.type}):"convert"===e?function(e){if("D"===e.type){const t=n.dimensionTreeFlats[e.nodeKey].parent,a=n.dimensionTreeFlats[t].node;if(void 0!==a){const t=a.children.indexOf(e);a.children.splice(t,1)}const l=n.measureTree.children||[];l.push({tableId:e.tableId,field:e.field,title:e.title,dataType:e.dataType,nodeType:"attribute",type:"M"}),n.measureTree.children=l,n.measureTree=Y(n.measureTree)}else{const t=n.measureTreeFlats[e.nodeKey].parent,a=n.measureTreeFlats[t].node;if(void 0!==a){const t=a.children.indexOf(e);a.children.splice(t,1)}const l=n.dimensionTree.children||[];l.push({tableId:e.tableId,field:e.field,title:e.title,dataType:e.dataType,nodeType:"attribute",type:"D"}),n.dimensionTree.children=l,n.dimensionTree=Y(n.dimensionTree)}h({dimension:n.dimensionTree,measure:n.measureTree})}(t):"delete"===e&&function(e){const{tableId:t,field:a}=e,l=n.flatState.find((e=>e.node.id===t)),i=l.nodeKey,d=l.node.fields.filter((e=>e._checked&&e.field!==a)).map((e=>e.field));c(i,d)}(t)}const m=()=>{n.flatState=G(n.stateTree)},f=()=>{const e=n.flatState.map((e=>e.node)),t=[],a=[];e.forEach((e=>{e.fields.forEach((l=>{const n={field:l.field,title:l.title,dataType:l.dataType,type:l.type,nodeType:"attribute",tableId:e.id};l._checked&&("D"===l.type?t.push(n):a.push(n))}))}));h({dimension:{title:"维度",nodeType:"root",children:t},measure:{title:"度量",nodeType:"root",children:a}})},h=e=>{const{dimension:t,measure:a}=e||{};n.dimensionTree=t||{title:"维度",nodeType:"root",children:[]},n.measureTree=a||{title:"度量",nodeType:"root",children:[]},n.dimensionTreeFlats=G(n.dimensionTree),n.measureTreeFlats=G(n.measureTree),n.dimensionFields=n.dimensionTreeFlats.filter((e=>"attribute"===e.node.nodeType)),n.measureFields=n.measureTreeFlats.filter((e=>"attribute"===e.node.nodeType))};return(async()=>{n.loading=!0;try{const{physicalSchema:t,cubeSchema:a}=await function({workspaceId:e,id:t}){return O({url:"/dataset/schema",method:"get",params:{workspaceId:e,id:t}})}(e);n.stateTree=t,m(),h(a)}catch(t){W("cube-table-list/initTable",t)}n.loading=!1})(),s(o(o({nodeEditRef:t,linkEditRef:a,tableList:l},S(n)),S(r)),{currentNodeKey:i,currentParentNodeKey:d,handleNodeClick:function(a){const l=n.flatState[a].node;i.value=a,t.value&&t.value.open(e,l)},handleNodeRemove:function(e,t){const a=n.flatState[e].node;if(0===a.nodeKey)return n.stateTree={},void m();const l=n.flatState[t].node,i=l.children.indexOf(a);l.children.splice(i,1),m(),f()},handleNodeDrop:function(e,t){const a=n.flatState[e].node,{fields:i}=a,d=l.value.find((e=>e.id===t)),{id:r,title:c,tableName:u,fields:p}=d;if(!d)return;const h=a.children||[],v=[];i.length&&p.length&&v.push({sourceKey:i[0].field,targetKey:p[0].field}),h.push({id:r,title:c,tableName:u,fields:p.map((e=>s(o({},e),{_checked:!0}))),joinType:"LEFT_OUTER_JOIN",joinKeys:v}),a.children=h,m(),f()},handleLinkClick:function(t,l){const o=n.flatState[t].node,s=n.flatState[l].node;i.value=t,d.value=l,a.value&&a.value.open(e,o,s)},handleEmptyDrop:function(e){const t=l.value.find((t=>t.id===e)),{id:a,title:i,tableName:d,fields:r}=t;t&&(n.stateTree={id:a,title:i,tableName:d,fields:r.map((e=>s(o({},e),{_checked:!0})))},m(),f())},saveSelectedFields:function(e){c(i.value,e)},saveJoinKeys:function(e,t,a){const{joinType:l,joinKeys:o}=a;c(d.value,e),c(i.value,t);const s=n.flatState[i.value].node;s.joinType=l,s.joinKeys=Y(o)},renderContent:function({root:e,node:t,data:a}){const l=[z("span",{class:`${a.type} t-ellipsis`,style:{width:"calc(100% - 24px)"},flex:"cross:center",title:`${a.title}-(${a.field})`},["root"!==a.nodeType?z(le,{type:a.dataType,style:{marginRight:"4px"}}):null,a.title])];return"root"!==a.nodeType&&l.push(z(Se,{data:a,onCommand:p})),z("span",{style:{width:"100%",fontSize:"12px"},flex:"main:justify"},l)},handleDmCommand:p,saveField:function(){const{title:e,type:t,nodeKey:a}=r.filedNode;("D"===t?n.dimensionTreeFlats[a].node:n.measureTreeFlats[a].node).title=e,r.fieldModal=!1}})}Se.render=function(e,t,a,l,n,i){const d=k("b-dropdown-item"),o=k("b-dropdown-menu"),s=k("b-dropdown");return m(),w(s,{trigger:"click",appendToBody:"",placement:"bottom-start",onCommand:i.handleCommand},{dropdown:x((()=>[I(o,null,{default:x((()=>[I(d,{icon:"edit-square",name:"edit"},{default:x((()=>[Ve])),_:1}),I(d,{icon:"swap",name:"convert"},{default:x((()=>[T(C("转换为"+("M"===a.data.type?"维度":"度量")),1)])),_:1}),I(d,{icon:"delete",name:"delete"},{default:x((()=>[Ne])),_:1})])),_:1})])),default:x((()=>[ze])),_:1},8,["onCommand"])};const Le={name:"link-node",props:{data:{type:Object,default:()=>({})},defaultIcon:{type:String,default:"table"}},setup(e){const t=V("LinkNodeInstance",{}),a=N((()=>[t.states.flatState,t.states.flatState.find((t=>t.nodeIndex===e.data.nodeIndex))]));function l(){e.data.isEmpty||t.handleNodeClick(e.data.nodeIndex)}let n=null;return{node:a,activeCommand:function(a){"selected"===a?l():"remove"===a&&function(){if(e.data.isEmpty)return;U.confirm({type:"warning",title:`确定要删除 [ ${e.data.title} ] 吗？`,message:"删除后，将清除此表相关配置，请谨慎操作。"}).then((()=>{t.handleNodeRemove(e.data.nodeIndex)})).catch((()=>{}))}()},nodeClick:l,onDragEnter:function(a){n=a.target,t.onNodeDragenter(e.data.nodeIndex)},onDragLeave:function(a){n===a.target&&t.onNodeDragleave(e.data.nodeIndex)},onDrop:function(a){t.onNodeDrop(e.data.nodeIndex,a.dataTransfer.getData("id"))}}}},Ee=e=>(b("data-v-519a72c3"),e=e(),y(),e),Fe={class:"link-node-title",style:{height:"28px",padding:"5px 8px"}},Ke={class:"link-node-name"},_e={class:"link-node-handle"},He=Ee((()=>g("span",null,"字段选择",-1))),je=Ee((()=>g("span",null,"删除",-1)));Le.render=function(e,t,a,l,n,i){const d=k("b-icon"),o=k("b-dropdown-item"),s=k("b-dropdown-menu"),r=k("b-dropdown");return m(),f("div",{class:M(["link-node-info",{"is-empty":a.data.isEmpty}]),onClick:t[1]||(t[1]=(...e)=>l.nodeClick&&l.nodeClick(...e)),onDrop:t[2]||(t[2]=e=>l.onDrop(e)),onDragover:t[3]||(t[3]=e=>e.preventDefault()),onDragenter:t[4]||(t[4]=e=>l.onDragEnter(e)),onDragleave:t[5]||(t[5]=e=>l.onDragLeave(e))},[g("div",Fe,[a.data.isEmpty?h("",!0):(m(),f("i",{key:0,class:M(["link-node-icon",`b-iconfont b-icon-${a.data.icon||a.defaultIcon}`])},null,2)),g("div",Ke,C(a.data.title),1),g("div",_e,[a.data.isEmpty?h("",!0):(m(),w(r,{key:0,placement:"bottom-end",onCommand:l.activeCommand,"append-to-body":""},{dropdown:x((()=>[I(s,{style:{width:"180px"}},{default:x((()=>[I(o,{name:"selected"},{default:x((()=>[I(d,{name:"code"}),He])),_:1}),a.data.isLeaf?(m(),w(o,{key:0,name:"remove",style:{color:"#ed4014"}},{default:x((()=>[I(d,{name:"delete"}),je])),_:1})):h("",!0)])),_:1})])),default:x((()=>[g("i",{class:"b-iconfont b-icon-ellipsis",onClick:t[0]||(t[0]=L((()=>{}),["stop","prevent"]))})])),_:1},8,["onCommand"]))])])],34)},Le.__scopeId="data-v-519a72c3";const De={name:"join-type",props:{type:{type:String,default:""},size:{type:Number,default:8}},computed:{showJoin(){return!q(J[this.type])},svgType(){return{LEFT_OUTER_JOIN:[.5,0,.5],INNER_JOIN:[0,0,.5],FULL_OUTER_JOIN:[.5,.5,.5]}[this.type]},svgSize(){return{width:3*this.size+"px",height:2*this.size+"px"}}}},Re=e=>(b("data-v-1722403c"),e=e(),y(),e),Be={key:0,class:"svg-icon-wrapper"},Ue=["fill-opacity"],Oe=["fill-opacity"],Ye=["fill-opacity"],Ge=Re((()=>g("path",{d:"M512 0c282.7776 0 512 229.2224 512 512s-229.2224 512-512 512S0 794.7776 0 512 229.2224 0 512 0z m0 51.2a460.8 460.8 0 1 0 0 921.6 460.8 460.8 0 0 0 0-921.6z",fill:"#2153D4"},null,-1))),We=Re((()=>g("path",{d:"M1024 0c282.7776 0 512 229.2224 512 512s-229.2224 512-512 512-512-229.2224-512-512S741.2224 0 1024 0z m0 51.2a460.8 460.8 0 1 0 0 921.6 460.8 460.8 0 0 0 0-921.6z",fill:"#2153D4"},null,-1)));De.render=function(e,t,a,l,n,i){return i.showJoin?(m(),f("i",Be,[(m(),f("svg",{class:"svg-icon",style:v(i.svgSize),viewBox:"0 0 1536 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[g("path",{d:"M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z",fill:"#2153D4","fill-opacity":i.svgType[0]},null,8,Ue),g("path",{d:"M1024 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z",fill:"#2153D4","fill-opacity":i.svgType[1]},null,8,Oe),g("path",{d:"M768.0512 68.5056A511.7952 511.7952 0 0 1 1024 512a511.7952 511.7952 0 0 1-255.9488 443.4944A511.6416 511.6416 0 0 1 512 512a511.744 511.744 0 0 1 249.7536-439.808z",fill:"#2153D4","fill-opacity":i.svgType[2]},null,8,Ye),Ge,We],4))])):h("",!0)},De.__scopeId="data-v-1722403c";const qe={name:"node-tip",components:{JoinType:De},props:{data:{type:Object,default:()=>({})}},setup(e){const t=V("LinkNodeInstance",{}),a=N((()=>[t.states.flatState,t.states.flatState.find((t=>t.nodeIndex===e.data.nodeIndex))])),l=N((()=>e.data.isKnee)),n=N((()=>{const[e,t]=a.value,{row:l,isKnee:n}=t.node,i=e[t.parent],d=i?i.node.row:0;return Q(l,n,d)}));return{node:a,isKnee:l,lineStyle:n,linkClick:function(){e.data.isEmpty||t.handleLinkClick(e.data.nodeIndex)}}}},Je={key:0,class:"node-icon-wrapper"};qe.render=function(e,t,a,l,n,i){const d=k("join-type");return m(),f("div",{class:M(["node-tip",{"is-empty":a.data.isEmpty}]),onClick:t[0]||(t[0]=(...e)=>l.linkClick&&l.linkClick(...e))},[a.data.isEmpty?h("",!0):(m(),f("div",Je,[I(d,{type:a.data.joinType},null,8,["type"])])),g("div",{class:"node-line horizontal",style:v(l.lineStyle[0])},null,4),g("div",{class:"node-line vertical",style:v(l.lineStyle[1])},null,4)],2)},qe.__scopeId="data-v-1c66abe1";const Qe={name:"link-node-wrapper",components:{NodeTip:qe,LinkNode:Le},props:{data:{type:Object,default:()=>({})},defaultIcon:{type:String,default:"table"},emptyText:{type:String,default:"请从左侧拖拽数据表开始创建"},emptyNodeText:{type:String,default:"拖拽左侧表至此添加关联表"},helpText:{type:String,default:"继续从左侧拖拽数据表进行表关联"},dragging:{type:Boolean,default:!1},dev:{type:Boolean,default:!1}},emits:["node-click","node-remove","link-click","node-drop","empty-drop"],setup(e,{emit:t}){const a=u({stateTree:{},flatState:[],renderList:[],maxLevel:0,maxRow:0,dragoverNodeIndex:-1}),l=A(!1),n=N((()=>q(a.stateTree))),i=N((()=>a.stateTree.isLeaf)),d=N((()=>{const t=e.dev&&l.value?{background:"red",width:"100px"}:{},{maxLevel:n,maxRow:i}=a;return Z(n,i,t)}));function r(){a.renderList=function(){const t=[];return a.flatState.forEach((a=>{const{row:l,level:n}=a.node,{nodeStyle:i,tipStyle:d}=P(l,n),r=!a.node.isEmpty||e.dragging;t.push(s(o({},a),{visible:r,nodeStyle:i,tipStyle:d}))})),t}(),a.maxLevel=Math.max.apply(Math,a.flatState.map((e=>e.node.level))),a.maxRow=Math.max.apply(Math,a.flatState.map((e=>e.node.row)))}function c(){a.stateTree=Y(e.data),function(){let t=0,l=0,n=0;const i=(a,d=0)=>{if(!q(a))if(a.nodeKey=l++,a.nodeIndex=t++,a.level=d,a.row=n,a.isEmpty=!1,q(a.children))a.isLeaf=!0,a.children=[{title:e.emptyNodeText,level:d+1,row:n,isEmpty:!0,isKnee:!1,nodeIndex:t++}];else{a.isLeaf=!1;const l=d+1;a.children.forEach(((e,t)=>{0===t?(e.row=n,e.isKnee=!1):(e.row=++n,e.isKnee=!0),i(e,l)})),a.children.push({title:e.emptyNodeText,level:d+1,nodeIndex:t++,row:++n,isEmpty:!0,isKnee:!0})}};i(a.stateTree)}(),function(){const e=[],t=(a,l,n)=>{if(q(a))return;e[a.nodeIndex]={node:a,nodeIndex:a.nodeIndex},void 0!==l&&(e[a.nodeIndex].parent=l.nodeIndex,e[l.nodeIndex].children.push(a.nodeIndex));let i=n?n.split(",").map((e=>+e)):[];void 0!==n&&(i.push(l.nodeIndex),e[a.nodeIndex].parents=i),a.children&&(e[a.nodeIndex].children=[],a.children.forEach((e=>t(e,a,i.join(",")))))};t(a.stateTree),a.flatState=e}(),r()}return E("LinkNodeInstance",{states:a,handleNodeClick:function(e){const l=a.flatState[e].node;t("node-click",l.nodeKey)},handleNodeRemove:function(e){const l=a.flatState[e],n=l.node,i=0===n.nodeKey?{}:a.flatState[l.parent].node;t("node-remove",n.nodeKey,i.nodeKey)},handleLinkClick:function(e){const l=a.flatState[e],n=l.node,i=a.flatState[l.parent].node;t("link-click",n.nodeKey,i.nodeKey)},onNodeDragenter:function(e){a.dragoverNodeIndex=e},onNodeDragleave:function(){a.dragoverNodeIndex=-1},onNodeDrop:function(e,l){const n=a.flatState[e],i=a.flatState[n.parent].node;t("node-drop",i.nodeKey,l)}}),p((()=>e.data),(()=>{c()}),{deep:!0,immediate:!0}),p((()=>e.dragging),(()=>{r()}),{immediate:!0}),s(o({},S(a)),{debugVisible:l,dataEmpty:n,linkMargin:d,onlyRoot:i,onEmptyDrop:function(e){t("empty-drop",e.dataTransfer.getData("id"))}})}},Ze=e=>(b("data-v-0889f0f8"),e=e(),y(),e),Pe={class:"link-node-wrapper"},Xe=Ze((()=>g("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAAA8CAYAAACZ1L+0AAADo0lEQVR4Ae3Bz09TBwAA4I/X51KgTl0VXCjRoYu/IiYkW4hZjFtMPO2yw/6A/Xk77DaHC8l28MeUw3AHdUPBBZmAaJxRbIG2O/RACC3QYt97Ze/7pFKpVCqVSqVSqf+dLsnSjcvI4S2eYQ7PUbUHdUmeEF/huHXL+AMPsGoPyUieCqYR4qiafSjgLFawZI/ISK45lDFgXYhjOISnKOtwGck2jx4csdEhfIJprOlgGcn3FMfQY6MsCniMsg6VkXxVLOI0umzUg35M6VAZneEd9uOwzfajhEUdKNA57mnsM/TqQBmdo4hB9Nosg2480WFCyRGgX30lvMQc+tR3ArdRxAfIa2wBFQkQSo5hfK6+OfyIBY0FOIV7yONrjd3FpAQIJUMOI2pmbbakZtnWTuMeSphV3yBG8AhvxCyUDKMIcR83NFa0tQPI4SV+Ut8XOItRjItZIH4FDKGICVsLbK/f1iZQxBAKYhaIV4CLau6gZGvdttdnayXcVXMRgRiF4jWMg1jEX9YdwFGb5W1vEC9tNo9/1fyJ0+jDMCbFpEt8cvgWIX7AknUBruC49+MJxlGx7jC+wRq+xxsxyIjPJeRxHw9tVMUM8jhod/7GOCo2WkY3+tGLaTEIxKOAIRQxob4KxjGrdbMYR0V9EyhiCAUxyIhegKvI4iYWNFbFDPrwoeY8xc8oa6yMEo7hCB6gKkIZ0buAE1jELdurYgb92G9n/sF1lG3vBQaRxxrmRSgQrRxG1NxA1c6sYQzPbO8ZxrBmZ6q4oWYEORHKiNYl5HEfDzWnghl8jJz65jGGNc1ZRjf60YtpEQlEp4AhFDGhNasYw6LNFjGGVa2ZQBFDKIhIRjQCXEUWt7CgdWVMYwC9ap7jGla0rowSjuEIHqCqzTKicQEnsIibdq+MGRSwjGtYsXsvMIg81jCvzTLaL4crCHAdy96PMqYxhZL3Zwln0I8prGijUPuNIkQRw5rzG5Y1VrK9HoxqThFZjGJcG4Xab0hNFic15x1u250LOKk1Q9osFI1V/GLnQlzGGUzindZ04wwq+BVrdu5L7NNmoWiU8URzBnAKw7ijNcMI8RCPNKeMfdoskFy/o4pzyGpeFudQxaSECiTXa0whxHnNG0aIKbyWUKFkm8SnOI8BzfkIVUxKsFCyvcJjnESf5j3CKwkWSr6bmNSatxIulHwllOxRgVSsAqlYBVKxCqRiFYpGFt/pLKEIhKITSqVSqVQqlUqlUqmU/wBjNtrujueJ3QAAAABJRU5ErkJggg==",alt:"empty"},null,-1))),$e={key:2,class:"help-wrapper"},et=Ze((()=>g("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAAB4CAYAAACkRf0fAAABs0lEQVR4Ae3BQWolSQwFwJfCdxX/REanzd4WBm+6YJpBEREAAAAAAAAAAAAAAAAAAAAAAAAAAOCfODNzs1h3nyw2MzeLVWCxCixWgcUqsFgFFqvAYhVYrAKLVWCxCixWgcUqsFgFFqvAYhVY7Cs/dPfJCzNz89DdJy/MzM1Dd5+8MDM3/Kq7T16YmZuH7j55YWZuHrr75IWZuXmowGIVWKwCi1VgsQosVoHFKrBYBRarwGIVWKwCi52ZuVmsu08Wm5mbxSqw2Fd45fv7++Yf+nw+J/y1Ciz2lR+6++SFmbl56O6TF2bm5qG7T16YmRt+1d0nL8zMzUN3n7wwMzcP3X3ywszcPFRgsa/wyufzOeF/qwKLVWCxCixWgcUqsFgFFqvAYhVYrAKLnZm5Way7TxabmZvFKrBYBRarwGJf+aG7T16YmZuH7j55YWZuHrr75IWZueFX3X3ywszcPHT3yQszc/PQ3ScvzMzNQwUWq8BiFVisAotVYLEKLFaBxSqwWAUWq8BiFVjszMzNYt19stjM3CxWgcUqsFgFAAAAAAAAAAAAAAAAAAAAAAAAAAAA/mN/AMETaOvxWxpaAAAAAElFTkSuQmCC",alt:"empty"},null,-1))),tt={key:3,class:"dev"},at={flex:"box:mean"};Qe.render=function(e,t,a,l,n,i){const d=k("node-tip"),o=k("link-node"),s=k("b-button"),r=k("b-ace-editor"),c=k("b-modal");return m(),f("div",Pe,[l.dataEmpty?(m(),f("div",{key:1,class:M({"empty-tips":!0,dragging:a.dragging}),onDrop:t[0]||(t[0]=e=>l.onEmptyDrop(e)),onDragover:t[1]||(t[1]=e=>e.preventDefault())},[Xe,g("p",null,C(a.emptyText),1)],34)):(m(),f(F,{key:0},[(m(!0),f(F,null,K(e.renderList,((t,a)=>(m(),f("div",{class:M(["link-wrapper",{"empty-highlight":t.node.isEmpty&&t.nodeIndex!==e.dragoverNodeIndex}]),key:a},[t.visible&&t.node.level>0?(m(),w(d,{key:0,data:t.node,style:v(t.tipStyle)},null,8,["data","style"])):h("",!0),t.visible?(m(),w(o,{key:1,data:t.node,style:v(t.nodeStyle)},null,8,["data","style"])):h("",!0)],2)))),128)),g("div",{class:"link-margin",style:v(l.linkMargin[0])},null,4),g("div",{class:"link-margin",style:v(l.linkMargin[1])},null,4)],64)),l.onlyRoot?(m(),f("div",$e,[et,g("p",null,C(a.helpText),1)])):h("",!0),a.dev?(m(),f("div",tt,[I(s,{type:"danger",size:"mini",icon:"bug",onClick:t[2]||(t[2]=e=>l.debugVisible=!0)}),I(c,{title:"Debug Data",width:"800",modelValue:l.debugVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>l.debugVisible=e),"destroy-on-close":""},{default:x((()=>[g("div",at,[I(r,{"model-value":JSON.stringify({sourceData:a.data},null,2)},null,8,["model-value"]),I(r,{"model-value":JSON.stringify({stateTree:e.stateTree,flatState:e.flatState},null,2)},null,8,["model-value"])])])),_:1},8,["modelValue"])])):h("",!0)])},Qe.__scopeId="data-v-0889f0f8";const lt={name:"cube-svg"},nt={class:"iconfont svg-icon-wrapper"},it=[g("svg",{class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[g("path",{d:"M93.090909 814.545455L456.145455 930.909091v-451.490909L93.090909 358.4zM512 93.090909L93.090909 232.727273l418.909091 144.290909L930.909091 232.727273zM567.854545 926.254545l363.054546-116.363636V358.4l-363.054546 116.363636z"})],-1)];lt.render=function(e,t,a,l,n,i){return m(),f("i",nt,it)};const dt={name:"cube-header",components:{CubeSvg:lt},emits:["update:modelValue","save","back"],props:{modelValue:{type:String,default:""},backUrl:{type:String}},setup(e,{emit:t}){const a=A("");return p((()=>e.modelValue),(e=>{a.value=e}),{immediate:!0}),{name:a,handleSave:()=>{t("save")},handleInputChange:e=>{t("update:modelValue",e.target.value.trim())},handleBack:()=>{t("back",e.backUrl)}}}},ot={class:"action-panel"},st={class:"header-container"},rt={class:"simple-header-left"},ct={class:"simple-cube-icon"},ut={class:"simple-header-right"},pt={class:"cube-btn",flex:"cross:center"},mt=T("保存"),ft={class:"cube-navigator"},ht=T(" 开始分析 ");dt.render=function(e,t,a,l,n,i){const d=k("b-icon"),o=k("b-tooltip"),s=k("cube-svg"),r=k("b-button"),c=k("b-space");return m(),f("div",ot,[g("div",st,[g("div",rt,[I(o,{content:"返回",theme:"light"},{default:x((()=>[g("div",{class:"simple-header-icon",onClick:t[0]||(t[0]=(...e)=>l.handleBack&&l.handleBack(...e))},[I(d,{name:"left",size:"24"})])])),_:1}),g("div",ct,[I(s)]),_(g("input",{class:"simple-header-input",placeholder:"请输入名称",maxlength:"50",type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>l.name=e),onInput:t[2]||(t[2]=(...e)=>l.handleInputChange&&l.handleInputChange(...e))},null,544),[[H,l.name]])]),g("div",ut,[g("div",pt,[I(c,{size:"large"},{default:x((()=>[I(o,{content:"另存为",theme:"light"},{default:x((()=>[I(d,{name:"file-copy",size:"18",type:"button"})])),_:1}),I(o,{content:"帮助",theme:"light"},{default:x((()=>[I(d,{name:"question-circle",size:"18",type:"button"})])),_:1}),I(r,{type:"primary",round:"",size:"mini",style:{width:"108px"},onClick:l.handleSave},{default:x((()=>[mt])),_:1},8,["onClick"])])),_:1})]),g("div",ft,[I(d,{name:"barchart",size:"16"}),ht])])])])},dt.__scopeId="data-v-1c8af8ea";const vt={name:"node-list",components:{FieldTypeIcon:le},props:{data:{type:Array,default:()=>[]},allNodeTitle:{type:Array,default:()=>[]},rootNode:{type:Object,default:()=>({})},loading:{type:Boolean}},emits:["start","end"],setup(e,{emit:t}){const a=u({visible:!1,current:{}});return s(o({},S(a)),{onDrag:function(a,l){e.rootNode.title!==l.title?(a.dataTransfer.setData("id",l.id),t("start")):B.warning("当前数据表已经存在，请不要重复关联！")},onDragEnd:function(){t("end")},handleClick:function(e){q(e.fields)||(a.visible=!0,a.current=Y(e))}})}},bt={class:"datasource-content-list",id:"table-drag"},yt=["onDragstart"],gt={class:"title"},kt={class:"table-info"},wt={class:"table-info-header"},xt={class:"table-info-title"},It={class:"fields-number"},Tt={class:"table-info-fields"},Ct={class:"table-field-icon"},At={class:"table-field-name"},St={class:"table-field-title"};vt.render=function(e,t,a,l,n,i){const d=k("b-icon"),o=k("b-divider"),s=k("field-type-icon"),r=k("b-modal"),c=j("loading"),u=j("no-data");return _((m(),f("div",bt,[(m(!0),f(F,null,K(a.data,(e=>(m(),f("div",{key:e.id,class:M(["datasource-content-item",{"has-used":a.allNodeTitle.includes(e.title)}]),draggable:"true",onDragstart:t=>l.onDrag(t,e),onDragend:t[0]||(t[0]=(...e)=>l.onDragEnd&&l.onDragEnd(...e))},[I(d,{name:"file-text",size:"16"}),g("span",gt,C(e.title),1),I(d,{name:"info-circle",type:"button",onClick:t=>l.handleClick(e)},null,8,["onClick"])],42,yt)))),128)),I(r,{modelValue:e.visible,"onUpdate:modelValue":t[1]||(t[1]=t=>e.visible=t)},{default:x((()=>[g("div",kt,[g("div",wt,C(e.current.tableName),1),g("div",xt,C(e.current.title),1),g("div",It,"包含字段"+C(e.current.fields.length),1),I(o,{style:{margin:"4px 0 16px"}}),g("div",Tt,[(m(!0),f(F,null,K(e.current.fields,(e=>(m(),f("div",{class:"table-info-field-line",key:e.field},[g("div",Ct,[I(s,{type:e.dataType},null,8,["type"])]),g("div",At,[g("span",null,C(e.field),1)]),g("div",St,[g("span",null,C(e.title),1)])])))),128))])])])),_:1},8,["modelValue"])],512)),[[c,a.loading],[u,0===a.data.length]])},vt.__scopeId="data-v-6cb408b0";const zt={name:"cube-table-list",components:{NodeList:vt},setup(){const e=A(!1),t=V("BiCube",{}),a=N((()=>t.schemaStatus.flatState.value.map((e=>e.node.title)))),l=N((()=>t.schemaStatus.stateTree.value)),n=N((()=>t.schemaStatus.tableList.value));return(async()=>{e.value=!0;try{t.schemaStatus.tableList.value=await(a=t.pageStatus.dataset.workspaceId,O({url:"/dataset/listByDsId",method:"get",params:{workspaceId:a}}))}catch(l){W("cube-table-list/initTable")}var a;e.value=!1})(),{tableList:n,tableListLoading:e,allNodeTitle:a,stateTree:l,handleDragStart:()=>{t.schemaStatus.dragging.value=!0},handleDragEnd:()=>{t.schemaStatus.dragging.value=!1}}}},Vt=e=>(b("data-v-5a84229b"),e=e(),y(),e),Nt={class:"datasource-wrapper"},Mt={class:"datasource-switcher-wrapper"},Lt=Vt((()=>g("div",{class:"datasource-label"},"选择数据源",-1))),Et={class:"datasource-table-search"},Ft=Vt((()=>g("input",{placeholder:"搜索数据表/文件",type:"text",value:""},null,-1)));zt.render=function(e,t,a,l,n,i){const d=k("b-option"),o=k("b-select"),s=k("b-icon"),r=k("node-list");return m(),f("div",Nt,[g("div",Mt,[Lt,I(o,{"model-value":"test_datasource",size:"mini"},{default:x((()=>[I(d,{value:"test_datasource",label:"探索空间"})])),_:1})]),g("div",Et,[I(s,{name:"search",type:"button"}),Ft,I(s,{name:"redo",type:"button"})]),I(r,{data:l.tableList,"all-node-title":l.allNodeTitle,"root-node":l.stateTree,loading:l.tableListLoading,onStart:l.handleDragStart,onEnd:l.handleDragEnd},null,8,["data","all-node-title","root-node","loading","onStart","onEnd"])])},zt.__scopeId="data-v-5a84229b";const Kt={name:"cube-node-edit",components:{FieldTypeIcon:le},emits:["save"],setup(e,{emit:t}){const a=A(!1),l=u({dataset:{},tableInfo:{},selections:[]}),n=N((()=>{const e=l.tableInfo.fields||[];return q(e)?"":`字段选择(${l.selections.length}/${e.length})`})),i=(e,t)=>{l.dataset=Y(e),l.tableInfo=Y(t)},d=e=>{if(e)l.selections=Y(e);else{const e=l.tableInfo.fields||[];l.selections=Y(e.filter((e=>e._checked)))}};return s(o({visible:a,tableLabel:n},S(l)),{columns:[{type:"selection",width:40,align:"center"},{title:"物理字段名",slot:"field",tooltip:!0},{title:"备注",key:"title",tooltip:!0}],setSelections:d,open:(e,t)=>{i(e,t),d(),a.value=!0},handleSave:()=>{const e=l.selections;0!==e.length?(t("save",e.map((e=>e.field))),a.value=!1):B.error({message:"请至少选择一个有效字段！",zIndex:2500})}})}},_t={class:"node-header"},Ht={class:"table-info-name t-ellipsis"},jt={class:"table-info-ds t-ellipsis"},Dt={class:"node-table-info"},Rt={key:0,class:"table-search-label mb-8"},Bt={class:"field-label",flex:"cross:center"},Ut=T("取消"),Ot=T("确定");Kt.render=function(e,t,a,l,n,i){const d=k("field-type-icon"),o=k("b-table"),s=k("b-button"),r=k("b-drawer");return m(),w(r,{modelValue:l.visible,"onUpdate:modelValue":t[1]||(t[1]=e=>l.visible=e),"mask-closable":!1,inner:"","z-index":10,width:400,styles:{padding:0}},{footer:x((()=>[I(s,{type:"primary",size:"small",transparent:"",style:{width:"120px"},onClick:t[0]||(t[0]=e=>l.visible=!1)},{default:x((()=>[Ut])),_:1}),I(s,{type:"primary",size:"small",style:{width:"120px"},onClick:l.handleSave},{default:x((()=>[Ot])),_:1},8,["onClick"])])),default:x((()=>[g("div",_t,[g("div",Ht,C(e.tableInfo.tableName),1),g("div",jt,"数据源："+C(e.dataset.datasourceName),1)]),g("div",Dt,[l.tableLabel?(m(),f("div",Rt,C(l.tableLabel),1)):h("",!0),I(o,{size:"small",columns:l.columns,data:e.tableInfo.fields,"max-height":400,onSelectionChange:l.setSelections},{field:x((({row:e})=>[g("div",Bt,[I(d,{type:e.dataType},null,8,["type"]),g("span",null,C(e.field),1)])])),_:1},8,["columns","data","onSelectionChange"])])])),_:1},8,["modelValue"])},Kt.__scopeId="data-v-b74d9bbe";const Yt={name:"join-link"},Gt={class:"svg-icon-wrapper icon-bi-engine-ziduanguanlian"},Wt=[g("svg",{class:"svg-icon",viewBox:"0 0 3686 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[g("path",{d:"M409.6 0a512 512 0 1 1 0 1024H0V867.9424h409.6c169.6768 0 344.064-186.368 344.064-355.9424 0-169.6768-174.3872-354.6112-344.064-354.6112H0V0h409.6z m3276.8 0v157.3888h-409.6c-169.6768 0-347.8528 185.6512-347.8528 355.328 0 169.5744 178.176 355.2256 347.8528 355.2256h409.6V1024h-409.6a512 512 0 1 1 0-1024h409.6zM1638.4 0h409.6a512 512 0 1 1 0 1024h-409.6a512 512 0 1 1 0-1024z m0 157.3888c-169.6768 0-348.3648 185.6512-348.3648 355.328 0 169.5744 178.688 355.2256 348.3648 355.2256h409.6c169.6768 0 349.4912-185.6512 349.4912-355.328 0-169.5744-179.8144-355.2256-349.4912-355.2256h-409.6zM409.6 579.584v-153.6h1228.8v153.6H409.6z m1638.4 0v-153.6h1228.8v153.6H2048z",fill:"#000000","fill-opacity":".4"})],-1)];Yt.render=function(e,t,a,l,n,i){return m(),f("i",Gt,Wt)};const qt={name:"cube-link-edit",components:{JoinLink:Yt,JoinType:De,FieldTypeIcon:le},emits:["save"],setup(e,{emit:t}){const a=A(!1),l=u({dataset:{},tableInfo:{},selections:[],parentTableInfo:{},parentSelections:[]}),n=N((()=>{const e=l.tableInfo.fields||[];return q(e)?"":`字段选择(${l.selections.length}/${e.length})`})),i=N((()=>{const e=l.parentTableInfo.fields||[];return q(e)?"":`字段选择(${l.parentSelections.length}/${e.length})`})),d=(e,t,a)=>{l.dataset=Y(e),l.tableInfo=Y(t),l.parentTableInfo=Y(a)},r=e=>{if(e)l.selections=Y(e);else{const e=l.tableInfo.fields||[];l.selections=Y(e.filter((e=>e._checked)))}},c=e=>{if(e)l.parentSelections=Y(e);else{const e=l.parentTableInfo.fields||[];l.parentSelections=Y(e.filter((e=>e._checked)))}};return s(o({JOIN_TYPE:J,visible:a,tableLabel:n,parentTableLabel:i},S(l)),{columns:[{type:"selection",width:40,align:"center"},{title:"物理字段名",slot:"field",tooltip:!0},{title:"备注",key:"title",tooltip:!0}],setSelections:r,setParentSelections:c,open:(e,t,l)=>{d(e,t,l),r(),c(),a.value=!0},handleSave:()=>{const e=l.parentSelections;if(0===e.length)return void B.error(`${l.parentTableInfo.tableName} 至少需要选择一个有效字段！`);const n=l.selections;if(0!==n.length)if(0!==l.tableInfo.joinKeys.length){if(l.tableInfo.joinKeys.length){if(l.tableInfo.joinKeys.find((e=>q(e.sourceKey)||q(e.targetKey))))return void B.error("关联的字段不能为空！")}t("save",e.map((e=>e.field)),n.map((e=>e.field)),l.tableInfo),a.value=!1}else B.error("至少需要一个关联关系！");else B.error(`${l.tableInfo.tableName} 至少需要选择一个有效字段！`)},addJoinKey:()=>{l.tableInfo.joinKeys.push({sourceKey:"",targetKey:""})},removeKey:e=>{l.tableInfo.joinKeys.splice(e,1)}})}},Jt=e=>(b("data-v-7b93aa9a"),e=e(),y(),e),Qt={flex:"box:mean",class:"table-config-wrap"},Zt={class:"node-table-info"},Pt={key:0,class:"table-search-label mb-5"},Xt={key:1,class:"table-search-label mb-8"},$t={class:"field-label",flex:"cross:center"},ea={class:"node-table-info"},ta={key:0,class:"table-search-label mb-5"},aa={key:1,class:"table-search-label mb-8"},la={class:"field-label",flex:"cross:center"},na={class:"table-join-keys"},ia={class:"join-keys-header"},da=Jt((()=>g("div",null,"数据关联",-1))),oa={class:"right"},sa=T("添加关联字段 "),ra={class:"table-name-wrapper"},ca=["title"],ua=["title"],pa=Jt((()=>g("div",{class:"link-operation"},"操作",-1))),ma={class:"fields-key-wrapper"},fa={style:{float:"right",color:"#ccc"}},ha={style:{float:"right",color:"#ccc"}},va={class:"field-delete"},ba=T("取消"),ya=T("确定");qt.render=function(e,t,a,l,n,i){const d=k("field-type-icon"),o=k("b-table"),s=k("join-type"),r=k("b-space"),c=k("b-option"),u=k("b-select"),p=k("b-button"),v=k("join-link"),b=k("b-icon"),y=k("b-drawer");return m(),w(y,{modelValue:l.visible,"onUpdate:modelValue":t[2]||(t[2]=e=>l.visible=e),title:"编辑关联关系","mask-closable":!1,inner:"",width:800,styles:{padding:0}},{footer:x((()=>[I(p,{type:"primary",size:"small",transparent:"",style:{width:"120px"},onClick:t[1]||(t[1]=e=>l.visible=!1)},{default:x((()=>[ba])),_:1}),I(p,{type:"primary",size:"small",style:{width:"120px"},onClick:l.handleSave},{default:x((()=>[ya])),_:1},8,["onClick"])])),default:x((()=>[g("div",Qt,[g("div",Zt,[l.tableLabel?(m(),f("div",Pt,C(e.parentTableInfo.tableName),1)):h("",!0),l.parentTableLabel?(m(),f("div",Xt,C(l.parentTableLabel),1)):h("",!0),I(o,{size:"small",columns:l.columns,data:e.parentTableInfo.fields,"max-height":240,onSelectionChange:l.setParentSelections},{field:x((({row:e})=>[g("div",$t,[I(d,{type:e.dataType},null,8,["type"]),g("span",null,C(e.field),1)])])),_:1},8,["columns","data","onSelectionChange"])]),g("div",ea,[l.tableLabel?(m(),f("div",ta,C(e.tableInfo.tableName),1)):h("",!0),l.tableLabel?(m(),f("div",aa,C(l.tableLabel),1)):h("",!0),I(o,{size:"small",columns:l.columns,data:e.tableInfo.fields,"max-height":240,onSelectionChange:l.setSelections},{field:x((({row:e})=>[g("div",la,[I(d,{type:e.dataType},null,8,["type"]),g("span",null,C(e.field),1)])])),_:1},8,["columns","data","onSelectionChange"])])]),g("div",na,[g("div",ia,[da,g("div",oa,[I(r,null,{default:x((()=>[I(u,{modelValue:e.tableInfo.joinType,"onUpdate:modelValue":t[0]||(t[0]=t=>e.tableInfo.joinType=t),size:"mini",style:{width:"110px"}},{prefix:x((()=>[I(s,{size:6,type:e.tableInfo.joinType,style:{position:"relative",top:"-2px",left:"4px","background-color":"transparent"}},null,8,["type"])])),default:x((()=>[(m(!0),f(F,null,K(l.JOIN_TYPE,((e,t)=>(m(),w(c,{key:t,value:t,label:e.label},{default:x((()=>[I(r,null,{default:x((()=>[I(s,{size:6,type:t,style:{"background-color":"transparent"}},null,8,["type"]),g("span",null,C(e.label),1)])),_:2},1024)])),_:2},1032,["value","label"])))),128))])),_:1},8,["modelValue"]),I(p,{type:"primary",transparent:"",size:"mini",icon:"plus",onClick:l.addJoinKey},{default:x((()=>[sa])),_:1},8,["onClick"])])),_:1})])]),g("div",ra,[g("div",{class:"table-name",title:e.parentTableInfo.tableName},C(e.parentTableInfo.tableName),9,ca),g("div",{class:"table-name",title:e.tableInfo.tableName},C(e.tableInfo.tableName),9,ua),pa]),g("div",ma,[(m(!0),f(F,null,K(e.tableInfo.joinKeys,((t,a)=>(m(),f("div",{class:"fields-key-line",key:a},[I(u,{modelValue:e.tableInfo.joinKeys[a].sourceKey,"onUpdate:modelValue":t=>e.tableInfo.joinKeys[a].sourceKey=t,size:"small",style:{width:"300px"}},{default:x((()=>[(m(!0),f(F,null,K(e.parentTableInfo.fields,(e=>(m(),w(c,{key:e.field,value:e.field,label:e.field+"("+e.title+")"},{default:x((()=>[g("span",null,C(e.field),1),g("span",fa,C(e.title),1)])),_:2},1032,["value","label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),I(v,{style:{width:"36px",height:"48px","font-size":"36px"}}),I(u,{modelValue:e.tableInfo.joinKeys[a].targetKey,"onUpdate:modelValue":t=>e.tableInfo.joinKeys[a].targetKey=t,size:"small",style:{width:"300px"}},{default:x((()=>[(m(!0),f(F,null,K(e.tableInfo.fields,(e=>(m(),w(c,{key:e.field,value:e.field,label:e.field+"("+e.title+")"},{default:x((()=>[g("span",null,C(e.field),1),g("span",ha,C(e.title),1)])),_:2},1032,["value","label"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),g("div",va,[I(p,{type:"text","text-color":"info",disabled:e.tableInfo.joinKeys.length<=1,onClick:e=>l.removeKey(a)},{default:x((()=>[I(b,{name:"delete",size:"18"})])),_:2},1032,["disabled","onClick"])])])))),128))])])])),_:1},8,["modelValue"])},qt.__scopeId="data-v-7b93aa9a";const ga={name:"cube-field-table",components:{SettingDropdown:Se,FieldTypeIcon:le},props:{dimensionFields:{type:Array,default:()=>[]},measureFields:{type:Array,default:()=>[]}},emits:["command"],setup(e,{emit:t}){const a=A(null),l=u({tableWrapStyle:{},topHeaderStyle:{}});function n(){if(!a.value)return;const t=a.value.clientWidth,n=120*(e.dimensionFields.length+e.measureFields.length),i=n<t?91:97;l.tableWrapStyle={width:`${t}px`,height:`${i}px`},l.topHeaderStyle={width:`${n}px`,height:"91px"}}return D((()=>{X(a.value,n)})),R((()=>{$(a.value,n)})),s(o({containerRef:a},S(l)),{onMouseEnter:function(e){e.target.classList.add("is-hover")},onMouseLeave:function(e){e.target.classList.remove("is-hover")},handleCommand:function({name:e,node:a}){t("command",{name:e,node:a})}})}},ka=e=>(b("data-v-634eb7b8"),e=e(),y(),e),wa={class:"cube-table-container",ref:"containerRef"},xa={class:"table-container"},Ia={class:"top-header-container-box"},Ta={class:"row"},Ca=["title"],Aa={class:"content"},Sa={class:"cube-table-tip-cell"},za={key:0,class:"svg-icon-wrapper"},Va=[ka((()=>g("svg",{class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[g("path",{d:"M512 42.666667L316.330667 289.450667H425.813333v287.829333L172.544 722.261333l-54.698667-93.866666L0 919.637333l313.429333 44.544-54.613333-93.866666L512 725.333333 765.269333 870.4l-54.698666 93.866667L1024 919.808l-117.76-291.413333-54.784 93.866666-253.184-144.896V289.450667h109.312z"})],-1)))],Na=ka((()=>g("div",{class:"tip-background dimension"},null,-1))),Ma={key:1},La=["title"],Ea={class:"content"},Fa={class:"cube-table-tip-cell"},Ka={key:0,class:"svg-icon-wrapper"},_a=[ka((()=>g("svg",{class:"svg-icon",viewBox:"0 0 1024 1024","aria-hidden":"true",width:"1em",height:"1em",fill:"currentColor"},[g("path",{d:"M782.677333 550.144L1024 791.296 791.296 1024l-55.04-55.04 80.469333-80.384-46.592-46.592-80.469333 80.469333-46.506667-46.592 80.469334-80.384-46.592-46.506666-80.384 80.384-46.592-46.592 232.618666-232.618667z m12.8-537.429333l215.808 215.808-685.397333 685.482666-260.266667 44.373334 44.373334-260.266667L795.477333 12.8z m0 156.842666L213.333333 751.616l-12.117333 71.082667 71.082667-12.117334 582.058666-582.144-58.88-58.88zM232.704 0l241.152 241.237333-232.618667 232.618667-42.325333-42.24 80.384-80.469333-46.592-46.506667-80.384 80.469333-46.592-46.592 80.469333-80.469333-46.592-46.421333-80.384 80.384L0 232.704 232.704 0z"})],-1)))],Ha=ka((()=>g("div",{class:"tip-background measure"},null,-1))),ja={key:1},Da={class:"row"},Ra=["title"],Ba={class:"content"},Ua={class:"cube-table-header-cell"},Oa={class:"cube-table-header-cell-top"},Ya={class:"cube-table-header-cell-bottom dimension"},Ga=["title"],Wa={class:"content"},qa={class:"cube-table-header-cell"},Ja={class:"cube-table-header-cell-top"},Qa={class:"cube-table-header-cell-bottom measure"},Za={class:"preview-data-refresh-tips"},Pa={class:"preview-data-refresh-tips-icon-line"},Xa=T(" 您可以点击右侧的 "),$a=T("刷新数据"),el=T(" 按钮 "),tl=ka((()=>g("div",null,"来预览并配置数据",-1)));ga.render=function(e,t,a,l,n,i){const d=k("field-type-icon"),o=k("setting-dropdown"),s=k("b-button");return m(),f("div",wa,[g("div",{class:"bi-awesome-matrix-table",style:v(e.tableWrapStyle),onMouseenter:t[0]||(t[0]=(...e)=>l.onMouseEnter&&l.onMouseEnter(...e)),onMouseleave:t[1]||(t[1]=(...e)=>l.onMouseLeave&&l.onMouseLeave(...e))},[g("div",xa,[g("div",Ia,[g("div",{class:"top-header",style:v(e.topHeaderStyle)},[g("div",Ta,[(m(!0),f(F,null,K(a.dimensionFields,((e,t)=>(m(),f("div",{class:"table-cell",key:t,style:{width:"120px",height:"32px","border-right-width":"1px"},title:0===t?"维度":""},[g("div",Aa,[g("div",Sa,[0===t?(m(),f("i",za,Va)):h("",!0),Na,0===t?(m(),f("span",Ma,"维度")):h("",!0)])])],8,Ca)))),128)),(m(!0),f(F,null,K(a.measureFields,((e,t)=>(m(),f("div",{class:"table-cell",key:t,style:{width:"120px",height:"32px","border-right-width":"1px"},title:0===t?"度量":""},[g("div",Ea,[g("div",Fa,[0===t?(m(),f("i",Ka,_a)):h("",!0),Ha,0===t?(m(),f("span",ja,"度量")):h("",!0)])])],8,La)))),128))]),g("div",Da,[(m(!0),f(F,null,K(a.dimensionFields,((e,t)=>(m(),f("div",{class:"table-cell",key:t,style:{width:"120px",height:"59px","border-right-width":"1px"},title:e.node.title},[g("div",Ba,[g("div",Ua,[g("div",Oa,C(e.node.title),1),g("div",Ya,[I(d,{type:e.node.dataType},null,8,["type"]),I(o,{data:e.node,onCommand:l.handleCommand},null,8,["data","onCommand"])])])])],8,Ra)))),128)),(m(!0),f(F,null,K(a.measureFields,((e,t)=>(m(),f("div",{class:"table-cell",key:t,style:{width:"120px",height:"59px","border-right-width":"1px"},title:e.node.title},[g("div",Wa,[g("div",qa,[g("div",Ja,C(e.node.title),1),g("div",Qa,[I(d,{type:e.node.dataType},null,8,["type"]),I(o,{data:e.node,onCommand:l.handleCommand},null,8,["data","onCommand"])])])])],8,Ga)))),128))])],4)])])],36),g("div",Za,[g("div",Pa,[Xa,I(s,{type:"text",icon:"reload"},{default:x((()=>[$a])),_:1}),el]),tl])],512)},ga.__scopeId="data-v-634eb7b8";const al={name:"Cube",components:{CubeFieldTable:ga,CubeLinkEdit:qt,CubeNodeEdit:Kt,SvgLoading:ee,LinkNodeWrapper:Qe,CubeTableList:zt,PageCubeWrapper:te,CubeHeader:dt},setup(){const e=ae(),t=Me(e.dataset);return E("BiCube",{schemaStatus:t,pageStatus:e}),o(o({dev:!0,debugVisible:A(!1)},e),t)}},ll={class:"bi-cube-container"},nl={class:"bi-cube-wrapper"},il={key:0,flex:"main:center cross:center",class:"full-wrapper"},dl={class:"default-wrapper"},ol={class:"table-header"},sl=(e=>(b("data-v-7339a9f5"),e=e(),y(),e))((()=>g("div",{class:"header-tabs"},[g("span",{class:"tab active"},"数据预览")],-1))),rl={class:"right-col"},cl={key:0,class:"mr-8"},ul={flex:"box:mean"},pl=T("刷新预览"),ml={class:"preview-data-content"},fl={class:"preview-data-scroll"},hl={class:"preview-data-left"},vl={class:"cube-field-panel"},bl={class:"cube-tree"},yl={class:"cube-tree"},gl={class:"preview-data-right"},kl=T("取 消"),wl=T("确 定");al.render=function(e,t,a,l,n,i){const d=k("cube-header"),o=k("svg-loading"),s=k("cube-table-list"),r=k("link-node-wrapper"),c=k("b-button"),u=k("b-ace-editor"),p=k("b-modal"),v=k("b-tree"),b=k("b-scrollbar"),y=k("cube-field-table"),T=k("page-cube-wrapper"),A=k("cube-node-edit"),S=k("cube-link-edit"),z=k("b-form-item"),V=k("b-input"),N=k("b-form");return m(),f("div",ll,[I(d,{modelValue:e.dataset.datasetName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dataset.datasetName=t),"back-url":"/datasetDemo",onSave:e.handleSave,onBack:e.handleBack},null,8,["modelValue","onSave","onBack"]),g("div",nl,[e.loading?(m(),f("div",il,[I(o,{name:"loading02"})])):(m(),w(T,{key:1,class:"full-wrapper"},{left:x((()=>[I(s)])),default:x((()=>[g("div",dl,[I(r,{dragging:e.dragging,data:e.stateTree,onNodeClick:e.handleNodeClick,onNodeRemove:e.handleNodeRemove,onNodeDrop:e.handleNodeDrop,onLinkClick:e.handleLinkClick,onEmptyDrop:e.handleEmptyDrop,dev:l.dev},null,8,["dragging","data","onNodeClick","onNodeRemove","onNodeDrop","onLinkClick","onEmptyDrop","dev"])])])),draggable:x((()=>[g("div",ol,[sl,g("div",rl,[l.dev?(m(),f("span",cl,[I(c,{type:"danger",size:"mini",icon:"bug",onClick:t[1]||(t[1]=e=>l.debugVisible=!0)}),I(p,{title:"Debug Data",width:"800",modelValue:l.debugVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>l.debugVisible=e),"destroy-on-close":""},{default:x((()=>[g("div",ul,[I(u,{"model-value":JSON.stringify({dimensionTree:e.dimensionTree,measureTree:e.measureTree},null,2)},null,8,["model-value"]),I(u,{"model-value":JSON.stringify({dimensionFields:e.dimensionFields,measureFields:e.measureFields},null,2)},null,8,["model-value"])])])),_:1},8,["modelValue"])])):h("",!0),I(c,{type:"primary",size:"mini",icon:"reload"},{default:x((()=>[pl])),_:1})])]),g("div",ml,[g("div",fl,[g("div",hl,[g("div",vl,[I(b,null,{default:x((()=>[g("div",bl,[I(v,{data:[e.dimensionTree],render:e.renderContent,ref:"tree","default-expand":"","lock-select":""},null,8,["data","render"])]),g("div",yl,[I(v,{data:[e.measureTree],render:e.renderContent,ref:"tree","default-expand":"","lock-select":""},null,8,["data","render"])])])),_:1})])]),g("div",gl,[I(y,{"dimension-fields":e.dimensionFields,"measure-fields":e.measureFields,onCommand:e.handleDmCommand},null,8,["dimension-fields","measure-fields","onCommand"])])])])])),_:1})),I(A,{ref:"nodeEditRef",onSave:e.saveSelectedFields},null,8,["onSave"]),I(S,{ref:"linkEditRef",onSave:e.saveJoinKeys},null,8,["onSave"]),I(p,{modelValue:e.fieldModal,"onUpdate:modelValue":t[5]||(t[5]=t=>e.fieldModal=t),title:"编辑字段"},{footer:x((()=>[I(c,{onClick:t[4]||(t[4]=t=>e.fieldModal=!1)},{default:x((()=>[kl])),_:1}),I(c,{type:"primary",onClick:e.saveField},{default:x((()=>[wl])),_:1},8,["onClick"])])),default:x((()=>[I(N,{model:e.filedNode,"label-width":"90px"},{default:x((()=>[I(z,{label:"字段名",required:""},{default:x((()=>[g("label",null,C(e.filedNode.field),1)])),_:1}),I(z,{prop:"title",label:"字段标题",required:""},{default:x((()=>[I(V,{modelValue:e.filedNode.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.filedNode.title=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])])},al.__scopeId="data-v-7339a9f5";export{al as default};
