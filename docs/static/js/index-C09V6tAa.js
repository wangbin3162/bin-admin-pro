import{r as j,aI as q,n as G,l as L,aJ as Z,a8 as N,Q as f,o as h,a as $,b as e,H as A,F,R as Y,L as s,K as t,t as x,a9 as E,aa as M,aK as ee,I as C,aL as te,j as oe,w as l,aM as se,i as ne,f as y,aN as V,aO as D,aP as ae,aQ as ie,aR as le,aS as de,aT as ce,ag as re}from"./vendor-yvfxTJov.js";import{o as ue}from"./index-DqgoGRKG.js";import{c as _e}from"./chunk-bin-ui-design-D_EbM8sf.js";import"./chunk-brace-DkiLfVT0.js";import"./chunk-mockjs-B6s4ORgB.js";const pe={Start:"start",Simple:"simple",Multiple:"multiple",End:"end"},g={Start:{icon:"play-circle-fill",iconColor:"#3370ff",title:"任务入口",desc:"用户发起一个任务后，流程将会从这个模块开始执行。"},Simple:{icon:"index",iconColor:"#8b81c3",title:"简单任务",desc:"串行单一任务，节点只可以配置一个执行任务。"},Multiple:{icon:"Partition",iconColor:"#13c2c2",title:"并联任务",desc:"并联任务，节点可以配置多个执行任务，可以并行执行，并指定条件。"},End:{icon:"stop-fill",iconColor:"#dd6a5e",title:"任务终止",desc:"执行到该节点时，本次任务调用将会结束。"}};function W(){return{jobId:"",jobName:"",error:""}}const me={draggedType:j(null),isDragging:j(!1)};function H(){const{draggedType:o,isDragging:p}=me,{addNodes:_,screenToFlowCoordinate:m,onNodesInitialized:d,updateNode:a}=q();G(p,u=>{document.body.style.userSelect=u?"none":""});function v(u,i){u.dataTransfer&&(u.dataTransfer.setData("application/vueflow",i),u.dataTransfer.effectAllowed="move"),o.value=i,p.value=!0,document.addEventListener("drop",n)}function n(){p.value=!1,o.value=null,document.removeEventListener("drop",n)}function c(u){u.preventDefault(),o.value&&u.dataTransfer&&(u.dataTransfer.dropEffect="move")}function r(u){const i=m({x:u.clientX,y:u.clientY}),b=`${{start:"StartNode",simple:"SimpleNode",multiple:"MultipleNode",end:"EndNode"}[o.value]}${ue()}`,w={id:b,type:o.value,position:i,label:`[${b}]`};o.value==="simple"&&(w.data=W()),o.value==="multiple"&&(w.data={parallel:[W()],errorPairing:1,poly:!0});const{off:z}=d(()=>{a(b,I=>({position:{x:I.position.x-I.dimensions.width/2,y:I.position.y-I.dimensions.height/2}})),z()});_(w)}return{draggedType:o,isDragging:p,onDragStart:v,onDragOver:c,onDrop:r}}function K(){const{addEdges:o,removeEdges:p,nodesDraggable:_,nodesConnectable:m}=q();function d(n){a(n)&&o({...n,animated:!0,style:{stroke:"#b1b1b7",strokeWidth:2},markerEnd:Z.Arrow,type:"button"})}function a(n){const{sourceHandle:c,targetHandle:r}=n;return c==="_StartA_source_"&&r==="_EndA_target_"?!1:r.includes("_target_")}const v=L(()=>!_.value&&!m.value);return{onConnect:d,removeEdges:p,isNotInteractive:v,nodesDraggable:_,nodesConnectable:m}}const R=o=>(E("data-v-f4a6886e"),o=o(),M(),o),fe=R(()=>e("svg",{viewBox:"0 0 16 16",focusable:"false",class:"chakra-icon css-yubj9j","aria-hidden":"true"},[e("path",{d:"M9.41 8l2.29-2.29c.19-.18.3-.43.3-.71a1.003 1.003 0 0 0-1.71-.71L8 6.59l-2.29-2.3a1.003 1.003 0 0 0-1.42 1.42L6.59 8 4.3 10.29c-.19.18-.3.43-.3.71a1.003 1.003 0 0 0 1.71.71L8 9.41l2.29 2.29c.18.19.43.3.71.3a1.003 1.003 0 0 0 .71-1.71L9.41 8z","fill-rule":"evenodd",fill:"currentColor"})],-1)),ge=[fe],ve={class:"description",flex:"main:justify cross:center"},he=R(()=>e("div",{class:"title"},"你可以拖拽这些节点到画布",-1)),be={class:"chakra-icon css-cwl0hy",viewBox:"0 0 1025 1024",xmlns:"http://www.w3.org/2000/svg",width:"64.063",height:"64",focusable:"false","aria-hidden":"true",style:{width:"14px"}},$e=R(()=>e("path",{d:"M533.353 682.285c0-.03.06-.06.06-.09-.24 0-.27.03-.06.09zM40.177 555.008l314.398 314.398c27.046 27.046 70.927 27.046 97.943 0 27.045-26.985 27.045-70.867 0-97.912L256.33 575.277h665.63c38.25 0 69.24-31.021 69.24-69.24 0-38.28-31.02-69.27-69.24-69.27h-665.6L452.548 240.58c27.045-27.016 27.045-70.927 0-97.943-13.523-13.523-31.262-20.3-49.002-20.3-17.709 0-35.448 6.777-48.94 20.3L40.175 457.065c-27.075 27.046-27.075 70.867 0 97.943z"},null,-1)),ye=[$e],xe={class:"nodes"},we=["onDragstart"],Ce={class:"info"},Se={class:"title"},ke={class:"desc"},Ne={__name:"Sidebar",setup(o){const{onDragStart:p}=H(),_=j(!1);return(m,d)=>{const a=f("b-icon");return h(),$("div",null,[e("button",{type:"button",class:A(["chakra-button",{"is-hide":!_.value}]),onClick:d[0]||(d[0]=v=>_.value=!0)},ge,2),e("aside",{class:A(["drag-panel",{"is-hide":!_.value}])},[e("div",ve,[he,e("div",{class:"back",onClick:d[1]||(d[1]=v=>_.value=!1)},[(h(),$("svg",be,ye))])]),e("div",xe,[(h(!0),$(F,null,Y(s(g),(v,n)=>(h(),$("div",{class:"node",draggable:!0,key:n,onDragstart:c=>s(p)(c,s(pe)[n])},[t(a,{class:"chakra-image",name:s(g)[n].icon,color:s(g)[n].iconColor},null,8,["name","color"]),e("div",Ce,[e("div",Se,x(s(g)[n].title),1),e("div",ke,x(s(g)[n].desc),1)])],40,we))),128))])],2)])}}},Ie=N(Ne,[["__scopeId","data-v-f4a6886e"]]),je=o=>(E("data-v-43a1996f"),o=o(),M(),o),Ve=je(()=>e("svg",{class:"chakra-icon edgebutton",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",focusable:"false"},[e("path",{d:"M848.418 174.49q69.905 69.905 104.312 157.286t34.406 179.132-34.406 179.131-104.312 157.287-157.286 104.857T512 987.136t-179.678-34.953T174.49 847.326 69.632 690.039 34.679 510.908t34.953-179.132T174.49 174.49 332.322 70.178 512 35.772t179.132 34.406T848.418 174.49zM734.822 729.36q22.938-22.938 20.207-52.429t-25.668-52.429L614.673 509.815l114.688-114.688Q752.3 372.19 755.03 342.7t-20.207-52.43-55.16-22.937-55.159 22.938L509.815 403.866l-111.41-111.412q-22.938-21.845-52.43-24.576t-52.428 19.115q-22.938 22.938-22.938 55.706t22.938 55.705l111.41 111.411-111.41 111.412q-22.938 22.937-22.938 55.16t22.938 55.159 52.428 20.207 52.43-25.669l111.41-111.41L624.503 729.36q22.938 22.938 55.16 22.938t55.16-22.938z"})],-1)),De=[Ve],Ee={inheritAttrs:!1},Me=Object.assign(Ee,{__name:"EdgeWithButton",props:{id:{type:String,required:!0},sourceX:{type:Number,required:!0},sourceY:{type:Number,required:!0},targetX:{type:Number,required:!0},targetY:{type:Number,required:!0},sourcePosition:{type:String,required:!0},targetPosition:{type:String,required:!0},markerEnd:{type:String,required:!1},style:{type:Object,required:!1}},setup(o){const p=o,{removeEdges:_,nodesConnectable:m}=K(),d=L(()=>ee(p));return(a,v)=>(h(),$(F,null,[t(s(te),{id:o.id,style:C(o.style),path:d.value[0],"marker-end":o.markerEnd},null,8,["id","style","path","marker-end"]),s(m)?(h(),oe(s(se),{key:0},{default:l(()=>[e("div",{style:C({pointerEvents:"all",position:"absolute",transform:`translate(-50%, -50%) translate(${d.value[1]}px,${d.value[2]}px)`}),class:"nodrag nopan",onClick:v[0]||(v[0]=n=>s(_)(o.id))},De,4)]),_:1})):ne("",!0)],64))}}),qe=N(Me,[["__scopeId","data-v-43a1996f"]]);function T(){const{removeNodes:o,getSelectedNodes:p,nodesDraggable:_,nodesConnectable:m}=q();function d(n){_e.confirm({type:"error",title:"删除提示",message:"确认删除该节点？"}).then(()=>{o(n.id,!0)}).catch(()=>{})}function a(n){return p.value.findIndex(c=>c.id===n.id)>-1}const v=L(()=>!_.value&&!m.value);return{deleteNode:d,isNodeSelected:a,isNotInteractive:v}}const Le=o=>(E("data-v-bc1874f5"),o=o(),M(),o),Te={class:"custom-node"},Oe={class:"custom-node-inner"},ze={class:"top-box"},Be={class:"title"},Ae={class:"desc"},We={class:"nodrag controller-menu"},Fe={class:"css-0"},Re={class:"custom-node-inner divider"},Ue={class:"nodrag trigger"},Je={class:"trigger-handle"},Xe=Le(()=>e("div",{class:"trigger-name"},"执行任务",-1)),Ye={__name:"StartNode",props:{node:{type:Object,required:!0}},setup(o){const{deleteNode:p}=T();return(_,m)=>{const d=f("b-icon");return h(),$("div",Te,[e("div",Oe,[e("div",ze,[t(d,{class:"chakra-image",name:s(g).Start.icon,color:s(g).Start.iconColor},null,8,["name","color"]),e("div",Be,x(s(g).Start.title),1)]),e("div",Ae,x(s(g).Start.desc),1),e("div",We,[e("div",Fe,[e("button",{type:"button",class:"chakra-button delete",onClick:m[0]||(m[0]=a=>s(p)(o.node))},[t(d,{name:"delete"}),y(" 删除 ")])])])]),e("div",Re,[e("div",Ue,[e("div",Je,[t(s(D),{id:"_StartA_source_",type:"source",position:s(V).Right,style:C({width:"14px",height:"14px",borderWidth:"3.5px",backgroundColor:"#fff",borderColor:"rgb(54, 173, 239)"})},null,8,["position","style"])]),Xe])])])}}},He=N(Ye,[["__scopeId","data-v-bc1874f5"]]),U=o=>(E("data-v-0f910af3"),o=o(),M(),o),Ke={class:"custom-node"},Pe={class:"custom-node-inner"},Qe={class:"top-box"},Ge={class:"title"},Ze={class:"desc"},et={class:"nodrag controller-menu"},tt={class:"css-0"},ot={class:"nodrag trigger mt-8"},st={class:"trigger-handle"},nt=U(()=>e("div",{class:"trigger-name"},"触发器",-1)),at={class:"trigger-handle-right"},it=U(()=>e("div",{class:"trigger-name"},"执行任务结束",-1)),lt={class:"nowheel"},dt=U(()=>e("div",{class:"middle-info"},"配置",-1)),ct={class:"edit-box nodrag"},rt={__name:"SimpleNode",props:{node:{type:Object,required:!0}},emits:["update:node"],setup(o,{emit:p}){const _=p,m=o,{deleteNode:d}=T(),a=L({get:()=>m.node,set:v=>_("update:node",v)});return(v,n)=>{const c=f("b-icon"),r=f("b-option"),u=f("b-select"),i=f("b-form-item"),S=f("b-form");return h(),$("div",Ke,[e("div",Pe,[e("div",Qe,[t(c,{class:"chakra-image",name:s(g).Simple.icon,color:s(g).Simple.iconColor},null,8,["name","color"]),e("div",Ge,x(s(g).Simple.title),1)]),e("div",Ze,x(s(g).Simple.desc),1),e("div",et,[e("div",tt,[e("button",{type:"button",class:"chakra-button delete",onClick:n[0]||(n[0]=b=>s(d)(o.node))},[t(c,{name:"delete"}),y(" 删除 ")])])]),e("div",ot,[e("div",st,[t(s(D),{id:"_SimpleA_target_",type:"target",position:s(V).Left,style:C({width:"14px",height:"14px",borderWidth:"3.5px",backgroundColor:"#fff",borderColor:"rgb(54, 173, 239)"})},null,8,["position","style"])]),nt,e("div",at,[t(s(D),{id:"_SimpleA_source_",type:"source",position:s(V).Right,style:C({width:"14px",height:"14px",borderWidth:"3.5px",backgroundColor:"#fff",borderColor:"rgb(165, 88, 201)"})},null,8,["position","style"])]),it])]),e("div",lt,[dt,e("div",ct,[t(S,{style:{width:"200px"}},{default:l(()=>[t(i,{label:"任务名称"},{default:l(()=>[t(u,{modelValue:a.value.data.jobId,"onUpdate:modelValue":n[1]||(n[1]=b=>a.value.data.jobId=b)},{default:l(()=>[t(r,{label:"任务1",value:"job1"}),t(r,{label:"任务2",value:"job2"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"错误处理"},{default:l(()=>[t(u,{modelValue:a.value.data.error,"onUpdate:modelValue":n[2]||(n[2]=b=>a.value.data.error=b)},{default:l(()=>[t(r,{label:"停止",value:"stop"}),t(r,{label:"继续",value:"continue"})]),_:1},8,["modelValue"])]),_:1})]),_:1})])])])}}},ut=N(rt,[["__scopeId","data-v-0f910af3"]]),O=o=>(E("data-v-d6b477eb"),o=o(),M(),o),_t={class:"custom-node"},pt={class:"custom-node-inner"},mt={class:"top-box"},ft={class:"title"},gt={class:"desc"},vt={class:"nodrag controller-menu"},ht={class:"css-0"},bt={class:"nodrag trigger mt-8"},$t={class:"trigger-handle"},yt=O(()=>e("div",{class:"trigger-name"},"触发器",-1)),xt={class:"trigger-handle-right"},wt=O(()=>e("div",{class:"trigger-name"},"执行任务结束",-1)),Ct={class:"nowheel"},St=O(()=>e("div",{class:"middle-info"},"配置",-1)),kt={class:"edit-box nodrag"},Nt=O(()=>e("div",{style:{"line-height":"30px"}},"并行任务",-1)),It={class:"job-item-title"},jt=["onClick"],Vt={class:"job-item-input"},Dt={__name:"MultipleNode",props:{node:{type:Object,required:!0}},emits:["update:node"],setup(o,{emit:p}){const _=p,m=o,{deleteNode:d}=T(),a=L({get:()=>m.node,set:c=>_("update:node",c)});function v(){a.value.data.parallel.push(W())}function n(c){a.value.data.parallel.length!==1&&a.value.data.parallel.splice(c,1)}return(c,r)=>{const u=f("b-icon"),i=f("b-input-number"),S=f("b-form-item"),b=f("b-col"),w=f("b-switch"),z=f("b-row"),I=f("b-input"),P=f("b-button"),Q=f("b-form");return h(),$("div",_t,[e("div",pt,[e("div",mt,[t(u,{class:"chakra-image",name:s(g).Multiple.icon,color:s(g).Multiple.iconColor},null,8,["name","color"]),e("div",ft,x(s(g).Multiple.title),1)]),e("div",gt,x(s(g).Multiple.desc),1),e("div",vt,[e("div",ht,[e("button",{type:"button",class:"chakra-button delete",onClick:r[0]||(r[0]=k=>s(d)(o.node))},[t(u,{name:"delete"}),y(" 删除 ")])])]),e("div",bt,[e("div",$t,[t(s(D),{id:"_MultipleA_target_",type:"target",position:s(V).Left,style:C({width:"14px",height:"14px",borderWidth:"3.5px",backgroundColor:"#fff",borderColor:"rgb(54, 173, 239)"})},null,8,["position","style"])]),yt,e("div",xt,[t(s(D),{id:"_MultipleA_source_",type:"source",position:s(V).Right,style:C({width:"14px",height:"14px",borderWidth:"3.5px",backgroundColor:"#fff",borderColor:"rgb(165, 88, 201)"})},null,8,["position","style"])]),wt])]),e("div",Ct,[St,e("div",kt,[t(Q,null,{default:l(()=>[t(z,{gutter:"16"},{default:l(()=>[t(b,{span:"12"},{default:l(()=>[t(S,{label:"并行数量"},{default:l(()=>[t(i,{modelValue:a.value.data.errorPairing,"onUpdate:modelValue":r[1]||(r[1]=k=>a.value.data.errorPairing=k),step:1,precision:0},null,8,["modelValue"])]),_:1})]),_:1}),t(b,{span:"12"},{default:l(()=>[t(S,{label:"是否并行"},{default:l(()=>[t(w,{modelValue:a.value.data.poly,"onUpdate:modelValue":r[2]||(r[2]=k=>a.value.data.poly=k)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Nt,(h(!0),$(F,null,Y(a.value.data.parallel,(k,B)=>(h(),$("div",{class:"job-item",key:B},[e("div",It,[e("i",{class:A(["b-iconfont b-icon-minus-circle-fill",{disabled:a.value.data.parallel.length===1}]),title:"删除",onClick:J=>n(B)},null,10,jt),y(" 任务 "+x(B+1),1)]),e("div",Vt,[t(I,{modelValue:k.jobName,"onUpdate:modelValue":J=>k.jobName=J},null,8,["modelValue","onUpdate:modelValue"])])]))),128)),t(S,{style:{"margin-top":"16px"}},{default:l(()=>[t(P,{type:"primary",icon:"plus-circle",style:{"border-radius":"8px",width:"150px"},onClick:v},{default:l(()=>[y(" 添加一个任务 ")]),_:1})]),_:1})]),_:1})])])])}}},Et=N(Dt,[["__scopeId","data-v-d6b477eb"]]),Mt=o=>(E("data-v-5c0e77c5"),o=o(),M(),o),qt={class:"custom-node"},Lt={class:"custom-node-inner"},Tt={class:"top-box"},Ot={class:"title"},zt={class:"desc"},Bt={class:"nodrag controller-menu"},At={class:"css-0"},Wt={class:"nodrag trigger"},Ft={class:"trigger-handle"},Rt=Mt(()=>e("div",{class:"trigger-name"},"触发器",-1)),Ut={__name:"EndNode",props:{node:{type:Object,required:!0}},setup(o){const{deleteNode:p}=T();return(_,m)=>{const d=f("b-icon");return h(),$("div",qt,[e("div",Lt,[e("div",Tt,[t(d,{class:"chakra-image",name:s(g).End.icon,color:s(g).End.iconColor},null,8,["name","color"]),e("div",Ot,x(s(g).End.title),1)]),e("div",zt,x(s(g).End.desc),1),e("div",Bt,[e("div",At,[e("button",{type:"button",class:"chakra-button delete",onClick:m[0]||(m[0]=a=>s(p)(o.node))},[t(d,{name:"delete"}),y(" 删除 ")])])]),e("div",Wt,[e("div",Ft,[t(s(D),{id:"_EndA_target_",type:"target",position:s(V).Left,style:C({width:"14px",height:"14px",borderWidth:"3.5px",backgroundColor:"#fff",borderColor:"rgb(156, 162, 168)"})},null,8,["position","style"])]),Rt])])])}}},Jt=N(Ut,[["__scopeId","data-v-5c0e77c5"]]),Xt={class:"flow-editor-wrap"},Yt={__name:"FlowEditor",setup(o){const{toObject:p}=q(),_=j([]),m=j([]),{onDragOver:d,onDrop:a}=H(),{onConnect:v}=K();function n(){const{nodes:c,edges:r}=p();console.log("--------------------------------------state--------------------------------------"),console.log("----> nodes: ",c),console.log("----> edges: ",r),console.log("---------------------------------------------------------------------------------")}return(c,r)=>{const u=f("b-icon");return h(),$("div",Xt,[t(s(ce),{class:"custom-flow",nodes:_.value,edges:m.value,"min-zoom":.3,"max-zoom":1.5,"default-viewport":{zoom:1},onDrop:s(a),onDragover:s(d),onConnect:s(v)},{"edge-button":l(i=>[t(qe,{id:i.id,"source-x":i.sourceX,"source-y":i.sourceY,"target-x":i.targetX,"target-y":i.targetY,"source-position":i.sourcePosition,"target-position":i.targetPosition,"marker-end":i.markerEnd,style:C(i.style)},null,8,["id","source-x","source-y","target-x","target-y","source-position","target-position","marker-end","style"])]),"node-start":l(i=>[t(He,{node:i},null,8,["node"])]),"node-simple":l(i=>[t(ut,{node:i},null,8,["node"])]),"node-multiple":l(i=>[t(Et,{node:i},null,8,["node"])]),"node-end":l(i=>[t(Jt,{node:i},null,8,["node"])]),default:l(()=>[t(s(ae),{size:1,gap:20,"pattern-color":"#91919a"}),t(s(ie)),t(s(le),{position:"top-right"},{default:l(()=>[t(s(de),{title:"Log `toObject`",onClick:n},{default:l(()=>[t(u,{name:"bug"})]),_:1})]),_:1})]),_:1},8,["nodes","edges","onDrop","onDragover","onConnect"]),t(Ie)])}}},Ht=N(Yt,[["__scopeId","data-v-0e4a9f10"]]),Kt={class:"flow-editor-container"},Pt={class:"flow-editor-panel"},Qt={class:"flow-editor-header",flex:"main:justify"},Gt={class:"left",flex:"cross:center"},Zt=e("h4",{class:"header-title"},"作业流程配置",-1),eo={class:"flow-editor-content"},to={class:"flow-editor-flow"},oo={class:"p8"},so={class:"f-s-18",flex:"cross:center"},no=e("span",{class:"ml-8"},"操作确认",-1),ao=e("div",{style:{padding:"8px 0 8px 32px"}},"您即将退出高级编排页面，请确认",-1),io={class:"t-right"},X="example-flow",po=Object.assign({name:"FlowEditor"},{__name:"index",setup(o){const p=re(),_=j(!1),{toObject:m,fromObject:d}=q();function a(c=!1){p.push("/VueFlowCustom")}function v(){const c=m();console.log("----> save Data: ",c),localStorage.setItem(X,JSON.stringify(c))}function n(){const c=JSON.parse(localStorage.getItem(X));console.log("----> restore Data: ",c),c&&d(c)}return(c,r)=>{const u=f("b-button"),i=f("b-space"),S=f("b-icon"),b=f("b-modal");return h(),$("div",Kt,[e("div",Pt,[e("div",Qt,[e("div",Gt,[e("i",{class:"b-iconfont b-icon-left",onClick:r[0]||(r[0]=w=>_.value=!0)}),Zt]),t(i,{size:20,style:{"margin-right":"8px"}},{default:l(()=>[t(u,{style:{padding:"0 8px","--bin-border-radius-default":"6px"},icon:"message",onClick:v},{default:l(()=>[y(" Save ")]),_:1}),t(u,{style:{padding:"0 8px","--bin-border-radius-default":"6px"},icon:"message",onClick:n},{default:l(()=>[y(" Restore ")]),_:1}),t(u,{style:{padding:"0 8px","--bin-border-radius-default":"6px"},type:"primary",icon:"save"},{default:l(()=>[y(" 保存 ")]),_:1})]),_:1})]),e("div",eo,[e("div",to,[t(Ht)])])]),t(b,{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=w=>_.value=w),width:"420px"},{default:l(()=>[e("div",oo,[e("div",so,[t(S,{name:"info-circle",size:"24",color:"#fa8c16"}),no]),ao,e("div",io,[t(u,{onClick:a},{default:l(()=>[y("不保存")]),_:1}),t(u,{type:"primary",onClick:r[1]||(r[1]=w=>a(!0))},{default:l(()=>[y("保存并退出")]),_:1})])])]),_:1},8,["modelValue"])])}}});export{po as default};
