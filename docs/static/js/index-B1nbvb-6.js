import{a8 as q,ag as E,R as S,o as k,a as M,b as u,K as v,w as g,t as O,L as l,j as N,i as V,f as D,g as R,v as T,r as A,n as K}from"./vendor-COsJffew.js";import{b as P,s as C,c as $,g as F,d as G}from"./cross-tab-msg-CTU40FVn.js";import{u as H,d as J,e as o,i as Q}from"./useData-TSQMxnf1.js";import{n as I}from"./chunk-bin-ui-design-55yTQV6H.js";import{I as U,d as _}from"./index-DlSIhdb0.js";import"./chunk-brace-DF1jSkZr.js";const W={class:"sheet-wrapper"},X={class:"sheet-header"},Y={class:"left"},Z={class:"right"},ee={class:"mask"},te={__name:"SheetEdit",props:{cfg:{type:Object,default:()=>({})}},setup(b){const i=window.luckysheet,f=b,{title:y,btnLoading:a,isMaskShow:n,closePage:r,downloadExcel:d}=H(f),p=E();async function w(){try{a.value=!0;const s=_(o.value.mapping),t={};s.forEach(m=>{const{cellIndex:h,fieldName:j}=m,{row:B,column:z}=h,L=i.getCellValue(B,z);t[j]=L});const c=i.getAllSheets(),e={id:p.query.id??"",tempId:o.value.id,tempName:o.value.name,data:t,sheets:c};e.id===""?(await P(e),I.success("新增成功!"),C("add-sheet-data",{...e}),x()):(await $(e),I.success("修改成功!"),C("modify-sheet-data",{...e}))}catch(s){console.log(s)}a.value=!1}function x(){try{a.value=!0,_(o.value.mapping).forEach(t=>{const{cellIndex:c}=t,{row:e,column:m}=c;i.setCellValue(e,m,"")})}catch(s){console.log(s)}a.value=!1}return(s,t)=>{const c=S("b-space"),e=S("b-button");return k(),M("div",W,[u("div",X,[u("div",Y,[v(c,null,{default:g(()=>[u("h3",null,O(l(y)),1)]),_:1})]),u("div",Z,[l(U)?(k(),N(e,{key:0,type:"text",icon:"bug","text-color":"danger",title:"打印调试",onClick:l(J)},null,8,["onClick"])):V("",!0),v(e,{type:"primary",size:"small",icon:"download",plain:"",onClick:l(d)},{default:g(()=>t[0]||(t[0]=[D(" 下载模板 ")])),_:1},8,["onClick"]),v(e,{type:"primary",size:"small",icon:"save",loading:l(a),onClick:w},{default:g(()=>t[1]||(t[1]=[D(" 保存 ")])),_:1},8,["loading"]),v(e,{type:"danger",size:"small",icon:"close",onClick:l(r)},{default:g(()=>t[2]||(t[2]=[D("关闭")])),_:1},8,["onClick"])])]),t[3]||(t[3]=u("div",{id:"SheetContainer",class:"sheet-excel has-config"},null,-1)),R(u("div",ee,"loading",512),[[T,l(n)]])])}}},ae=q(te,[["__scopeId","data-v-00c54bf1"]]),re=Object.assign({name:"DataEdit"},{__name:"index",setup(b){const i=E(),f=A(!1);function y(a){var d;if(a.sheets){o.value.jsonData.sheets=_(a.sheets);return}const n=_(o.value.mapping),r=(d=o.value.jsonData)==null?void 0:d.sheets[0];if(r){const p=r.celldata||[];n.forEach(w=>{const{cellIndex:x,fieldName:s}=w,{column:t,row:c}=x,e=p.findIndex(h=>h.c===t&&h.r===c),m=a.data[s];e>-1&&(p[e].v.v=p[e].v.m=m)})}}return K(()=>i.path,async()=>{const{tempId:a,id:n}=i.query;if(document.title="数据填报",a){Q();const r=await F(a);if(o.value={...r},n){const d=await G(n);y(d)}}f.value=!0},{immediate:!0}),(a,n)=>f.value?(k(),N(ae,{key:0})):V("",!0)}});export{re as default};
