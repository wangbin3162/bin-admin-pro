import{n as V,c as M}from"./chunk-bin-ui-design-55yTQV6H.js";import{s as B,n as H,d as G,k as J}from"./index-DlSIhdb0.js";import{r as h,l as Q,m as W,p as X,q as Y,R as c,o as _,j as C,w as o,b as w,H as Z,K as r,a as A,t as O,f as E,i as D,e as ee,h as K,a8 as te,G as z}from"./vendor-COsJffew.js";import"./chunk-brace-DF1jSkZr.js";const F=h(new Map);function ne(){F.value.clear()}function q(){const e=[...F.value.values()];return new Promise(u=>{const s=[];e.forEach(t=>{t&&t.validate&&s.push(t.validate())}),console.log("------- valid EditTree allNode Form -------"),console.log(e,s),console.log("-------------------------------------------"),Promise.all(s).then(async t=>{u(t.every(m=>m))})})}const ae={style:{width:"calc(100% - 75px - 600px)"}},oe={class:"title"},le={key:1,class:"label"},re={class:"input",style:{width:"600px",padding:"0 4px"}},de={style:{width:"340px"}},se={key:1,class:"label"},ie={style:{width:"240px"}},pe={href:"javascript:void(0)",class:"f-s-12 pl-8 pr-8",style:{"line-height":"32px"}},ce={key:1,class:"label"},ue={key:0,class:"ctrl",style:{width:"75px","line-height":"32px",padding:"0 4px"},flex:"main:right"},L=Object.assign({name:"RenderNode"},{__name:"RenderNode",props:{root:{type:Array,default:()=>[]},node:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!0}},emits:["append","append-level","import","remove"],setup(e,{emit:u}){const s=u,t=e,m=Q(()=>t.node.parents?t.node.parents.length:0),x=W({name:[{required:!0,message:"必填项",trigger:"blur"},{validator:async(k,l,d)=>{/^[A-z_;]+\w*$/.test(l)?d():d(new Error("名称只能以_或字母开头"))},trigger:"blur"},{validator:async(k,l,d)=>{const i=t.node.parent;i===void 0?t.root.filter(b=>b.parent===void 0).map(b=>b.node).findIndex(b=>b.parent!==t.data.parent&&b.name===t.data.name)>-1&&d(new Error("同层级存在同名参数！")):t.root[i].node.children.findIndex(b=>b.parent!==t.data.parent&&b.name===t.data.name)>-1&&d(new Error("同层级存在同名参数！")),d()},trigger:"blur"}]}),g=h(null);function R(k){t.data.paramType=k}return X(()=>{t.isEdit&&F.value.set(t.data.parent,g.value)}),Y(()=>{t.isEdit&&F.value.delete(t.data.parent)}),(k,l)=>{const d=c("b-input"),i=c("b-form-item"),p=c("b-dropdown-item"),b=c("b-dropdown-menu"),T=c("b-dropdown"),a=c("b-space"),n=c("b-icon"),v=c("b-form");return _(),C(v,{model:e.data,rules:x,ref_key:"formRef",ref:g},{default:o(()=>[w("div",{class:Z(["custom-render-node",[`node-level-${m.value}`,`node_${e.data.parent}`]])},[w("div",ae,[w("div",oe,[e.isEdit?(_(),C(i,{key:0,prop:"name"},{default:o(()=>[r(d,{modelValue:e.data.name,"onUpdate:modelValue":l[0]||(l[0]=f=>e.data.name=f),placeholder:"参数名称"},null,8,["modelValue"])]),_:1})):(_(),A("label",le,O(e.data.name),1))])]),w("div",re,[r(a,null,{default:o(()=>[w("div",de,[e.isEdit?(_(),C(d,{key:0,modelValue:e.data.des,"onUpdate:modelValue":l[1]||(l[1]=f=>e.data.des=f),placeholder:"参数说明"},null,8,["modelValue"])):(_(),A("label",se,O(e.data.des||"--"),1))]),w("div",ie,[e.isEdit?(_(),C(T,{key:0,onCommand:R,placement:"right-start"},{dropdown:o(()=>[r(b,null,{default:o(()=>{var f,I;return[r(p,{name:"Object"},{default:o(()=>l[5]||(l[5]=[E("Object")])),_:1}),r(p,{name:"Array"},{default:o(()=>l[6]||(l[6]=[E("Array")])),_:1}),r(p,{name:"String",disabled:((f=e.data.children)==null?void 0:f.length)>0,title:((I=e.data.children)==null?void 0:I.length)>0?"已有子节点，不可设置为String类型":""},{default:o(()=>l[7]||(l[7]=[E(" String ")])),_:1},8,["disabled","title"])]}),_:1})]),default:o(()=>[w("a",pe,O(e.data.paramType),1)]),_:1})):(_(),A("label",ce,O(e.data.paramType),1))])]),_:1})]),e.isEdit?(_(),A("div",ue,[e.data.paramType==="Array"?(_(),C(n,{key:0,name:"Storedprocedure",type:"button",color:"var(--bin-color-warning)",title:"批量导入",onClick:l[2]||(l[2]=f=>s("import"))})):D("",!0),r(T,{onCommand:l[3]||(l[3]=f=>s(f))},{dropdown:o(()=>[r(b,null,{default:o(()=>[r(p,{name:"append-level"},{default:o(()=>l[8]||(l[8]=[E("增加同级节点")])),_:1}),e.data.paramType!=="String"?(_(),C(p,{key:0,name:"append"},{default:o(()=>l[9]||(l[9]=[E(" 增加子节点 ")])),_:1})):D("",!0)]),_:1})]),default:o(()=>[r(n,{name:"plus-circle",type:"button",color:"var(--bin-color-success)"})]),_:1}),r(n,{name:"minus-circle",type:"button",color:"var(--bin-color-danger)",title:"移除当前节点",onClick:l[4]||(l[4]=f=>s("remove"))})])):D("",!0)],2)]),_:1},8,["model","rules"])}}}),me={class:"edit-tree-container"},fe={class:"edit-tree-header"},ve={class:"edit-tree-content"},ye=Object.assign({name:"EditTree"},{__name:"index",props:{data:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!0}},emits:["appendRootNode","import","appendNode","appendLevelNode","removeNode"],setup(e,{expose:u,emit:s}){const t=s,m=e,y=h(null);function N({root:d,node:i,data:p}){return K(L,{root:d,node:i,data:p,onAppend:()=>{t("appendNode",p)},onAppendLevel:()=>{t("appendLevelNode",d,i,p)},onRemove:()=>{t("removeNode",d,i,p)},onImport:()=>{t("import",p)}})}function x({root:d,node:i,data:p}){return K(L,{root:d,node:i,data:p,isEdit:m.isEdit})}let g=!0;function R(d,i,p){return!(!y.value||!g||(y.value.getFlatState()[i.nodeKey].parents||[]).indexOf(d.nodeKey)>-1||p==="inner"&&i.paramType==="String")}function k(){return y.value.getFlatState()}async function l(d,i){g=await q()}return u({getFlatState:k}),(d,i)=>{const p=c("b-tag"),b=c("b-button"),T=c("b-tree");return _(),A("div",me,[w("div",fe,[ee(d.$slots,"header",{},()=>[r(p,{type:"primary"},{default:o(()=>i[1]||(i[1]=[E("返回响应")])),_:1}),e.isEdit?(_(),C(b,{key:0,type:"success",size:"mini",plain:"",icon:"plus",onClick:i[0]||(i[0]=a=>t("appendRootNode"))},{default:o(()=>i[2]||(i[2]=[w("span",{class:"f-s-12"},"增加根节点",-1)])),_:1})):D("",!0)])]),w("div",ve,[e.isEdit?(_(),C(T,{key:0,data:e.data,render:N,"allow-drop":R,style:{"min-width":"1000px"},ref_key:"treeRef",ref:y,draggable:"","default-expand":"","lock-select":"",onNodeDragStart:l},null,8,["data"])):(_(),C(T,{key:1,data:e.data,render:x,style:{"min-width":"1000px"},ref_key:"treeRef",ref:y,"default-expand":"","lock-select":""},null,8,["data"]))])])}}});function U(e){const u=document.querySelector(".edit-tree-container .edit-tree-content");if(u)if(e){const s=document.querySelector(`.edit-tree-container .node_${e.parent}`);s&&B(u,u.scrollTop,s.offsetTop)}else B(u,u.scrollTop,u.scrollHeight)}function ge(e=[]){if(!Array.isArray(e)||e.length===0)return[];let u=[],s={};return e.forEach((t,m)=>{s[t.parent]=m}),e.forEach(t=>{t.children=[];const m=t.belongParent;if(m){let y=e[s[m]].children;Array.isArray(y)?y.push(t):y=[t]}else u.push(t)}),u}function be(e=[]){const u=[];for(let s=0;s<e.length;s++){const t=e[s],m=t.node,y=t.parent>-1?e[t.parent].node.parent:"",N=t.parents??[],x=[];N.forEach(g=>x.push(e[g].node.name)),u.push({belongParent:y,parent:m.parent,name:m.name,des:m.des,paramType:t.node.paramType,parentName:x.join(","),level:N.length+1,sort:s})}return u}const _e={class:"paster-wrap"},he={class:"example-wrap"},we={class:"code"},Ne={key:0,class:"tip"},xe={name:"JsonPaster"},ke=Object.assign(xe,{props:{title:{type:String,default:"Json转换"},normalText:{type:String,default:"请复制Json中的数据内容，粘贴至下方区域"},tip:{type:String}},emits:["ok"],setup(e,{expose:u,emit:s}){const t=s,m=h(!1),y=h(""),N=h([]),x=h(!1),g=h(`[
    "fgroup_fname",
    "fbr",
    "fitemid",
    "fname",
    "fnumber",
    "fcompany",
    "fclassid",
    "ffullname",
    "ffullnumber"
]`),R=h(0),k=h({});function l(a,n){R.value=a,k.value=n,d(),m.value=!0}function d(){y.value="",N.value=[]}function i(a){H(a)||(N.value=G(a),y.value=JSON.stringify(a,null,2))}function p(){x.value=!0,N.value.length?t("ok",N.value,R.value,k.value):V.error("请复制粘贴正确内容后提交数据！"),x.value=!1}function b(a){try{N.value=JSON.parse(a)}catch{}}function T(){m.value=!1}return u({open:l,setformatData:i,handleClose:T,initData:d}),(a,n)=>{const v=c("b-alert"),f=c("b-ace-editor"),I=c("highlightjs"),j=c("b-card"),S=c("b-button"),$=c("b-modal");return _(),A("div",null,[r($,{modelValue:m.value,"onUpdate:modelValue":n[1]||(n[1]=P=>m.value=P),title:e.title,width:"600","mask-closable":!1},{footer:o(()=>[r(S,{onClick:T},{default:o(()=>n[3]||(n[3]=[E("取 消")])),_:1}),r(S,{type:"primary",onClick:p,loading:x.value},{default:o(()=>n[4]||(n[4]=[E("确 定")])),_:1},8,["loading"])]),default:o(()=>[r(v,{"show-icon":""},{default:o(()=>[E(O(e.normalText),1)]),_:1}),w("div",_e,[r(f,{modelValue:y.value,"onUpdate:modelValue":n[0]||(n[0]=P=>y.value=P),onChange:b},null,8,["modelValue"]),r(j,{class:"box-card",width:"480px","head-tip":"",shadow:"never"},{header:o(()=>n[2]||(n[2]=[w("div",{flex:"main:justify cross:center"},[w("span",null,"示例")],-1)])),default:o(()=>[w("div",he,[w("div",we,[r(I,{language:"json",code:g.value},null,8,["code"])])])]),_:1})]),e.tip?(_(),A("p",Ne,O(e.tip),1)):D("",!0)]),_:1},8,["modelValue","title"])])}}}),Ie=te(ke,[["__scopeId","data-v-76a5f8f5"]]),Te={class:"p16"},je=Object.assign({name:"EditTree"},{__name:"edit-tree",setup(e){ne();const u=h(null),s=h(null),t=h(null),m=h(null);function y(){var v;const a=s.value.getFlatState(),n=be(a);(v=m.value)==null||v.show(n)}async function N(){await q()?V.success("校验成功！"):V.error("校验失败，请检查错误！")}const x=h([{belongParent:"",parent:"id-00",des:"根节点",name:"data",paramType:"Object",parentName:"",paramId:"paramId-00",interfaceId:"interfaceId-00",level:"1",sort:"0"},{belongParent:"id-00",parent:"id-00-00",des:"类别",name:"category",paramType:"Object",parentName:"data",paramId:"paramId-01",interfaceId:"interfaceId-00",level:"2",sort:"1"},{belongParent:"id-00-00",parent:"id-00-00-00",des:"说明",name:"text",paramType:"String",parentName:"data.category",paramId:"paramId-02",interfaceId:"interfaceId-00",level:"3",sort:"2"},{belongParent:"id-00",parent:"id-00-01",des:"名称",name:"name",paramType:"String",parentName:"data",paramId:"paramId-03",interfaceId:"interfaceId-00",level:"2",sort:"3"},{belongParent:"id-00",parent:"id-00-02",des:"id",name:"id",paramType:"String",parentName:"data",paramId:"paramId-04",interfaceId:"interfaceId-00",level:"2",sort:"4"},{belongParent:"",parent:"id-01",des:"根节点2",name:"data2",paramType:"Object",parentName:"",paramId:"paramId-05",interfaceId:"interfaceId-00",level:"1",sort:"5"}]),g=h([]);g.value=ge(x.value);function R(){const a={parent:J(),name:"",des:"",paramType:"String"};g.value.push(a),z(()=>U(null))}function k(a,n=""){const v=a.children||[];a.expand=!0;const f={parent:J(),name:n,des:"",paramType:"String"};v.push(f),a.children=v,g.value=[...g.value],z(()=>U(f))}function l(a,n){var f;const v=a.find(I=>I===n).parent;if(v>-1){const I=(f=a.find(j=>j.nodeKey===v))==null?void 0:f.node;k(I)}else R()}async function d(a){return new Promise(n=>{a==="String"?n(!0):M.confirm({type:"warning",title:"提示",message:'<p>确定要<span style="color:red;">移除</span>当前节点吗？子节点会一并移除！</p>',useHTML:!0}).then(()=>n(!0)).catch(()=>n(!1))})}async function i(a,n,v){var I;if(await d(v.paramType)){const j=a.find(S=>S===n).parent;if(j>-1){const S=(I=a.find(P=>P.nodeKey===j))==null?void 0:I.node,$=S.children.indexOf(v);S.children.splice($,1)}else{const S=g.value.indexOf(v);g.value.splice(S,1)}V({type:"success",message:"移除成功!"})}}let p=null;function b(a){p=a,t.value.open()}function T(a){var n;a.forEach(v=>{k(p,v)}),V.success("导入成功"),(n=t.value)==null||n.handleClose()}return(a,n)=>{const v=c("b-button"),f=c("debug-modal"),I=c("b-space"),j=c("b-form"),S=c("b-collapse-wrap"),$=c("page-wrapper");return _(),C($,{desc:"编辑树表，实际开发时可能会根据实际情况进行组件定义和使用。"},{default:o(()=>[r(S,{title:"编辑树表",shadow:"none"},{right:o(()=>[r(I,{size:16},{default:o(()=>[r(f,{ref_key:"transDataRef",ref:m},{default:o(()=>[r(v,{type:"primary",size:"mini",plain:"",onClick:y},{default:o(()=>n[0]||(n[0]=[E(" 转换数据结构 ")])),_:1})]),_:1},512),r(v,{type:"warning",size:"mini",plain:"",onClick:N},{default:o(()=>n[1]||(n[1]=[E("校验错误")])),_:1}),r(f,{data:{treeData:g.value,testData:x.value}},null,8,["data"])]),_:1})]),default:o(()=>[w("div",Te,[r(j,{model:g.value,ref_key:"formRef",ref:u},{default:o(()=>[r(ye,{data:g.value,ref_key:"editTreeRef",ref:s,onImport:b,onAppendRootNode:R,onAppendNode:k,onAppendLevelNode:l,onRemoveNode:i},null,8,["data"])]),_:1},8,["model"])])]),_:1}),r(Ie,{ref_key:"jsonPasterRef",ref:t,title:"响应参数批量添加",tip:"",onOk:T},null,512)]),_:1})}}});export{je as default};
