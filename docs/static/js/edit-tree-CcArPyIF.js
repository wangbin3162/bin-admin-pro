import{n as $,c as E}from"./chunk-bin-ui-design-CMJ2EfEK.js";import{r as P}from"./index-C63pl2jy.js";import{r as I,l as F,m as B,p as K,q as M,Q as d,o as j,j as k,w as a,b as v,H as U,K as t,f as T,t as z,a as C,e as q,h as H}from"./vendor-B29aizbt.js";import"./chunk-brace-BklEY0pF.js";import"./chunk-mockjs-CGXE1Baq.js";const O=I(new Map);function J(){O.value.clear()}function L(){const m=[...O.value.values()].map(b=>b.value.validate());return new Promise(b=>{Promise.all(m).then(async g=>{b(g.every(o=>o))})})}const Q={style:{width:"calc(100% - 75px - 500px)"}},G={class:"title"},W={class:"input",style:{width:"500px",padding:"0 4px"}},X={style:{width:"300px"}},Y={style:{width:"180px"}},Z={href:"javascript:void(0)",class:"f-s-12 pl-8 pr-8",style:{"line-height":"32px"}},ee={class:"ctrl",style:{width:"75px","line-height":"32px",padding:"0 4px"},flex:"main:right"},te={key:1},ne=Object.assign({name:"RenderNode"},{__name:"RenderNode",props:{root:{type:Array,default:()=>[]},node:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})}},emits:["append","import","remove"],setup(m,{emit:b}){const g=b,o=m,N=F(()=>o.node.parents?o.node.parents.length:0),c=B({name:[{required:!0,message:"必填项",trigger:"blur"},{validator:async(u,n,f)=>{/^[A-z_;]+\w*$/.test(n)?f():f(new Error("名称只能以_或字母开头"))},trigger:"blur"},{validator:async(u,n,f)=>{const h=o.node.parent;h===void 0?o.root.filter(e=>e.parent===void 0).map(e=>e.node).findIndex(e=>e.parent!==o.data.parent&&e.name===o.data.name)>-1&&f(new Error("同层级存在同名参数！")):o.root[h].node.children.findIndex(e=>e.parent!==o.data.parent&&e.name===o.data.name)>-1&&f(new Error("同层级存在同名参数！")),f()},trigger:"blur"}]}),_=I(null);return K(()=>{O.value.set(o.data.parent,_)}),M(()=>{O.value.delete(o.data.parent)}),(u,n)=>{const f=d("b-input"),h=d("b-form-item"),w=d("b-dropdown-item"),e=d("b-dropdown-menu"),l=d("b-dropdown"),s=d("b-space"),r=d("b-icon"),p=d("b-form");return j(),k(p,{model:m.data,rules:c,ref_key:"formRef",ref:_},{default:a(()=>[v("div",{class:U(["custom-render-node",`node-level-${N.value}`])},[v("div",Q,[v("div",G,[t(h,{prop:"name"},{default:a(()=>[t(f,{modelValue:m.data.name,"onUpdate:modelValue":n[0]||(n[0]=i=>m.data.name=i),placeholder:"参数名称"},null,8,["modelValue"])]),_:1})])]),v("div",W,[t(s,null,{default:a(()=>[v("div",X,[t(f,{modelValue:m.data.des,"onUpdate:modelValue":n[1]||(n[1]=i=>m.data.des=i),placeholder:"参数说明"},null,8,["modelValue"])]),v("div",Y,[t(l,{onCommand:n[2]||(n[2]=i=>m.data.paramType=i),placement:"right"},{dropdown:a(()=>[t(e,null,{default:a(()=>[t(w,{name:"Object"},{default:a(()=>[T("Object")]),_:1}),t(w,{name:"Array"},{default:a(()=>[T("Array")]),_:1}),t(w,{name:"String"},{default:a(()=>[T("String")]),_:1})]),_:1})]),default:a(()=>[v("a",Z,z(m.data.paramType),1)]),_:1})])]),_:1})]),v("div",ee,[m.data.paramType!=="String"?(j(),k(r,{key:0,name:"plus-circle",type:"button",color:"var(--bin-color-success)",title:"增加子节点",onClick:n[3]||(n[3]=i=>g("append"))})):(j(),C("i",te)),t(r,{name:"minus-circle",type:"button",color:"var(--bin-color-danger)",title:"移除当前节点",onClick:n[4]||(n[4]=i=>g("remove"))})])],2)]),_:1},8,["model","rules"])}}}),ae={class:"edit-tree-container"},oe={class:"edit-tree-header"},re=v("span",{class:"f-s-12"},"增加根节点",-1),de={class:"edit-tree-content"},le=Object.assign({name:"EditTree"},{__name:"index",props:{data:{type:Array,default:()=>[]},headerTitle:{type:String,default:"标题"}},emits:["appendRootNode","jsonImport","appendNode","removeNode"],setup(m,{expose:b,emit:g}){const o=g,N=I(null);function A({root:_,node:u,data:n}){return H(ne,{root:_,node:u,data:n,onAppend:()=>{o("appendNode",n)},onRemove:()=>{o("removeNode",_,u,n)},onImport:()=>{o("jsonImport",_,u,n)}})}function S(_,u,n){return!(!N.value||(N.value.getFlatState()[u.nodeKey].parents||[]).indexOf(_.nodeKey)>-1||n==="inner"&&u.paramType==="String")}function c(){return N.value.getFlatState()}return b({getFlatState:c}),(_,u)=>{const n=d("b-tag"),f=d("b-button"),h=d("b-tree");return j(),C("div",ae,[v("div",oe,[q(_.$slots,"header",{},()=>[t(n,{type:"primary"},{default:a(()=>[T("返回响应")]),_:1}),t(f,{type:"success",size:"mini",plain:"",icon:"plus",onClick:u[0]||(u[0]=w=>o("appendRootNode"))},{default:a(()=>[re]),_:1})])]),v("div",de,[t(h,{data:m.data,render:A,"allow-drop":S,style:{"min-width":"800px"},ref_key:"treeRef",ref:N,draggable:"","default-expand":"","lock-select":""},null,8,["data"])])])}}}),se={class:"p16"},fe=Object.assign({name:"EditTree"},{__name:"edit-tree",setup(m){J();const b=I(null),g=I(null),o=I(null);function N(){var s;const e=g.value.getFlatState(),l=u(e);(s=o.value)==null||s.show(l)}async function A(){await L()||$.error("校验失败，请检查错误！")}const S=I([{belongParent:"",parent:"id-00",des:"根节点",name:"data",paramType:"Object",parentName:"",paramId:"paramId-00",interfaceId:"interfaceId-00",level:"1",sort:"0"},{belongParent:"id-00",parent:"id-00-00",des:"类别",name:"category",paramType:"Object",parentName:"data",paramId:"paramId-01",interfaceId:"interfaceId-00",level:"2",sort:"1"},{belongParent:"id-00-00",parent:"id-00-00-00",des:"说明",name:"text",paramType:"String",parentName:"data.category",paramId:"paramId-02",interfaceId:"interfaceId-00",level:"3",sort:"2"},{belongParent:"id-00",parent:"id-00-01",des:"名称",name:"name",paramType:"String",parentName:"data",paramId:"paramId-03",interfaceId:"interfaceId-00",level:"2",sort:"3"},{belongParent:"id-00",parent:"id-00-02",des:"id",name:"id",paramType:"String",parentName:"data",paramId:"paramId-04",interfaceId:"interfaceId-00",level:"2",sort:"4"},{belongParent:"",parent:"id-01",des:"根节点2",name:"data2",paramType:"Object",parentName:"",paramId:"paramId-05",interfaceId:"interfaceId-00",level:"1",sort:"5"}]),c=I([]);function _(e=[]){if(!Array.isArray(e)||e.length===0)return[];let l=[],s={};return e.forEach((r,p)=>{s[r.parent]=p}),e.forEach(r=>{r.children=[];const p=r.belongParent;if(p){let i=e[s[p]].children;Array.isArray(i)?i.push(r):i=[r]}else l.push(r)}),l}function u(e=[]){const l=[];for(let s=0;s<e.length;s++){const r=e[s],p=r.node,i=r.parent>-1?e[r.parent].node.parent:"",y=r.parents??[],x=[];y.forEach(R=>x.push(e[R].node.name)),l.push({belongParent:i,parent:p.parent,name:p.name,des:p.des,paramType:r.node.paramType,parentName:x.join(","),level:y.length+1,sort:s})}return l}c.value=_(S.value);function n(){c.value.push({parent:P(),name:"",des:"",paramType:"String"})}function f(e){const l=e.children||[];e.expand=!0,l.push({parent:P(),name:"",des:"",paramType:"String"}),e.children=l,c.value=[...c.value]}async function h(e){return new Promise(l=>{e==="String"?l(!0):E.confirm({type:"warning",title:"提示",message:'<p>确定要<span style="color:red;">移除</span>当前节点吗？子节点会一并移除！</p>',useHTML:!0}).then(()=>l(!0)).catch(()=>l(!1))})}async function w(e,l,s){var p;if(await h(s.paramType)){const i=e.find(y=>y===l).parent;if(i!==void 0&&i>=0){const y=(p=e.find(R=>R.nodeKey===i))==null?void 0:p.node,x=y.children.indexOf(s);y.children.splice(x,1)}else{const y=c.value.indexOf(s);c.value.splice(y,1)}$({type:"success",message:"移除成功!"})}}return(e,l)=>{const s=d("debug-modal"),r=d("b-form"),p=d("b-col"),i=d("b-ace-editor"),y=d("b-row"),x=d("b-button"),R=d("b-space"),D=d("b-collapse-wrap"),V=d("page-wrapper");return j(),k(V,{desc:"编辑树表，实际开发时可能会根据实际情况进行组件定义和使用。"},{default:a(()=>[t(r,{model:c.value,ref_key:"formRef",ref:b},{default:a(()=>[t(D,{title:"编辑树表",shadow:"none"},{right:a(()=>[t(s,{data:{treeData:c.value,testData:S.value}},null,8,["data"])]),default:a(()=>[v("div",se,[t(y,{gutter:16},{default:a(()=>[t(p,{span:17},{default:a(()=>[t(r,{model:c.value},{default:a(()=>[t(le,{data:c.value,ref_key:"editTreeRef",ref:g,onAppendRootNode:n,onAppendNode:f,onRemoveNode:w},null,8,["data"])]),_:1},8,["model"])]),_:1}),t(p,{span:7},{default:a(()=>[t(i,{readonly:"","model-value":JSON.stringify(c.value,null,2)},null,8,["model-value"])]),_:1})]),_:1}),t(R,null,{default:a(()=>[t(s,{ref_key:"transDataRef",ref:o},{default:a(()=>[t(x,{type:"primary",plain:"",onClick:N},{default:a(()=>[T("转换数据结构")]),_:1})]),_:1},512),t(x,{type:"warning",plain:"",onClick:A},{default:a(()=>[T("校验错误")]),_:1})]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1})}}});export{fe as default};
