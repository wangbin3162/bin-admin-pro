import{a8 as L,l as R,ag as j,r as p,n as q,Q as c,o as i,a as N,b as u,K as _,w as f,t as M,F as z,R as K,j as V,L as O,f as P,i as Q,g as A,v as G,ac as C}from"./vendor-5c4b4c96.js";import{n as I}from"./chunk-bin-ui-design-2f3ecd04.js";import{b as H,s as B,c as J,g as W,d as X}from"./cross-tab-msg-52280636.js";import{e as n,i as Y}from"./useData-c71aace8.js";import{i as k}from"./index-0c470c36.js";import"./chunk-brace-6f23dcf5.js";import"./chunk-mockjs-c013c588.js";const Z={class:"sheet-wrapper"},$={class:"sheet-header"},ee={class:"left"},ae={class:"right"},te={class:"sheet-excel"},oe={key:0,class:"form-box"},se={class:"mask"},ne=Object.assign({name:"DataEditSimple"},{__name:"index",setup(le){const E=R({get:()=>n.value.name,set:a=>n.value.name=a}),g=j(),S=p(!1),y=p(!1),T=p(!1),s=p({}),v=p(null);function U(){window.close()}function w(a){k(n.value.mapping).forEach(l=>{const{fieldName:o}=l;s.value[o]=a?a.data[o]:""}),a&&a.sheets&&(v.value=k(a.sheets))}async function F(){var a;try{y.value=!0;const e={id:(a=g.query.id)!=null?a:"",tempId:n.value.id,tempName:n.value.name,data:C(s.value)};if(v.value&&v.value[0]){e.sheets=C(v.value);const l=k(n.value.mapping),o=e.sheets[0].celldata||[];l.forEach(x=>{const{cellIndex:D,fieldName:h}=x,{column:m,row:r}=D,t=o.findIndex(d=>d.c===m&&d.r===r),b=s.value[h];t>-1&&(o[t].v.v=o[t].v.m=b,e.sheets[0].data[r][m].v=e.sheets[0].data[r][m].m=b)})}e.id===""?(await H(e),I.success("\u65B0\u589E\u6210\u529F!"),B("add-sheet-data",{...e}),w()):(await J(e),I.success("\u4FEE\u6539\u6210\u529F!"),B("modify-sheet-data",{...e}))}catch(e){console.log(e)}y.value=!1}return q(()=>g.path,async()=>{const{tempId:a,id:e}=g.query;if(document.title="\u6570\u636E\u586B\u62A5",a){Y();const l=await W(a);if(n.value={...l},w(),e){const o=await X(e);w(o)}}S.value=!0},{immediate:!0}),(a,e)=>{const l=c("b-space"),o=c("b-icon"),x=c("b-input-number"),D=c("b-input"),h=c("b-form-item"),m=c("b-button"),r=c("b-form");return i(),N("div",Z,[u("div",$,[u("div",ee,[_(l,null,{default:f(()=>[u("h3",null,M(E.value),1)]),_:1})]),u("div",ae,[_(o,{type:"button",name:"close",color:"#f5222d",size:"24",onClick:U})])]),u("div",te,[S.value?(i(),N("div",oe,[_(r,{"label-width":"100px",model:s.value},{default:f(()=>[(i(!0),N(z,null,K(O(n).mapping,(t,b)=>(i(),V(h,{key:b,prop:t.fieldName,label:t.fieldTitle},{default:f(()=>[t.dataType==="number"?(i(),V(x,{key:0,modelValue:s.value[t.fieldName],"onUpdate:modelValue":d=>s.value[t.fieldName]=d},null,8,["modelValue","onUpdate:modelValue"])):(i(),V(D,{key:1,modelValue:s.value[t.fieldName],"onUpdate:modelValue":d=>s.value[t.fieldName]=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["prop","label"]))),128)),_(h,null,{default:f(()=>[_(m,{type:"primary",loading:y.value,onClick:F},{default:f(()=>[P("\u4FDD \u5B58")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):Q("",!0)]),A(u("div",se,"loading",512),[[G,T.value]])])}}}),_e=L(ne,[["__scopeId","data-v-5dd02c65"]]);export{_e as default};
