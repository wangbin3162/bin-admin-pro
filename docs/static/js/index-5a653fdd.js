import{a6 as F,b as M,ae as j,e as p,w as z,f as c,g as i,j as N,l as u,c as _,x as f,u as L,F as P,P as R,v as V,a2 as O,q as A,t as G,y as H,z as J,aa as C}from"./vendor-a6c5ad11.js";import{a as I}from"./chunk-bin-ui-next-1e71edb3.js";import{b as K,s as B,c as Q,g as W,d as X}from"./cross-tab-msg-f4d40e3f.js";import{e as n,i as Y}from"./useData-8ba1bbf2.js";import{i as k}from"./index-fda68aa4.js";import"./chunk-brace-6f23dcf5.js";import"./chunk-mockjs-c013c588.js";const Z={class:"sheet-wrapper"},$={class:"sheet-header"},ee={class:"left"},ae={class:"right"},te={class:"sheet-excel"},se={key:0,class:"form-box"},oe={class:"mask"},ne=Object.assign({name:"DataEditSimple"},{__name:"index",setup(le){const E=M({get:()=>n.value.name,set:a=>n.value.name=a}),g=j(),S=p(!1),y=p(!1),T=p(!1),o=p({}),v=p(null);function U(){window.close()}function w(a){k(n.value.mapping).forEach(l=>{const{fieldName:s}=l;o.value[s]=a?a.data[s]:""}),a&&a.sheets&&(v.value=k(a.sheets))}async function q(){var a;try{y.value=!0;const e={id:(a=g.query.id)!=null?a:"",tempId:n.value.id,tempName:n.value.name,data:C(o.value)};if(v.value&&v.value[0]){e.sheets=C(v.value);const l=k(n.value.mapping),s=e.sheets[0].celldata||[];l.forEach(x=>{const{cellIndex:D,fieldName:h}=x,{column:m,row:r}=D,t=s.findIndex(d=>d.c===m&&d.r===r),b=o.value[h];t>-1&&(s[t].v.v=s[t].v.m=b,e.sheets[0].data[r][m].v=e.sheets[0].data[r][m].m=b)})}e.id===""?(await K(e),I.success("\u65B0\u589E\u6210\u529F!"),B("add-sheet-data",{...e}),w()):(await Q(e),I.success("\u4FEE\u6539\u6210\u529F!"),B("modify-sheet-data",{...e}))}catch(e){console.log(e)}y.value=!1}return z(()=>g.path,async()=>{const{tempId:a,id:e}=g.query;if(document.title="\u6570\u636E\u586B\u62A5",a){Y();const l=await W(a);if(n.value={...l},w(),e){const s=await X(e);w(s)}}S.value=!0},{immediate:!0}),(a,e)=>{const l=c("b-space"),s=c("b-icon"),x=c("b-input-number"),D=c("b-input"),h=c("b-form-item"),m=c("b-button"),r=c("b-form");return i(),N("div",Z,[u("div",$,[u("div",ee,[_(l,null,{default:f(()=>[u("h3",null,L(E.value),1)]),_:1})]),u("div",ae,[_(s,{type:"button",name:"close",color:"#f5222d",size:"24",onClick:U})])]),u("div",te,[S.value?(i(),N("div",se,[_(r,{"label-width":"100px",model:o.value},{default:f(()=>[(i(!0),N(P,null,R(O(n).mapping,(t,b)=>(i(),V(h,{key:b,prop:t.fieldName,label:t.fieldTitle},{default:f(()=>[t.dataType==="number"?(i(),V(x,{key:0,modelValue:o.value[t.fieldName],"onUpdate:modelValue":d=>o.value[t.fieldName]=d},null,8,["modelValue","onUpdate:modelValue"])):(i(),V(D,{key:1,modelValue:o.value[t.fieldName],"onUpdate:modelValue":d=>o.value[t.fieldName]=d},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1032,["prop","label"]))),128)),_(h,null,{default:f(()=>[_(m,{type:"primary",loading:y.value,onClick:q},{default:f(()=>[A("\u4FDD \u5B58")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):G("",!0)]),H(u("div",oe,"loading",512),[[J,T.value]])])}}}),_e=F(ne,[["__scopeId","data-v-a88d2f67"]]);export{_e as default};
